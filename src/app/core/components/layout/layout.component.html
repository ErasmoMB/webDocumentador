<div class="layout">
  <header class="header">
    <div class="header-left">
      <button class="btn-icon" (click)="toggleSidebar()" aria-label="Toggle sidebar">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18M3 6h18M3 18h18"/>
        </svg>
      </button>
      <h1 class="header-title">Documentador</h1>
    </div>
    <div class="header-right">
      <button class="btn btn-outline" (click)="irAPlantilla()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10 9 9 9 8 9"/>
        </svg>
        Ver Plantilla
      </button>
    </div>
  </header>

  <div class="layout-body">
    <aside class="sidebar" [class.sidebar-collapsed]="!sidebarOpen">
      <nav class="sidebar-nav">
        <div class="sidebar-section">
          <div class="sidebar-section-title">√çndice del Documento</div>
          <ul class="sidebar-menu">
            <ng-container *ngFor="let section of sections">
              <li class="sidebar-item" [class.sidebar-item-level-0]="section.level === 0">
                <div class="sidebar-section-wrapper">
                  <button 
                    *ngIf="hasChildren(section)" 
                    class="sidebar-toggle"
                    (click)="toggleSection(section)"
                    [attr.aria-expanded]="section.expanded">
                    <svg class="sidebar-chevron" [class.expanded]="section.expanded" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6"/>
                    </svg>
                  </button>
                  <span *ngIf="!hasChildren(section)" class="sidebar-toggle-spacer"></span>
                  <a 
                    *ngIf="section.route" 
                    [routerLink]="section.route" 
                    routerLinkActive="active" 
                    class="sidebar-link"
                    [style.padding-left.px]="section.level * 12 + 8">
                    <span class="sidebar-text">{{ section.title }}</span>
                  </a>
                  <span 
                    *ngIf="!section.route" 
                    class="sidebar-link sidebar-link-no-route"
                    [style.padding-left.px]="section.level * 12 + 8">
                    <span class="sidebar-text">{{ section.title }}</span>
                  </span>
                </div>
                <ul *ngIf="hasChildren(section) && section.expanded" class="sidebar-submenu">
                  <ng-container *ngTemplateOutlet="sectionTemplate; context: { sections: section.children }"></ng-container>
                </ul>
              </li>
            </ng-container>
          </ul>
        </div>
      </nav>
    </aside>

    <ng-template #sectionTemplate let-sections="sections">
      <ng-container *ngFor="let section of sections">
        <li class="sidebar-item" [class.sidebar-item-level-1]="section.level === 1" [class.sidebar-item-level-2]="section.level === 2" [class.sidebar-item-level-3]="section.level === 3" [class.sidebar-item-level-4]="section.level === 4" [class.sidebar-item-level-5]="section.level === 5">
          <div class="sidebar-section-wrapper">
            <button 
              *ngIf="hasChildren(section)" 
              class="sidebar-toggle"
              (click)="toggleSection(section)"
              [attr.aria-expanded]="section.expanded">
              <svg class="sidebar-chevron" [class.expanded]="section.expanded" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </button>
            <span *ngIf="!hasChildren(section)" class="sidebar-toggle-spacer"></span>
            <a 
              *ngIf="section.route" 
              [routerLink]="section.route" 
              routerLinkActive="active" 
              class="sidebar-link"
              [style.padding-left.px]="section.level * 12 + 8">
              <span class="sidebar-text">{{ section.title }}</span>
            </a>
            <span 
              *ngIf="!section.route" 
              class="sidebar-link sidebar-link-no-route"
              [style.padding-left.px]="section.level * 12 + 8">
              <span class="sidebar-text">{{ section.title }}</span>
            </span>
          </div>
          <ul *ngIf="hasChildren(section) && section.expanded" class="sidebar-submenu">
            <ng-container *ngTemplateOutlet="sectionTemplate; context: { sections: section.children }"></ng-container>
          </ul>
        </li>
      </ng-container>
    </ng-template>

    <main class="main-content" [class.main-expanded]="!sidebarOpen">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

