<div class="seccion-container">
  <div class="seccion-preview" [style.flex]="previewFlex">
    <div class="preview-header">
      <div class="preview-header-titles">
        <h3 *ngIf="seccionPadreTitulo" class="seccion-padre-titulo">{{ seccionPadreTitulo }}</h3>
        <h2>{{ seccionTitulo }}</h2>
      </div>
      <div class="preview-actions">
        <button class="btn btn-test" (click)="llenarDatosPrueba()" title="Llenar todos los campos con datos de prueba">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          Llenar Prueba
        </button>
        <button class="btn btn-ghost" (click)="irAPlantilla()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          Ver Plantilla Completa
        </button>
      </div>
    </div>
    <div class="preview-content scrollbar-thin">
      <div class="preview-document">
        <!-- Usar componente seccion1 para la sección 3.1.1 -->
        <div class="preview preview-static" *ngIf="seccionId === '3.1.1'">
          <div class="viewport-content">
            <app-seccion1></app-seccion1>
          </div>
        </div>
        <!-- Usar componente seccion2 para la sección 3.1.2 -->
        <div class="preview preview-static" *ngIf="seccionId === '3.1.2'">
          <div class="viewport-content">
            <app-seccion2></app-seccion2>
          </div>
        </div>
        <!-- Usar componente seccion3 para la sección 3.1.3 -->
        <div class="preview preview-static" *ngIf="seccionId === '3.1.3'">
          <div class="viewport-content">
            <app-seccion3></app-seccion3>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.1'">
          <div class="viewport-content">
            <app-seccion5></app-seccion5>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.2'">
          <div class="viewport-content">
            <app-seccion6></app-seccion6>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.3'">
          <div class="viewport-content">
            <app-seccion7></app-seccion7>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.4'">
          <div class="viewport-content">
            <app-seccion8></app-seccion8>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.5'">
          <div class="viewport-content">
            <app-seccion9></app-seccion9>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.6'">
          <div class="viewport-content">
            <app-seccion10></app-seccion10>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.7'">
          <div class="viewport-content">
            <app-seccion11></app-seccion11>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.8'">
          <div class="viewport-content">
            <app-seccion12></app-seccion12>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.9'">
          <div class="viewport-content">
            <app-seccion13></app-seccion13>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.10'">
          <div class="viewport-content">
            <app-seccion14></app-seccion14>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.11'">
          <div class="viewport-content">
            <app-seccion15></app-seccion15>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.12'">
          <div class="viewport-content">
            <app-seccion16></app-seccion16>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.13'">
          <div class="viewport-content">
            <app-seccion17></app-seccion17>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.14'">
          <div class="viewport-content">
            <app-seccion18></app-seccion18>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.15'">
          <div class="viewport-content">
            <app-seccion19></app-seccion19>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A.1.16'">
          <div class="viewport-content">
            <app-seccion20></app-seccion20>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B' || seccionId === '3.1.4.B.1'">
          <div class="viewport-content">
            <app-seccion21></app-seccion21>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.1'">
          <div class="viewport-content">
            <app-seccion22></app-seccion22>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.2'">
          <div class="viewport-content">
            <app-seccion23></app-seccion23>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.3'">
          <div class="viewport-content">
            <app-seccion24></app-seccion24>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.4'">
          <div class="viewport-content">
            <app-seccion25></app-seccion25>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.5'">
          <div class="viewport-content">
            <app-seccion26></app-seccion26>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.6'">
          <div class="viewport-content">
            <app-seccion27></app-seccion27>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.7'">
          <div class="viewport-content">
            <app-seccion28></app-seccion28>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.8'">
          <div class="viewport-content">
            <app-seccion29></app-seccion29>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.9'">
          <div class="viewport-content">
            <app-seccion30></app-seccion30>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="sectionTemplate && seccionId !== '3.1.1' && seccionId !== '3.1.2' && seccionId !== '3.1.3' && seccionId !== '3.1.4.A.1.1' && seccionId !== '3.1.4.A.1.2' && seccionId !== '3.1.4.A.1.3' && seccionId !== '3.1.4.A.1.4' && seccionId !== '3.1.4.A.1.5' && seccionId !== '3.1.4.A.1.6' && seccionId !== '3.1.4.A.1.7' && seccionId !== '3.1.4.A.1.8' && seccionId !== '3.1.4.A.1.9' && seccionId !== '3.1.4.A.1.10' && seccionId !== '3.1.4.A.1.11' && seccionId !== '3.1.4.A.1.12' && seccionId !== '3.1.4.A.1.13' && seccionId !== '3.1.4.A.1.14' && seccionId !== '3.1.4.A.1.15' && seccionId !== '3.1.4.A.1.16' && seccionId !== '3.1.4.B.1' && seccionId !== '3.1.4.B.1.1' && seccionId !== '3.1.4.B.1.2' && seccionId !== '3.1.4.B.1.3' && seccionId !== '3.1.4.B.1.4' && seccionId !== '3.1.4.B.1.5' && seccionId !== '3.1.4.B.1.6' && seccionId !== '3.1.4.B.1.7' && seccionId !== '3.1.4.B.1.8' && seccionId !== '3.1.4.B.1.9'">
          <div class="viewport-content" [innerHTML]="getRenderedTemplate()"></div>
        </div>
        <div *ngIf="!sectionTemplate && seccionId !== '3.1.1' && seccionId !== '3.1.2' && seccionId !== '3.1.3' && seccionId !== '3.1.4.A.1.1' && seccionId !== '3.1.4.A.1.2' && seccionId !== '3.1.4.A.1.3' && seccionId !== '3.1.4.A.1.4' && seccionId !== '3.1.4.A.1.5' && seccionId !== '3.1.4.A.1.6' && seccionId !== '3.1.4.A.1.7' && seccionId !== '3.1.4.A.1.8' && seccionId !== '3.1.4.A.1.9' && seccionId !== '3.1.4.A.1.10' && seccionId !== '3.1.4.A.1.11' && seccionId !== '3.1.4.A.1.12' && seccionId !== '3.1.4.A.1.13' && seccionId !== '3.1.4.A.1.14' && seccionId !== '3.1.4.A.1.15' && seccionId !== '3.1.4.A.1.16' && seccionId !== '3.1.4.B' && seccionId !== '3.1.4.B.1' && seccionId !== '3.1.4.B.1.1' && seccionId !== '3.1.4.B.1.2' && seccionId !== '3.1.4.B.1.3' && seccionId !== '3.1.4.B.1.4' && seccionId !== '3.1.4.B.1.5' && seccionId !== '3.1.4.B.1.6' && seccionId !== '3.1.4.B.1.7' && seccionId !== '3.1.4.B.1.8' && seccionId !== '3.1.4.B.1.9'" class="preview-placeholder">
          <div class="placeholder-content">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            <p>Vista previa del documento</p>
            <span class="placeholder-hint">Los datos ingresados aparecerán aquí</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="resizer" (mousedown)="startResize($event)" 
       [class.resizing]="isResizing"
       title="Arrastra para redimensionar"></div>

  <div class="seccion-formulario" [style.flex]="formularioFlex">
    <div class="formulario-header">
      <h3>Formulario de Datos</h3>
      <span class="badge badge-primary">{{ seccionTitulo }}</span>
    </div>
    <div class="formulario-content scrollbar-thin">
      <!-- Formulario especializado para 3.1.4, 3.1.4.A y 3.1.4.A.1 -->
      <ng-container *ngIf="seccionId === '3.1.4' || seccionId === '3.1.4.A' || seccionId === '3.1.4.A.1'; else defaultForm">
        <!-- Información General de la Comunidad -->
        <div class="form-group-section">
          <h4 class="section-title">Información General de la Comunidad</h4>
          
          <div class="form-field">
            <label class="label">Comunidad Campesina (CC) <span class="required">*</span></label>
            <div class="autocomplete-wrapper">
              <input 
                type="text" 
                class="input" 
                placeholder="Buscar comunidad campesina..."
                [value]="((autocompleteData['grupoAISD'] && autocompleteData['grupoAISD'].buscado) || formData['grupoAISD'] || '')"
                (input)="onAutocompleteInput('grupoAISD', $any($event.target).value)"
                (focus)="autocompleteData['grupoAISD'] && autocompleteData['grupoAISD'].buscado && autocompleteData['grupoAISD'].buscado.length >= 2 && autocompleteData['grupoAISD'].sugerencias.length > 0 ? autocompleteData['grupoAISD'].mostrar = true : null"
                [disabled]="!formData['distritoSeleccionado'] || !formData['provinciaSeleccionada'] || !formData['departamentoSeleccionado']">
              
              <div *ngIf="autocompleteData['grupoAISD'] && autocompleteData['grupoAISD'].mostrar && autocompleteData['grupoAISD'].sugerencias.length > 0" 
                   class="autocomplete-dropdown"
                   (mouseenter)="autocompleteData['grupoAISD'].mostrar = true"
                   (mouseleave)="cerrarSugerenciasAutocomplete('grupoAISD')">
                <div 
                  *ngFor="let sugerencia of autocompleteData['grupoAISD'].sugerencias" 
                  class="autocomplete-item"
                  (mousedown)="seleccionarSugerencia('grupoAISD', sugerencia)"
                  (click)="seleccionarSugerencia('grupoAISD', sugerencia)">
                  {{ sugerencia }}
                </div>
              </div>
            </div>
            <small class="form-hint">Seleccione primero distrito, provincia y departamento para ver las comunidades disponibles</small>
          </div>

          <div class="form-field">
            <label class="label">Distrito Principal <span class="required">*</span></label>
            <div class="autocomplete-wrapper">
              <input 
                type="text" 
                class="input" 
                placeholder="Buscar distrito..."
                [value]="distritoBuscado || formData['distritoSeleccionado'] || ''"
                (input)="onDistritoInput($any($event.target).value)"
                (focus)="distritoBuscado && distritoBuscado.length >= 2 && distritosSugeridos.length > 0 ? mostrarSugerencias = true : null">
              
              <div *ngIf="mostrarSugerencias && distritosSugeridos.length > 0" 
                   class="autocomplete-dropdown"
                   (mouseenter)="mostrarSugerencias = true"
                   (mouseleave)="cerrarSugerencias()">
                <div 
                  *ngFor="let distrito of distritosSugeridos" 
                  class="autocomplete-item"
                  (mousedown)="seleccionarDistrito(distrito)"
                  (click)="seleccionarDistrito(distrito)">
                  {{ distrito }}
                </div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label class="label">Provincia</label>
              <select
                class="input"
                [value]="formData['provinciaSeleccionada']"
                (change)="onFieldChange('provinciaSeleccionada', $any($event.target).value)"
                [disabled]="!formData['distritoSeleccionado']">
                <option value="">Se auto-completará al seleccionar distrito</option>
                <option *ngFor="let provincia of provincias" [value]="provincia">{{ provincia }}</option>
              </select>
            </div>
            <div class="form-field">
              <label class="label">Departamento</label>
              <select
                class="input"
                [value]="formData['departamentoSeleccionado']"
                (change)="onFieldChange('departamentoSeleccionado', $any($event.target).value)"
                [disabled]="!formData['distritoSeleccionado']">
                <option value="">Se auto-completará al seleccionar distrito</option>
                <option *ngFor="let departamento of departamentos" [value]="departamento">{{ departamento }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label class="label">Distrito Adicional 1</label>
              <div class="autocomplete-wrapper">
                <input 
                  type="text" 
                  class="input" 
                  placeholder="Buscar distrito adicional..."
                  [value]="((autocompleteData['aisdComponente1'] && autocompleteData['aisdComponente1'].buscado) || formData['aisdComponente1'] || '')"
                  (input)="onAutocompleteInput('aisdComponente1', $any($event.target).value)"
                  (focus)="autocompleteData['aisdComponente1'] && autocompleteData['aisdComponente1'].buscado && autocompleteData['aisdComponente1'].buscado.length >= 2 && autocompleteData['aisdComponente1'].sugerencias.length > 0 ? autocompleteData['aisdComponente1'].mostrar = true : null">
                
                <div *ngIf="autocompleteData['aisdComponente1'] && autocompleteData['aisdComponente1'].mostrar && autocompleteData['aisdComponente1'].sugerencias.length > 0" 
                     class="autocomplete-dropdown"
                     (mouseenter)="autocompleteData['aisdComponente1'].mostrar = true"
                     (mouseleave)="cerrarSugerenciasAutocomplete('aisdComponente1')">
                  <div 
                    *ngFor="let sugerencia of autocompleteData['aisdComponente1'].sugerencias" 
                    class="autocomplete-item"
                    (mousedown)="seleccionarSugerencia('aisdComponente1', sugerencia)"
                    (click)="seleccionarSugerencia('aisdComponente1', sugerencia)">
                    {{ sugerencia }}
                  </div>
                </div>
              </div>
            </div>
            <div class="form-field">
              <label class="label">Distrito Adicional 2</label>
              <div class="autocomplete-wrapper">
                <input 
                  type="text" 
                  class="input" 
                  placeholder="Buscar distrito adicional..."
                  [value]="((autocompleteData['aisdComponente2'] && autocompleteData['aisdComponente2'].buscado) || formData['aisdComponente2'] || '')"
                  (input)="onAutocompleteInput('aisdComponente2', $any($event.target).value)"
                  (focus)="autocompleteData['aisdComponente2'] && autocompleteData['aisdComponente2'].buscado && autocompleteData['aisdComponente2'].buscado.length >= 2 && autocompleteData['aisdComponente2'].sugerencias.length > 0 ? autocompleteData['aisdComponente2'].mostrar = true : null">
                
                <div *ngIf="autocompleteData['aisdComponente2'] && autocompleteData['aisdComponente2'].mostrar && autocompleteData['aisdComponente2'].sugerencias.length > 0" 
                     class="autocomplete-dropdown"
                     (mouseenter)="autocompleteData['aisdComponente2'].mostrar = true"
                     (mouseleave)="cerrarSugerenciasAutocomplete('aisdComponente2')">
                  <div 
                    *ngFor="let sugerencia of autocompleteData['aisdComponente2'].sugerencias" 
                    class="autocomplete-item"
                    (mousedown)="seleccionarSugerencia('aisdComponente2', sugerencia)"
                    (click)="seleccionarSugerencia('aisdComponente2', sugerencia)">
                    {{ sugerencia }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-field">
            <label class="label">Centro Poblado (CP) AISI</label>
            <input type="text" class="input" 
              [value]="formData['grupoAISI'] || formData['distritoSeleccionado']"
              [disabled]="true">
            <small class="form-hint">Se auto-completa con el distrito principal</small>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label class="label">Coordenadas</label>
              <input type="text" class="input" placeholder="Ej: 18L E: 660 619 m N: 8 291 173 m" 
                [value]="formData['coordenadasAISD'] || ''"
                (input)="onFieldChange('coordenadasAISD', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Altitud (msnm) <span class="required">*</span></label>
              <input type="text" class="input" placeholder="Ej: 3 599" 
                [value]="formData['altitudAISD'] || ''"
                (input)="onAltitudChange($any($event.target).value)"
                (blur)="normalizarAltitud()">
            </div>
          </div>
        </div>

        <!-- Cuadro 1: Ubicación referencial -->
        <div class="form-group-section">
          <h4 class="section-title">Cuadro 1: Ubicación referencial</h4>
          <div class="form-field">
            <label class="label">Título <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Ubicación referencial" 
              [value]="formData['cuadroTituloAISD1']"
              (input)="onFieldChange('cuadroTituloAISD1', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Fuente <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: GEADES (2024)" 
              [value]="formData['cuadroFuenteAISD1']"
              (input)="onFieldChange('cuadroFuenteAISD1', $any($event.target).value)">
          </div>
          <small class="form-hint">El número de cuadro se genera automáticamente. Los demás campos (Localidad, Distrito, Provincia, Departamento) se completan automáticamente desde la información general</small>
        </div>

        <!-- Cuadro 2: Población y viviendas -->
        <div class="form-group-section">
          <h4 class="section-title">Cuadro 2: Población y viviendas</h4>
          <div class="form-field">
            <label class="label">Título <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Cantidad total de población y viviendas" 
              [value]="formData['cuadroTituloAISD2']"
              (input)="onFieldChange('cuadroTituloAISD2', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Cargar datos desde código CPP</label>
            <div class="form-row">
              <input type="text" class="input" placeholder="Ingrese código CPP (ej: 0403060005)" 
                #cppInput
                (keyup.enter)="cargarDatosPorCPP(cppInput.value)">
              <button type="button" class="btn btn-primary" (click)="cargarDatosPorCPP(cppInput.value)">
                Cargar Datos
              </button>
            </div>
            <small class="form-hint">Ingrese el código CPP para cargar automáticamente población y viviendas</small>
          </div>
          
          <!-- Tabla editable dinámica -->
          <div class="table-editor">
            <table class="editor-table">
              <thead>
                <tr>
                  <th>Punto de Población</th>
                  <th>Código</th>
                  <th>Población</th>
                  <th>Viviendas Empadronadas</th>
                  <th>Viviendas Ocupadas</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of getFilasTabla(); let i = index">
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2Fila' + (i+1) + 'Punto']"
                      (input)="onFieldChange('tablaAISD2Fila' + (i+1) + 'Punto', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2Fila' + (i+1) + 'Codigo']"
                      (input)="onFieldChange('tablaAISD2Fila' + (i+1) + 'Codigo', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2Fila' + (i+1) + 'Poblacion']"
                      (input)="onFieldChange('tablaAISD2Fila' + (i+1) + 'Poblacion', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2Fila' + (i+1) + 'ViviendasEmpadronadas']"
                      (input)="onFieldChange('tablaAISD2Fila' + (i+1) + 'ViviendasEmpadronadas', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2Fila' + (i+1) + 'ViviendasOcupadas']"
                      (input)="onFieldChange('tablaAISD2Fila' + (i+1) + 'ViviendasOcupadas', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <button type="button" class="btn-icon" (click)="eliminarFilaTabla(i)" *ngIf="filasTablaAISD2 > 1" title="Eliminar fila">
                      ×
                    </button>
                  </td>
                </tr>
                <tr class="total-row">
                  <td><strong>Total</strong></td>
                  <td></td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2TotalPoblacion'] || '0'"
                      readonly
                      style="background-color: #f5f5f5; cursor: not-allowed;">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2TotalViviendasEmpadronadas'] || '0'"
                      readonly
                      style="background-color: #f5f5f5; cursor: not-allowed;">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="formData['tablaAISD2TotalViviendasOcupadas'] || '0'"
                      readonly
                      style="background-color: #f5f5f5; cursor: not-allowed;">
                  </td>
                  <td></td>
                </tr>
              </tbody>
            </table>
            <button type="button" class="btn btn-secondary" (click)="agregarFilaTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fuente <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Reporte de Indicadores... REDINFORMA (MIDIS)" 
              [value]="formData['cuadroFuenteAISD2']"
              (input)="onFieldChange('cuadroFuenteAISD2', $any($event.target).value)">
          </div>
          <small class="form-hint">El número de cuadro se genera automáticamente</small>
        </div>

        <!-- Fotografías -->
        <div class="form-group-section" *ngFor="let foto of fotografias; let i = index">
          <h4 class="section-title">Fotografía {{ i + 1 }}</h4>
          <div class="form-field">
            <label class="label">Título <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Vista panorámica del Anexo Ayroca" 
              [value]="foto.titulo"
              (input)="actualizarFoto(i, 'titulo', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Fuente <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: GEADES, 2024" 
              [value]="foto.fuente"
              (input)="actualizarFoto(i, 'fuente', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Imagen <span class="required">*</span></label>
            <div class="image-upload-area" 
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)"
                 (drop)="onDrop($event, i)"
                 [attr.data-index]="i"
                 [class.drag-over]="foto.dragOver">
              <input type="file" 
                     #fileInput
                     [id]="'foto-input-' + i"
                     accept="image/*"
                     (change)="onFileSelected($event, i)"
                     style="display: none;">
              <div *ngIf="!foto.preview" class="upload-placeholder">
                <p>Arrastra una imagen aquí o</p>
                <button type="button" class="btn btn-secondary" (click)="fileInput.click()">
                  Buscar en el explorador
                </button>
              </div>
              <div *ngIf="foto.preview" class="image-preview">
                <img [src]="foto.preview" alt="Preview">
                <button type="button" class="btn-icon remove-image" (click)="eliminarImagen(i)" title="Eliminar imagen">
                  ×
                </button>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-danger" (click)="eliminarFoto(i)" *ngIf="fotografias.length > 1" style="margin-top: 10px;">
            Eliminar Fotografía
          </button>
          <small class="form-hint">El número de fotografía se genera automáticamente</small>
        </div>
        <button type="button" class="btn btn-secondary" (click)="agregarFoto()" style="margin-top: 10px;">
          + Agregar Fotografía
        </button>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.1'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.1. Institucionalidad local</h4>
          <div class="form-field">
            <label class="label">Fuente de la Tabla <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: GEADES (2024)"
              [value]="formData['fuenteInstituciones'] || ''"
              (input)="onFieldChange('fuenteInstituciones', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Tabla de Instituciones</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>SI/NO</th>
                    <th>Nombre</th>
                    <th>Comentario</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let institucion of (datos.tablepagina6 || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="institucion.categoria || ''"
                        (input)="actualizarInstitucion(i, 'categoria', $any($event.target).value)"
                        placeholder="Categoría">
                    </td>
                    <td>
                      <select class="table-input" 
                        [value]="institucion.respuesta || ''"
                        (change)="actualizarInstitucion(i, 'respuesta', $any($event.target).value)">
                        <option value="">--</option>
                        <option value="SI">SI</option>
                        <option value="NO">NO</option>
                      </select>
                    </td>
                    <td>
                      <textarea class="table-input" rows="2"
                        [value]="institucion.nombre || ''"
                        (input)="actualizarInstitucion(i, 'nombre', $any($event.target).value)"
                        placeholder="Nombre (puede ser múltiples líneas)"></textarea>
                    </td>
                    <td>
                      <textarea class="table-input" rows="2"
                        [value]="institucion.comentario || ''"
                        (input)="actualizarInstitucion(i, 'comentario', $any($event.target).value)"
                        placeholder="Comentario"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarInstitucion(i)" *ngIf="(datos.tablepagina6 || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.tablepagina6 || datos.tablepagina6.length === 0">
                    <td colspan="5" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarInstituciones()">
                        Agregar Primera Institución
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarInstitucion()" style="margin-top: 10px;">
              + Agregar Institución
            </button>
          </div>
          <app-image-upload
            [titulo]="formData['fotografiaAISD3Titulo'] || formData['fotoInstitucionalidadTitulo'] || ''"
            [fuente]="formData['fotografiaAISD3Fuente'] || formData['fotoInstitucionalidadFuente'] || ''"
            [previewInicial]="fotoInstitucionalidadPreview"
            labelTitulo="Fotografía - Título"
            labelFuente="Fotografía - Fuente"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Local Comunal de la CC Ayroca"
            placeholderFuente="Ej: GEADES, 2024"
            [requerido]="true"
            (tituloChange)="onFieldChange('fotografiaAISD3Titulo', $event); onFieldChange('fotoInstitucionalidadTitulo', $event)"
            (fuenteChange)="onFieldChange('fotografiaAISD3Fuente', $event); onFieldChange('fotoInstitucionalidadFuente', $event)"
            (imagenChange)="onImagenInstitucionalidadChange($event)">
          </app-image-upload>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.2'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.2. Aspectos Demográficos</h4>
          <div class="form-field">
            <label class="label">Cargar datos desde distrito</label>
            <div class="form-row">
              <input type="text" class="input" placeholder="Ingrese nombre del distrito (ej: CAHUACHO)" 
                #distritoInput
                (keyup.enter)="cargarDatosDemografiaAISD()">
              <button type="button" class="btn btn-primary" (click)="cargarDatosDemografiaAISD()">
                Cargar Datos
              </button>
            </div>
            <small class="form-hint">Los datos se cargarán automáticamente desde el backend si está disponible</small>
          </div>
          <div class="form-field">
            <label class="label">Población por Sexo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Sexo</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.poblacionSexoAISD || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.sexo || ''"
                        (input)="actualizarPoblacionSexo(i, 'sexo', $any($event.target).value)"
                        placeholder="Hombres/Mujeres">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionSexo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionSexo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                  </tr>
                  <tr *ngIf="!datos.poblacionSexoAISD || datos.poblacionSexoAISD.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionSexo()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Población por Grupo Etario</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.poblacionEtarioAISD || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPoblacionEtario(i, 'categoria', $any($event.target).value)"
                        placeholder="0 a 14 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionEtario(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionEtario(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                  </tr>
                  <tr *ngIf="!datos.poblacionEtarioAISD || datos.poblacionEtarioAISD.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionEtario()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.3'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.3. Aspectos Económicos</h4>
          <div class="form-field">
            <label class="label">Cargar datos PEA desde distrito</label>
            <div class="form-row">
              <input type="text" class="input" placeholder="Ingrese nombre del distrito (ej: CAHUACHO)" 
                #distritoPEAInput
                [value]="formData['distritoSeleccionado'] || ''"
                (keyup.enter)="cargarDatosPEAAISD()">
              <button type="button" class="btn btn-primary" (click)="cargarDatosPEAAISD()">
                Cargar Datos
              </button>
            </div>
            <small class="form-hint">Los datos PEA se cargarán automáticamente desde el backend si está disponible</small>
          </div>
          <div class="form-field">
            <label class="label">Población Distrital</label>
            <input type="text" class="input" placeholder="Ej: 610"
              [value]="formData['poblacionDistritalCahuacho'] || ''"
              (input)="onFieldChange('poblacionDistritalCahuacho', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">PET Distrital (14 años a más)</label>
            <input type="text" class="input" placeholder="Ej: 461"
              [value]="formData['petDistritalCahuacho'] || ''"
              (input)="onFieldChange('petDistritalCahuacho', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Ingreso Familiar Per Cápita (S/.)</label>
            <input type="text" class="input" placeholder="Ej: 391,06"
              [value]="formData['ingresoFamiliarPerCapita'] || ''"
              (input)="onFieldChange('ingresoFamiliarPerCapita', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Ranking Ingreso Per Cápita</label>
            <input type="text" class="input" placeholder="Ej: 1191"
              [value]="formData['rankingIngresoPerCapita'] || ''"
              (input)="onFieldChange('rankingIngresoPerCapita', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Tabla PET según grupos de edad</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.petTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPET(i, 'categoria', $any($event.target).value)"
                        placeholder="15 a 29 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPET(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPET(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPET(i)" *ngIf="(datos.petTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.petTabla || datos.petTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPET()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPET()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla PEA y No PEA según sexo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Hombres</th>
                    <th>% Hombres</th>
                    <th>Mujeres</th>
                    <th>% Mujeres</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.peaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEA(i, 'categoria', $any($event.target).value)"
                        placeholder="PEA/No PEA">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEA(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEA(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEA(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEA(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEA(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEA(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEA(i)" *ngIf="(datos.peaTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.peaTabla || datos.peaTabla.length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEA()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEA()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla PEA Ocupada y Desocupada según sexo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Hombres</th>
                    <th>% Hombres</th>
                    <th>Mujeres</th>
                    <th>% Mujeres</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.peaOcupadaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEAOcupada(i, 'categoria', $any($event.target).value)"
                        placeholder="PEA Ocupada/Desocupada">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEAOcupada(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEAOcupada(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEAOcupada(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEAOcupada(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEAOcupada(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEAOcupada(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEAOcupada(i)" *ngIf="(datos.peaOcupadaTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.peaOcupadaTabla || datos.peaOcupadaTabla.length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupada()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupada()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.4'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.4. Actividades económicas de la población</h4>
          <div class="form-field">
            <label class="label">Tabla PEA Ocupada según ocupaciones principales</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.peaOcupacionesTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEAOcupaciones(i, 'categoria', $any($event.target).value)"
                        placeholder="Trabajador independiente">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEAOcupaciones(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEAOcupaciones(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEAOcupaciones(i)" *ngIf="(datos.peaOcupacionesTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.peaOcupacionesTabla || datos.peaOcupacionesTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupaciones()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupaciones()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Población Pecuaria</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Especie</th>
                    <th>Cantidad promedio por familia</th>
                    <th>Venta por unidad</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.poblacionPecuariaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.especie || ''"
                        (input)="actualizarPoblacionPecuaria(i, 'especie', $any($event.target).value)"
                        placeholder="Vacuno">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.cantidadPromedio || ''"
                        (input)="actualizarPoblacionPecuaria(i, 'cantidadPromedio', $any($event.target).value)"
                        placeholder="4 – 50">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.ventaUnidad || ''"
                        (input)="actualizarPoblacionPecuaria(i, 'ventaUnidad', $any($event.target).value)"
                        placeholder="S/. 1 200 – S/. 1 500">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPoblacionPecuaria(i)" *ngIf="(datos.poblacionPecuariaTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.poblacionPecuariaTabla || datos.poblacionPecuariaTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionPecuaria()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPoblacionPecuaria()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Ganadería</label>
            <div *ngFor="let foto of getFotografiasGanaderiaForm(); let i = index" class="form-field" style="margin-top: 15px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
              <h5 style="margin-bottom: 10px;">Fotografía {{ i + 1 }}</h5>
              <div class="form-field">
                <label class="label">Título</label>
                <input type="text" class="input" 
                  [value]="foto.titulo || ''"
                  (input)="actualizarFotoGanaderia(i, 'titulo', $any($event.target).value)"
                  placeholder="Ej: Ganado vacuno en la CC Ayroca">
              </div>
              <div class="form-field">
                <label class="label">Fuente</label>
                <input type="text" class="input" 
                  [value]="foto.fuente || ''"
                  (input)="actualizarFotoGanaderia(i, 'fuente', $any($event.target).value)"
                  placeholder="Ej: GEADES, 2024">
              </div>
              <div class="form-field">
                <label class="label">Imagen <span class="required">*</span></label>
                <div class="image-upload-area" 
                     (dragover)="onDragOverFotoGanaderia($event, i)"
                     (dragleave)="onDragLeaveFotoGanaderia($event, i)"
                     (drop)="onDropFotoGanaderia($event, i)"
                     [class.drag-over]="foto.dragOver">
                  <input type="file" 
                         #fotoGanaderiaInput
                         [id]="'foto-ganaderia-input-' + i"
                         accept="image/*"
                         (change)="onFileSelectedFotoGanaderia($event, i)"
                         style="display: none;">
                  <div *ngIf="!foto.preview" class="upload-placeholder">
                    <p>Arrastra una imagen aquí o</p>
                    <button type="button" class="btn btn-secondary" (click)="fotoGanaderiaInput.click()">
                      Buscar en el explorador
                    </button>
                  </div>
                  <div *ngIf="foto.preview" class="image-preview">
                    <img [src]="foto.preview" alt="Preview">
                    <button type="button" class="btn-icon remove-image" (click)="eliminarImagenFotoGanaderia(i)" title="Eliminar imagen">
                      ×
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Tabla Características de la Agricultura</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Detalle</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.caracteristicasAgriculturaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCaracteristicasAgricultura(i, 'categoria', $any($event.target).value)"
                        placeholder="Destino de la producción">
                    </td>
                    <td>
                      <textarea class="table-input" rows="2"
                        [value]="item.detalle || ''"
                        (input)="actualizarCaracteristicasAgricultura(i, 'detalle', $any($event.target).value)"
                        placeholder="Autoconsumo: 95%"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCaracteristicasAgricultura(i)" *ngIf="(datos.caracteristicasAgriculturaTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.caracteristicasAgriculturaTabla || datos.caracteristicasAgriculturaTabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCaracteristicasAgricultura()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCaracteristicasAgricultura()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Agricultura</label>
            <div *ngFor="let foto of getFotografiasAgriculturaForm(); let i = index" class="form-field" style="margin-top: 15px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
              <h5 style="margin-bottom: 10px;">Fotografía {{ i + 1 }}</h5>
              <div class="form-field">
                <label class="label">Título</label>
                <input type="text" class="input" 
                  [value]="foto.titulo || ''"
                  (input)="actualizarFotoAgricultura(i, 'titulo', $any($event.target).value)"
                  placeholder="Ej: Parcela agrícola en el anexo Ayroca">
              </div>
              <div class="form-field">
                <label class="label">Fuente</label>
                <input type="text" class="input" 
                  [value]="foto.fuente || ''"
                  (input)="actualizarFotoAgricultura(i, 'fuente', $any($event.target).value)"
                  placeholder="Ej: GEADES, 2024">
              </div>
              <div class="form-field">
                <label class="label">Imagen <span class="required">*</span></label>
                <div class="image-upload-area" 
                     (dragover)="onDragOverFotoAgricultura($event, i)"
                     (dragleave)="onDragLeaveFotoAgricultura($event, i)"
                     (drop)="onDropFotoAgricultura($event, i)"
                     [class.drag-over]="foto.dragOver">
                  <input type="file" 
                         #fotoAgriculturaInput
                         [id]="'foto-agricultura-input-' + i"
                         accept="image/*"
                         (change)="onFileSelectedFotoAgricultura($event, i)"
                         style="display: none;">
                  <div *ngIf="!foto.preview" class="upload-placeholder">
                    <p>Arrastra una imagen aquí o</p>
                    <button type="button" class="btn btn-secondary" (click)="fotoAgriculturaInput.click()">
                      Buscar en el explorador
                    </button>
                  </div>
                  <div *ngIf="foto.preview" class="image-preview">
                    <img [src]="foto.preview" alt="Preview">
                    <button type="button" class="btn-icon remove-image" (click)="eliminarImagenFotoAgricultura(i)" title="Eliminar imagen">
                      ×
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Comercio</label>
            <div class="form-field">
              <label class="label">Título</label>
              <input type="text" class="input" 
                [value]="formData['fotografiaComercioTitulo'] || ''"
                (input)="onFieldChange('fotografiaComercioTitulo', $any($event.target).value)"
                placeholder="Ej: Comercio ambulatorio en el anexo Ayroca">
            </div>
            <div class="form-field">
              <label class="label">Fuente</label>
              <input type="text" class="input" 
                [value]="formData['fotografiaComercioFuente'] || ''"
                (input)="onFieldChange('fotografiaComercioFuente', $any($event.target).value)"
                placeholder="Ej: GEADES, 2024">
            </div>
            <div class="form-field">
              <label class="label">Imagen <span class="required">*</span></label>
              <div class="image-upload-area" 
                   (dragover)="onDragOverFotoComercio($event)"
                   (dragleave)="onDragLeaveFotoComercio($event)"
                   (drop)="onDropFotoComercio($event)"
                   [class.drag-over]="fotoComercioDragOver">
                <input type="file" 
                       #fotoComercioInput
                       id="foto-comercio-input"
                       accept="image/*"
                       (change)="onFileSelectedFotoComercio($event)"
                       style="display: none;">
                <div *ngIf="!fotoComercioPreview" class="upload-placeholder">
                  <p>Arrastra una imagen aquí o</p>
                  <button type="button" class="btn btn-secondary" (click)="fotoComercioInput.click()">
                    Buscar en el explorador
                  </button>
                </div>
                <div *ngIf="fotoComercioPreview" class="image-preview">
                  <img [src]="fotoComercioPreview" alt="Preview">
                  <button type="button" class="btn-icon remove-image" (click)="eliminarImagenFotoComercio()" title="Eliminar imagen">
                    ×
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.5'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.5. Viviendas</h4>
          <div class="form-field">
            <label class="label">Tabla Condición de Ocupación</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Condición de ocupación</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.condicionOcupacionTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCondicionOcupacion(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas ocupadas">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCondicionOcupacion(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCondicionOcupacion(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCondicionOcupacion(i)" *ngIf="(datos.condicionOcupacionTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.condicionOcupacionTabla || datos.condicionOcupacionTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCondicionOcupacion()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCondicionOcupacion()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Tipos de Materiales</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categorías</th>
                    <th>Tipos de materiales</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.tiposMaterialesTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarTiposMateriales(i, 'categoria', $any($event.target).value)"
                        placeholder="Materiales de las paredes">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.tipoMaterial || ''"
                        (input)="actualizarTiposMateriales(i, 'tipoMaterial', $any($event.target).value)"
                        placeholder="Adobe">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTiposMateriales(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTiposMateriales(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTiposMateriales(i)" *ngIf="(datos.tiposMaterialesTabla || []).length > 1 && item.tipoMaterial !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.tiposMaterialesTabla || datos.tiposMaterialesTabla.length === 0">
                    <td colspan="5" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTiposMateriales()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTiposMateriales()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <app-image-upload
            [titulo]="formData['fotografiaEstructuraTitulo'] || ''"
            [fuente]="formData['fotografiaEstructuraFuente'] || ''"
            [previewInicial]="fotoEstructuraPreview"
            labelTitulo="Fotografía - Título"
            labelFuente="Fotografía - Fuente"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Estructura de las viviendas en el anexo Ayroca"
            placeholderFuente="Ej: GEADES, 2024"
            [requerido]="true"
            (tituloChange)="onFieldChange('fotografiaEstructuraTitulo', $event)"
            (fuenteChange)="onFieldChange('fotografiaEstructuraFuente', $event)"
            (imagenChange)="onImagenEstructuraChange($event)">
          </app-image-upload>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.6'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.6. Servicios básicos</h4>
          <div class="form-field">
            <label class="label">Tabla Abastecimiento de Agua</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.abastecimientoAguaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAbastecimientoAgua(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas con abastecimiento de agua por red pública">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAbastecimientoAgua(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAbastecimientoAgua(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAbastecimientoAgua(i)" *ngIf="(datos.abastecimientoAguaTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.abastecimientoAguaTabla || datos.abastecimientoAguaTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAbastecimientoAgua()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAbastecimientoAgua()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Cuota Mensual de Agua (S/.)</label>
            <input type="text" class="input" placeholder="Ej: 4"
              [value]="formData['cuotaMensualAgua'] || ''"
              (input)="onFieldChange('cuotaMensualAgua', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Tabla Tipos de Saneamiento</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.tiposSaneamientoTabla || datos.saneamientoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarTiposSaneamiento(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas con saneamiento vía red pública">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTiposSaneamiento(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTiposSaneamiento(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTiposSaneamiento(i)" *ngIf="((datos.tiposSaneamientoTabla || datos.saneamientoTabla || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="(!datos.tiposSaneamientoTabla || datos.tiposSaneamientoTabla.length === 0) && (!datos.saneamientoTabla || datos.saneamientoTabla.length === 0)">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTiposSaneamiento()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTiposSaneamiento()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Desechos Sólidos</label>
            <app-image-upload
              [titulo]="formData['fotografiaDesechosSolidosTitulo'] || ''"
              [fuente]="formData['fotografiaDesechosSolidosFuente'] || ''"
              [previewInicial]="fotoDesechosSolidosPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Contenedor de residuos sólidos y plásticos en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaDesechosSolidosTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaDesechosSolidosFuente', $event)"
              (imagenChange)="onImagenDesechosSolidosChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Tabla Cobertura Eléctrica</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.coberturaElectricaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCoberturaElectrica(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas con acceso a electricidad">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCoberturaElectrica(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCoberturaElectrica(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCoberturaElectrica(i)" *ngIf="(datos.coberturaElectricaTabla || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.coberturaElectricaTabla || datos.coberturaElectricaTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCoberturaElectrica()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCoberturaElectrica()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Empresa Eléctrica</label>
            <input type="text" class="input" placeholder="Ej: ADINELSA"
              [value]="formData['empresaElectrica'] || ''"
              (input)="onFieldChange('empresaElectrica', $any($event.target).value)">
          </div>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Costo Eléctrico Mínimo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 20"
                [value]="formData['costoElectricidadMinimo'] || ''"
                (input)="onFieldChange('costoElectricidadMinimo', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Costo Eléctrico Máximo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 40"
                [value]="formData['costoElectricidadMaximo'] || ''"
                (input)="onFieldChange('costoElectricidadMaximo', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Electricidad</label>
            <app-image-upload
              [titulo]="formData['fotografiaElectricidadTitulo'] || ''"
              [fuente]="formData['fotografiaElectricidadFuente'] || ''"
              [previewInicial]="fotoElectricidadPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura eléctrica en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaElectricidadTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaElectricidadFuente', $event)"
              (imagenChange)="onImagenElectricidadChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.7'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.7. Infraestructura en transportes y comunicaciones</h4>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Costo Transporte Mínimo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 25"
                [value]="formData['costoTransporteMinimo'] || ''"
                (input)="onFieldChange('costoTransporteMinimo', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Costo Transporte Máximo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 30"
                [value]="formData['costoTransporteMaximo'] || ''"
                (input)="onFieldChange('costoTransporteMaximo', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Transporte</label>
            <app-image-upload
              [titulo]="formData['fotografiaTransporteTitulo'] || ''"
              [fuente]="formData['fotografiaTransporteFuente'] || ''"
              [previewInicial]="fotoTransportePreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de transporte en la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaTransporteTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaTransporteFuente', $event)"
              (imagenChange)="onImagenTransporteChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Tabla Servicios de Telecomunicaciones</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Medio de comunicación</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.telecomunicacionesTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.medio || ''"
                        (input)="actualizarTelecomunicaciones(i, 'medio', $any($event.target).value)"
                        placeholder="Emisoras de radio">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.descripcion || ''"
                        (input)="actualizarTelecomunicaciones(i, 'descripcion', $any($event.target).value)"
                        placeholder="--">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTelecomunicaciones(i)" *ngIf="(datos.telecomunicacionesTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.telecomunicacionesTabla || datos.telecomunicacionesTabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTelecomunicaciones()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTelecomunicaciones()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Telecomunicaciones</label>
            <app-image-upload
              [titulo]="formData['fotografiaTelecomunicacionesTitulo'] || ''"
              [fuente]="formData['fotografiaTelecomunicacionesFuente'] || ''"
              [previewInicial]="fotoTelecomunicacionesPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Vivienda con antena de DIRECTV en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaTelecomunicacionesTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaTelecomunicacionesFuente', $event)"
              (imagenChange)="onImagenTelecomunicacionesChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.8'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.8. Infraestructura en salud, educación, recreativa y deportiva</h4>
          <div class="form-field">
            <label class="label">Tabla Características del Puesto de Salud</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.caracteristicasSaludTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCaracteristicasSalud(i, 'categoria', $any($event.target).value)"
                        placeholder="Nombre">
                    </td>
                    <td>
                      <textarea class="table-input" rows="3"
                        [value]="item.descripcion || ''"
                        (input)="actualizarCaracteristicasSalud(i, 'descripcion', $any($event.target).value)"
                        placeholder="Puesto de Salud Ayroca"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCaracteristicasSalud(i)" *ngIf="(datos.caracteristicasSaludTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.caracteristicasSaludTabla || datos.caracteristicasSaludTabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCaracteristicasSalud()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCaracteristicasSalud()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Salud</label>
            <app-image-upload
              [titulo]="formData['fotografiaSaludTitulo'] || ''"
              [fuente]="formData['fotografiaSaludFuente'] || ''"
              [previewInicial]="fotoSaludPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura externa del Puesto de Salud Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaSaludTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaSaludFuente', $event)"
              (imagenChange)="onImagenSaludChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Tabla Infraestructura Educativa</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Nombre de IE</th>
                    <th>Nivel</th>
                    <th>Tipo de Gestión</th>
                    <th>Cantidad de estudiantes</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.cantidadEstudiantesEducacionTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.institucion || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'institucion', $any($event.target).value)"
                        placeholder="IE Ayroca">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'nivel', $any($event.target).value)"
                        placeholder="Inicial - Jardín">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.gestion || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'gestion', $any($event.target).value)"
                        placeholder="Pública de gestión directa">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.total || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'total', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCantidadEstudiantesEducacion(i)" *ngIf="(datos.cantidadEstudiantesEducacionTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.cantidadEstudiantesEducacionTabla || datos.cantidadEstudiantesEducacionTabla.length === 0">
                    <td colspan="6" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCantidadEstudiantesEducacion()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCantidadEstudiantesEducacion()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Características IE Ayroca</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.ieAyrocaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarIEAyroca(i, 'categoria', $any($event.target).value)"
                        placeholder="Tipo de I.E.">
                    </td>
                    <td>
                      <textarea class="table-input" rows="3"
                        [value]="item.descripcion || ''"
                        (input)="actualizarIEAyroca(i, 'descripcion', $any($event.target).value)"
                        placeholder="Pública de gestión directa, mixta"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarIEAyroca(i)" *ngIf="(datos.ieAyrocaTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.ieAyrocaTabla || datos.ieAyrocaTabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarIEAyroca()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarIEAyroca()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Características IE N°40270</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.ie40270Tabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarIE40270(i, 'categoria', $any($event.target).value)"
                        placeholder="Tipo de I.E.">
                    </td>
                    <td>
                      <textarea class="table-input" rows="3"
                        [value]="item.descripcion || ''"
                        (input)="actualizarIE40270(i, 'descripcion', $any($event.target).value)"
                        placeholder="Pública de gestión directa, mixta"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarIE40270(i)" *ngIf="(datos.ie40270Tabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.ie40270Tabla || datos.ie40270Tabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarIE40270()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarIE40270()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Alumnos IE Ayroca (por grado y sexo)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Nombre de IE</th>
                    <th rowspan="2">Nivel</th>
                    <th colspan="2">Total</th>
                    <th colspan="2">3 años</th>
                    <th colspan="2">4 años</th>
                    <th colspan="2">5 años</th>
                  </tr>
                  <tr>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.alumnosIEAyrocaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombre || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'nombre', $any($event.target).value)"
                        placeholder="IE Ayroca">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'nivel', $any($event.target).value)"
                        placeholder="Inicial - Jardín">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'totalH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'totalM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.tresH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'tresH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.tresM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'tresM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cuatroH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cuatroH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cuatroM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cuatroM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cincoH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cincoH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cincoM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cincoM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAlumnosIEAyroca(i)" *ngIf="(datos.alumnosIEAyrocaTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.alumnosIEAyrocaTabla || datos.alumnosIEAyrocaTabla.length === 0">
                    <td colspan="11" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAlumnosIEAyroca()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAlumnosIEAyroca()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Alumnos IE N°40270 (por grado y sexo)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Nombre de IE</th>
                    <th rowspan="2">Nivel</th>
                    <th colspan="2">Total</th>
                    <th colspan="2">1°</th>
                    <th colspan="2">2°</th>
                    <th colspan="2">3°</th>
                    <th colspan="2">4°</th>
                    <th colspan="2">5°</th>
                    <th colspan="2">6°</th>
                  </tr>
                  <tr>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.alumnosIE40270Tabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombre || ''"
                        (input)="actualizarAlumnosIE40270(i, 'nombre', $any($event.target).value)"
                        placeholder="IE N°40270">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarAlumnosIE40270(i, 'nivel', $any($event.target).value)"
                        placeholder="Primaria">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalH || ''"
                        (input)="actualizarAlumnosIE40270(i, 'totalH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalM || ''"
                        (input)="actualizarAlumnosIE40270(i, 'totalM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p1H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p1H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p1M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p1M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p2H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p2H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p2M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p2M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p3H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p3H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p3M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p3M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p4H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p4H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p4M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p4M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p5H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p5H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p5M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p5M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p6H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p6H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p6M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p6M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAlumnosIE40270(i)" *ngIf="(datos.alumnosIE40270Tabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.alumnosIE40270Tabla || datos.alumnosIE40270Tabla.length === 0">
                    <td colspan="17" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAlumnosIE40270()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAlumnosIE40270()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Educación</label>
            <div *ngFor="let foto of getFotografiasEducacionForm(); let i = index" class="form-field" style="margin-top: 15px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
              <h5 style="margin-bottom: 10px;">Fotografía {{ i + 1 }}</h5>
              <app-image-upload
                [titulo]="foto.titulo || ''"
                [fuente]="foto.fuente || ''"
                [previewInicial]="foto.preview"
                labelTitulo="Fotografía - Título"
                labelFuente="Fotografía - Fuente"
                labelImagen="Fotografía - Imagen"
                [placeholderTitulo]="i === 0 ? 'Ej: Infraestructura de la IE Ayroca' : 'Ej: Infraestructura de la IE N°40270'"
                placeholderFuente="Ej: GEADES, 2024"
                [requerido]="true"
                (tituloChange)="actualizarFotoEducacion(i, 'titulo', $event)"
                (fuenteChange)="actualizarFotoEducacion(i, 'fuente', $event)"
                (imagenChange)="actualizarFotoEducacion(i, 'imagen', $event)">
              </app-image-upload>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Recreación</label>
            <div *ngFor="let foto of getFotografiasRecreacionForm(); let i = index" class="form-field" style="margin-top: 15px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
              <h5 style="margin-bottom: 10px;">Fotografía {{ i + 1 }}</h5>
              <app-image-upload
                [titulo]="foto.titulo || ''"
                [fuente]="foto.fuente || ''"
                [previewInicial]="foto.preview"
                labelTitulo="Fotografía - Título"
                labelFuente="Fotografía - Fuente"
                labelImagen="Fotografía - Imagen"
                [placeholderTitulo]="getPlaceholderRecreacion(i)"
                placeholderFuente="Ej: GEADES, 2024"
                [requerido]="true"
                (tituloChange)="actualizarFotoRecreacion(i, 'titulo', $event)"
                (fuenteChange)="actualizarFotoRecreacion(i, 'fuente', $event)"
                (imagenChange)="actualizarFotoRecreacion(i, 'imagen', $event)">
              </app-image-upload>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Deporte</label>
            <div *ngFor="let foto of getFotografiasDeporteForm(); let i = index" class="form-field" style="margin-top: 15px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
              <h5 style="margin-bottom: 10px;">Fotografía {{ i + 1 }}</h5>
              <app-image-upload
                [titulo]="foto.titulo || ''"
                [fuente]="foto.fuente || ''"
                [previewInicial]="foto.preview"
                labelTitulo="Fotografía - Título"
                labelFuente="Fotografía - Fuente"
                labelImagen="Fotografía - Imagen"
                [placeholderTitulo]="i === 0 ? 'Ej: Losa deportiva del anexo Ayroca' : 'Ej: Estadio del anexo Ayroca'"
                placeholderFuente="Ej: GEADES, 2024"
                [requerido]="true"
                (tituloChange)="actualizarFotoDeporte(i, 'titulo', $event)"
                (fuenteChange)="actualizarFotoDeporte(i, 'fuente', $event)"
                (imagenChange)="actualizarFotoDeporte(i, 'imagen', $event)">
              </app-image-upload>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.9'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.9. Indicadores de salud</h4>
          <div class="form-field">
            <label class="label">Tabla Indicadores de Natalidad y Mortalidad</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Año</th>
                    <th>Natalidad</th>
                    <th>Mortalidad</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.natalidadMortalidadTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.anio || ''"
                        (input)="actualizarNatalidadMortalidad(i, 'anio', $any($event.target).value)"
                        placeholder="2023">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.natalidad || ''"
                        (input)="actualizarNatalidadMortalidad(i, 'natalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mortalidad || ''"
                        (input)="actualizarNatalidadMortalidad(i, 'mortalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNatalidadMortalidad(i)" *ngIf="(datos.natalidadMortalidadTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.natalidadMortalidadTabla || datos.natalidadMortalidadTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNatalidadMortalidad()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNatalidadMortalidad()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Casos por Grupos de Morbilidad</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Grupo de Morbilidad</th>
                    <th colspan="5">Bloques etarios</th>
                    <th rowspan="2">Casos Totales</th>
                    <th rowspan="2"></th>
                  </tr>
                  <tr>
                    <th>0 – 11</th>
                    <th>12 – 17</th>
                    <th>18 – 29</th>
                    <th>30 – 59</th>
                    <th>60 -></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.morbilidadTabla || datos.morbiliadTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.grupo || ''"
                        (input)="actualizarMorbilidad(i, 'grupo', $any($event.target).value)"
                        placeholder="Enfermedades infecciosas intestinales">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango0_11 || ''"
                        (input)="actualizarMorbilidad(i, 'rango0_11', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango12_17 || ''"
                        (input)="actualizarMorbilidad(i, 'rango12_17', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango18_29 || ''"
                        (input)="actualizarMorbilidad(i, 'rango18_29', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango30_59 || ''"
                        (input)="actualizarMorbilidad(i, 'rango30_59', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango60 || ''"
                        (input)="actualizarMorbilidad(i, 'rango60', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarMorbilidad(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarMorbilidad(i)" *ngIf="((datos.morbilidadTabla || datos.morbiliadTabla || []).length > 1)" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="(!datos.morbilidadTabla || datos.morbilidadTabla.length === 0) && (!datos.morbiliadTabla || datos.morbiliadTabla.length === 0)">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarMorbilidad()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarMorbilidad()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Porcentaje SIS (%)</label>
              <input type="text" class="input" placeholder="Ej: 84,44"
                [value]="formData['porcentajeSIS'] || ''"
                (input)="onFieldChange('porcentajeSIS', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Porcentaje ESSALUD (%)</label>
              <input type="text" class="input" placeholder="Ej: 3,56"
                [value]="formData['porcentajeESSALUD'] || ''"
                (input)="onFieldChange('porcentajeESSALUD', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Porcentaje Sin Seguro (%)</label>
              <input type="text" class="input" placeholder="Ej: 12,00"
                [value]="formData['porcentajeSinSeguro'] || ''"
                (input)="onFieldChange('porcentajeSinSeguro', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Tabla Población según Tipo de Seguro de Salud</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.afiliacionSaludTabla || datos.seguroSaludTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAfiliacionSalud(i, 'categoria', $any($event.target).value)"
                        placeholder="Seguro Integral de Salud (SIS)">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAfiliacionSalud(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAfiliacionSalud(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAfiliacionSalud(i)" *ngIf="((datos.afiliacionSaludTabla || datos.seguroSaludTabla || []).length > 1) && item.categoria !== 'Total referencial'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="(!datos.afiliacionSaludTabla || datos.afiliacionSaludTabla.length === 0) && (!datos.seguroSaludTabla || datos.seguroSaludTabla.length === 0)">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAfiliacionSalud()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAfiliacionSalud()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.10'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.10. Indicadores de educación</h4>
          <div class="form-field">
            <label class="label">Tabla Nivel Educativo de la Población</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.nivelEducativoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNivelEducativo(i, 'categoria', $any($event.target).value)"
                        placeholder="Sin nivel o Inicial">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNivelEducativo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNivelEducativo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNivelEducativo(i)" *ngIf="((datos.nivelEducativoTabla || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.nivelEducativoTabla || datos.nivelEducativoTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNivelEducativo()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNivelEducativo()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Tasa de Analfabetismo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Indicador</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.tasaAnalfabetismoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.indicador || ''"
                        (input)="actualizarTasaAnalfabetismo(i, 'indicador', $any($event.target).value)"
                        placeholder="Sabe leer y escribir">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTasaAnalfabetismo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTasaAnalfabetismo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTasaAnalfabetismo(i)" *ngIf="((datos.tasaAnalfabetismoTabla || []).length > 1) && item.indicador !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.tasaAnalfabetismoTabla || datos.tasaAnalfabetismoTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTasaAnalfabetismo()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTasaAnalfabetismo()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.11'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.11. Aspectos culturales (lenguas, dialectos, lugares)</h4>
          <div class="form-field">
            <label class="label">Tabla Lenguas Maternas</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.lenguasMaternasTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarLenguasMaternas(i, 'categoria', $any($event.target).value)"
                        placeholder="Castellano">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarLenguasMaternas(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarLenguasMaternas(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarLenguasMaternas(i)" *ngIf="((datos.lenguasMaternasTabla || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.lenguasMaternasTabla || datos.lenguasMaternasTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarLenguasMaternas()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarLenguasMaternas()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Religiones</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.religionesTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarReligiones(i, 'categoria', $any($event.target).value)"
                        placeholder="Católica">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarReligiones(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarReligiones(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarReligiones(i)" *ngIf="((datos.religionesTabla || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.religionesTabla || datos.religionesTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarReligiones()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarReligiones()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de la Iglesia</label>
            <app-image-upload
              [titulo]="formData['fotografiaIglesiaTitulo'] || ''"
              [fuente]="formData['fotografiaIglesiaFuente'] || ''"
              [previewInicial]="fotoIglesiaPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Iglesia Matriz del anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaIglesiaTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaIglesiaFuente', $event)"
              (imagenChange)="onImagenIglesiaChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.12'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.12. Uso de los suelos y de los recursos naturales</h4>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Ojo de Agua 1</label>
              <input type="text" class="input" placeholder="Ej: Quinsa Rumi"
                [value]="formData['ojosAgua1'] || ''"
                (input)="onFieldChange('ojosAgua1', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Ojo de Agua 2</label>
              <input type="text" class="input" placeholder="Ej: Pallalli"
                [value]="formData['ojosAgua2'] || ''"
                (input)="onFieldChange('ojosAgua2', $any($event.target).value)">
            </div>
          </div>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Río Agrícola</label>
              <input type="text" class="input" placeholder="Ej: Yuracyacu"
                [value]="formData['rioAgricola'] || ''"
                (input)="onFieldChange('rioAgricola', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Quebrada Agrícola</label>
              <input type="text" class="input" placeholder="Ej: Pucaccocha"
                [value]="formData['quebradaAgricola'] || ''"
                (input)="onFieldChange('quebradaAgricola', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografía del Reservorio</label>
            <app-image-upload
              [titulo]="formData['fotografiaReservorioTitulo'] || ''"
              [fuente]="formData['fotografiaReservorioFuente'] || ''"
              [previewInicial]="fotoReservorioPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Reservorio del anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaReservorioTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaReservorioFuente', $event)"
              (imagenChange)="onImagenReservorioChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografía de Uso de Suelos</label>
            <app-image-upload
              [titulo]="formData['fotografiaUsoSuelosTitulo'] || ''"
              [fuente]="formData['fotografiaUsoSuelosFuente'] || ''"
              [previewInicial]="fotoUsoSuelosPreview"
              labelTitulo="Fotografía - Título"
              labelFuente="Fotografía - Fuente"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Uso de los suelos en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaUsoSuelosTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaUsoSuelosFuente', $event)"
              (imagenChange)="onImagenUsoSuelosChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.13'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.13. Índice de Desarrollo Humano distrital</h4>
          <div class="form-field">
            <label class="label">Tabla Componentes del IDH</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th colspan="2">Población</th>
                    <th colspan="2">Índice de Desarrollo Humano</th>
                    <th colspan="2">Esperanza de vida al nacer</th>
                    <th colspan="2">Con Educación secundaria completa (Población 18 años)</th>
                    <th colspan="2">Años de educación (Población 25 y más)</th>
                    <th colspan="2">Ingreso familiar per cápita</th>
                    <th></th>
                  </tr>
                  <tr>
                    <th>Habitantes</th>
                    <th>Rank</th>
                    <th>IDH</th>
                    <th>Rank</th>
                    <th>Años</th>
                    <th>Rank</th>
                    <th>Porcentaje</th>
                    <th>Rank</th>
                    <th>Años</th>
                    <th>Rank</th>
                    <th>N.S. mes</th>
                    <th>Rank</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.indiceDesarrolloHumanoTabla || []); let i = index">
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.poblacion || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'poblacion', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankIdh1 || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankIdh1', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.idh || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'idh', $any($event.target).value)"
                        placeholder="0,0000">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankEsperanza || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankEsperanza', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.esperanzaVida || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'esperanzaVida', $any($event.target).value)"
                        placeholder="0,00">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankEducacion1 || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankEducacion1', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.educacion || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'educacion', $any($event.target).value)"
                        placeholder="0,00">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankEducacion2 || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankEducacion2', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.anosEducacion || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'anosEducacion', $any($event.target).value)"
                        placeholder="0,00">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankAnios || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankAnios', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.ingreso || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'ingreso', $any($event.target).value)"
                        placeholder="0,0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankIngreso || item.rankIngresoFinal || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankIngreso', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarIndiceDesarrolloHumano(i)" *ngIf="(datos.indiceDesarrolloHumanoTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.indiceDesarrolloHumanoTabla || datos.indiceDesarrolloHumanoTabla.length === 0">
                    <td colspan="13" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarIndiceDesarrolloHumano()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarIndiceDesarrolloHumano()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.14'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.14. Índice de necesidades básicas insatisfechas distrital</h4>
          
          <div class="form-field">
            <label class="label">Tabla NBI según población - CC Ayroca (Cuadro N° 3.35)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.nbiCCAyrocaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNBICCAyroca(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Población en Viviendas con hacinamiento">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNBICCAyroca(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNBICCAyroca(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNBICCAyroca(i)" *ngIf="(datos.nbiCCAyrocaTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.nbiCCAyrocaTabla || datos.nbiCCAyrocaTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNBICCAyroca()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNBICCAyroca()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tipos de NBI existentes - Distrito Cahuacho (Cuadro N° 3.36)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.nbiDistritoCahuachoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNBIDistritoCahuacho(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Viviendas sin servicios higiénicos">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNBIDistritoCahuacho(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNBIDistritoCahuacho(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNBIDistritoCahuacho(i)" *ngIf="(datos.nbiDistritoCahuachoTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.nbiDistritoCahuachoTabla || datos.nbiDistritoCahuachoTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNBIDistritoCahuacho()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNBIDistritoCahuacho()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.15'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.15. Organización social y liderazgo</h4>
          
          <div class="form-field">
            <label class="label">Comuneros calificados</label>
            <input type="number" class="form-control" 
              [value]="datos.comunerosCalificados || ''"
              (input)="onFieldChange('comunerosCalificados', $any($event.target).value)"
              placeholder="Ej: 65">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Autoridades y líderes sociales – CC Ayroca (Cuadro N° 3.37)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Organización</th>
                    <th>Cargo</th>
                    <th>Nombres y Apellidos</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.autoridades || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.organizacion || ''"
                        (input)="actualizarAutoridades(i, 'organizacion', $any($event.target).value)"
                        placeholder="Ej: CC Ayroca (2024-2025)">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.cargo || ''"
                        (input)="actualizarAutoridades(i, 'cargo', $any($event.target).value)"
                        placeholder="Ej: Presidente">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombre || ''"
                        (input)="actualizarAutoridades(i, 'nombre', $any($event.target).value)"
                        placeholder="Ej: Miguel Ángel Sayaverde Rospigliosi">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAutoridades(i)" *ngIf="(datos.autoridades || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.autoridades || datos.autoridades.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAutoridades()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAutoridades()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.A.1.16'">
        <div class="form-group-section">
          <h4 class="section-title">A.1.16. Festividades, Costumbres y Turismo</h4>
          
          <div class="form-field">
            <label class="label">Sitio arqueológico</label>
            <input type="text" class="form-control" 
              [value]="datos.sitioArqueologico || ''"
              (input)="onFieldChange('sitioArqueologico', $any($event.target).value)"
              placeholder="Ej: Incahuasi">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Festividades principales – CC Ayroca (Cuadro N° 3.38)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Festividad</th>
                    <th>Fecha</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.festividades || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.festividad || ''"
                        (input)="actualizarFestividades(i, 'festividad', $any($event.target).value)"
                        placeholder="Ej: Carnavales">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.fecha || ''"
                        (input)="actualizarFestividades(i, 'fecha', $any($event.target).value)"
                        placeholder="Ej: Febrero">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarFestividades(i)" *ngIf="(datos.festividades || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.festividades || datos.festividades.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarFestividades()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarFestividades()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B' || seccionId === '3.1.4.B.1'">
        <div class="form-group-section">
          <h4 class="section-title">B. Caracterización socioeconómica del Área de Influencia Social Indirecta (AISI) y B.1. Centro Poblado Cahuacho</h4>
          
          <div class="form-field">
            <label class="label">Centro Poblado AISI</label>
            <input type="text" class="form-control" 
              [value]="datos.centroPobladoAISI || ''"
              (input)="onFieldChange('centroPobladoAISI', $any($event.target).value)"
              placeholder="Ej: Cahuacho">
          </div>

          <div class="form-field">
            <label class="label">Ley de creación del distrito</label>
            <input type="text" class="form-control" 
              [value]="datos.leyCreacionDistrito || ''"
              (input)="onFieldChange('leyCreacionDistrito', $any($event.target).value)"
              placeholder="Ej: 8004">
          </div>

          <div class="form-field">
            <label class="label">Fecha de creación del distrito</label>
            <input type="text" class="form-control" 
              [value]="datos.fechaCreacionDistrito || ''"
              (input)="onFieldChange('fechaCreacionDistrito', $any($event.target).value)"
              placeholder="Ej: 22 de febrero de 1935">
          </div>

          <div class="form-field">
            <label class="label">Distrito anterior</label>
            <input type="text" class="form-control" 
              [value]="datos.distritoAnterior || ''"
              (input)="onFieldChange('distritoAnterior', $any($event.target).value)"
              placeholder="Ej: Caravelí">
          </div>

          <div class="form-field">
            <label class="label">Origen de pobladores 1</label>
            <input type="text" class="form-control" 
              [value]="datos.origenPobladores1 || ''"
              (input)="onFieldChange('origenPobladores1', $any($event.target).value)"
              placeholder="Ej: Caravelí">
          </div>

          <div class="form-field">
            <label class="label">Origen de pobladores 2 (Provincia)</label>
            <input type="text" class="form-control" 
              [value]="datos.origenPobladores2 || ''"
              (input)="onFieldChange('origenPobladores2', $any($event.target).value)"
              placeholder="Ej: Parinacochas">
          </div>

          <div class="form-field">
            <label class="label">Departamento de origen</label>
            <input type="text" class="form-control" 
              [value]="datos.departamentoOrigen || ''"
              (input)="onFieldChange('departamentoOrigen', $any($event.target).value)"
              placeholder="Ej: Ayacucho">
          </div>

          <div class="form-field">
            <label class="label">Anexos ejemplo</label>
            <input type="text" class="form-control" 
              [value]="datos.anexosEjemplo || ''"
              (input)="onFieldChange('anexosEjemplo', $any($event.target).value)"
              placeholder="Ej: Ayroca o Sóndor">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Ubicación referencial – Centro Poblado (Cuadro N° 3.39)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Localidad</th>
                    <th>Coordenadas</th>
                    <th>Altitud</th>
                    <th>Distrito</th>
                    <th>Provincia</th>
                    <th>Departamento</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.ubicacionCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.localidad || ''"
                        (input)="actualizarUbicacionCP(i, 'localidad', $any($event.target).value)"
                        placeholder="Ej: Cahuacho">
                    </td>
                    <td>
                      <textarea class="table-input" 
                        [value]="item.coordenadas || ''"
                        (input)="actualizarUbicacionCP(i, 'coordenadas', $any($event.target).value)"
                        placeholder="Ej: 18 L, E: 663 078 m, N: 8 285 498 m"
                        rows="2"></textarea>
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.altitud || ''"
                        (input)="actualizarUbicacionCP(i, 'altitud', $any($event.target).value)"
                        placeholder="Ej: 3 423 msnm">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.distrito || ''"
                        (input)="actualizarUbicacionCP(i, 'distrito', $any($event.target).value)"
                        placeholder="Ej: Cahuacho">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.provincia || ''"
                        (input)="actualizarUbicacionCP(i, 'provincia', $any($event.target).value)"
                        placeholder="Ej: Caravelí">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.departamento || ''"
                        (input)="actualizarUbicacionCP(i, 'departamento', $any($event.target).value)"
                        placeholder="Ej: Arequipa">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarUbicacionCP(i)" *ngIf="(datos.ubicacionCpTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.ubicacionCpTabla || datos.ubicacionCpTabla.length === 0">
                    <td colspan="7" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarUbicacionCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarUbicacionCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Vista panorámica del CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaCahuachoTitulo || ''"
              [fuente]="datos.fotografiaCahuachoFuente || ''"
              [previewInicial]="fotoCahuachoPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Vista panorámica del CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaCahuachoTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaCahuachoFuente', $event)"
              (imagenChange)="onImagenCahuachoChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.1'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.1. Aspectos demográficos</h4>
          
          <div class="form-field">
            <label class="label">Tabla Población por sexo – CP Cahuacho (Cuadro N° 3.40)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Sexo</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.poblacionSexoAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.sexo || ''"
                        (input)="actualizarPoblacionSexoAISI(i, 'sexo', $any($event.target).value)"
                        placeholder="Ej: Hombre">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionSexoAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionSexoAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPoblacionSexoAISI(i)" *ngIf="(datos.poblacionSexoAISI || []).length > 1 && !item.sexo?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.poblacionSexoAISI || datos.poblacionSexoAISI.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionSexoAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPoblacionSexoAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Población por grupo etario – CP Cahuacho (Cuadro N° 3.41)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.poblacionEtarioAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPoblacionEtarioAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: 0 a 14 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionEtarioAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionEtarioAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPoblacionEtarioAISI(i)" *ngIf="(datos.poblacionEtarioAISI || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.poblacionEtarioAISI || datos.poblacionEtarioAISI.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionEtarioAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPoblacionEtarioAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.2'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.2. Indicadores y distribución de la Población Económicamente Activa</h4>
          
          <div class="form-field">
            <label class="label">Población distrital</label>
            <input type="number" class="form-control" 
              [value]="datos.poblacionDistritalAISI || ''"
              (input)="onFieldChange('poblacionDistritalAISI', $any($event.target).value)"
              placeholder="Ej: 610">
          </div>

          <div class="form-field">
            <label class="label">PET distrital (14 años a más)</label>
            <input type="number" class="form-control" 
              [value]="datos.petDistritalAISI || ''"
              (input)="onFieldChange('petDistritalAISI', $any($event.target).value)"
              placeholder="Ej: 461">
          </div>

          <div class="form-field">
            <label class="label">Ingreso familiar per cápita (S/.)</label>
            <input type="text" class="form-control" 
              [value]="datos.ingresoPerCapitaAISI || ''"
              (input)="onFieldChange('ingresoPerCapitaAISI', $any($event.target).value)"
              placeholder="Ej: 391,06">
          </div>

          <div class="form-field">
            <label class="label">Ranking de ingreso</label>
            <input type="number" class="form-control" 
              [value]="datos.rankingIngresoAISI || ''"
              (input)="onFieldChange('rankingIngresoAISI', $any($event.target).value)"
              placeholder="Ej: 1191">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla PET según grupos de edad – CP Cahuacho (Cuadro N° 3.42)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.petGruposEdadAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPETGruposEdadAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: 14 a 29 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPETGruposEdadAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPETGruposEdadAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPETGruposEdadAISI(i)" *ngIf="(datos.petGruposEdadAISI || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.petGruposEdadAISI || datos.petGruposEdadAISI.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPETGruposEdadAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPETGruposEdadAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Conformación de la PEA y No PEA, según sexo – Distrito Cahuacho (Cuadro N° 3.43)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categorías</th>
                    <th>Hombres</th>
                    <th>Porcentaje</th>
                    <th>Mujeres</th>
                    <th>Porcentaje</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.peaDistritoSexoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEADistritoSexo(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: PEA">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEADistritoSexo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEADistritoSexo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEADistritoSexo(i)" *ngIf="(datos.peaDistritoSexoTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.peaDistritoSexoTabla || datos.peaDistritoSexoTabla.length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEADistritoSexo()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEADistritoSexo()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Conformación de la PEA Ocupada y Desocupada, según sexo – Distrito Cahuacho (Cuadro N° 3.44)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categorías</th>
                    <th>Hombres</th>
                    <th>Porcentaje</th>
                    <th>Mujeres</th>
                    <th>Porcentaje</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.peaOcupadaDesocupadaTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: PEA Ocupada">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEAOcupadaDesocupada(i)" *ngIf="(datos.peaOcupadaDesocupadaTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.peaOcupadaDesocupadaTabla || datos.peaOcupadaDesocupadaTabla.length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupadaDesocupada()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupadaDesocupada()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.3'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.3. Actividades económicas de la población</h4>
          
          <div class="form-field">
            <label class="label">Ciudad de origen del comercio</label>
            <input type="text" class="form-control" 
              [value]="datos.ciudadOrigenComercio || ''"
              (input)="onFieldChange('ciudadOrigenComercio', $any($event.target).value)"
              placeholder="Ej: Caravelí">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla PEA Ocupada según actividad económica – CP Cahuacho (Cuadro N° 3.45)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Actividad Económica</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.actividadesEconomicasAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.actividad || ''"
                        (input)="actualizarActividadesEconomicasAISI(i, 'actividad', $any($event.target).value)"
                        placeholder="Ej: Agricultura, ganadería, silvicultura y pesca">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarActividadesEconomicasAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarActividadesEconomicasAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarActividadesEconomicasAISI(i)" *ngIf="(datos.actividadesEconomicasAISI || []).length > 1 && !item.actividad?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.actividadesEconomicasAISI || datos.actividadesEconomicasAISI.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarActividadesEconomicasAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarActividadesEconomicasAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Parcelas agrícolas en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaActividadesEconomicasTitulo || ''"
              [fuente]="datos.fotografiaActividadesEconomicasFuente || ''"
              [previewInicial]="fotoActividadesEconomicasPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Parcelas agrícolas en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaActividadesEconomicasTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaActividadesEconomicasFuente', $event)"
              (imagenChange)="onImagenActividadesEconomicasChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Bodega en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaMercadoTitulo || ''"
              [fuente]="datos.fotografiaMercadoFuente || ''"
              [previewInicial]="fotoMercadoPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Bodega en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaMercadoTitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaMercadoFuente', $event)"
              (imagenChange)="onImagenMercadoChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.4'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.4. Vivienda</h4>
          
          <div class="form-field">
            <label class="label">Tabla Tipos de Vivienda – CP Cahuacho (Cuadro N° 3.46)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.tiposViviendaAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarTiposViviendaAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Casa independiente">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTiposViviendaAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTiposViviendaAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTiposViviendaAISI(i)" *ngIf="(datos.tiposViviendaAISI || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.tiposViviendaAISI || datos.tiposViviendaAISI.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTiposViviendaAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTiposViviendaAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Condición de Ocupación de la Vivienda – CP Cahuacho (Cuadro N° 3.47)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.condicionOcupacionAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCondicionOcupacionAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Ocupada, con personas presentes">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCondicionOcupacionAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCondicionOcupacionAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCondicionOcupacionAISI(i)" *ngIf="(datos.condicionOcupacionAISI || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.condicionOcupacionAISI || datos.condicionOcupacionAISI.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCondicionOcupacionAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCondicionOcupacionAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tipos de materiales de las viviendas – CP Cahuacho (Cuadro N° 3.48)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Tipo de material</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.materialesViviendaAISI || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Materiales de las paredes de las viviendas">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.tipoMaterial || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'tipoMaterial', $any($event.target).value)"
                        placeholder="Ej: Adobe">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarMaterialesViviendaAISI(i)" *ngIf="(datos.materialesViviendaAISI || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.materialesViviendaAISI || datos.materialesViviendaAISI.length === 0">
                    <td colspan="5" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarMaterialesViviendaAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarMaterialesViviendaAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Estructura de viviendas en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaEstructuraAISITitulo || ''"
              [fuente]="datos.fotografiaEstructuraAISIFuente || ''"
              [previewInicial]="fotoEstructuraAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Estructura de viviendas en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaEstructuraAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaEstructuraAISIFuente', $event)"
              (imagenChange)="onImagenEstructuraAISIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.5'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.5. Servicios básicos: Agua y desagüe; electricidad, energía y/o combustible; y disposición de residuos sólidos</h4>
          
          <div class="form-field">
            <label class="label">Tabla Tipos de abastecimiento de agua en las viviendas – CP Cahuacho (Cuadro N° 3.49)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.abastecimientoAguaCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAbastecimientoAguaCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Red pública dentro de la vivienda">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAbastecimientoAguaCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAbastecimientoAguaCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAbastecimientoAguaCP(i)" *ngIf="(datos.abastecimientoAguaCpTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.abastecimientoAguaCpTabla || datos.abastecimientoAguaCpTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAbastecimientoAguaCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAbastecimientoAguaCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tipos de saneamiento en las viviendas – CP Cahuacho (Cuadro N° 3.50)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.saneamientoCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarSaneamientoCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Red pública de desagüe dentro de la vivienda">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarSaneamientoCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarSaneamientoCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarSaneamientoCP(i)" *ngIf="(datos.saneamientoCpTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.saneamientoCpTabla || datos.saneamientoCpTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarSaneamientoCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarSaneamientoCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Contenedores de residuos sólidos en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaDesechosSolidosAISITitulo || ''"
              [fuente]="datos.fotografiaDesechosSolidosAISIFuente || ''"
              [previewInicial]="fotoDesechosSolidosAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Contenedores de residuos sólidos en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaDesechosSolidosAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaDesechosSolidosAISIFuente', $event)"
              (imagenChange)="onImagenDesechosSolidosAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Cobertura de alumbrado eléctrico en las viviendas – CP Cahuacho (Cuadro N° 3.51)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.coberturaElectricaCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCoberturaElectricaCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Si tiene alumbrado eléctrico">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCoberturaElectricaCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCoberturaElectricaCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCoberturaElectricaCP(i)" *ngIf="(datos.coberturaElectricaCpTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.coberturaElectricaCpTabla || datos.coberturaElectricaCpTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCoberturaElectricaCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCoberturaElectricaCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura eléctrica en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaElectricidadAISITitulo || ''"
              [fuente]="datos.fotografiaElectricidadAISIFuente || ''"
              [previewInicial]="fotoElectricidadAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura eléctrica en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaElectricidadAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaElectricidadAISIFuente', $event)"
              (imagenChange)="onImagenElectricidadAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Combustibles para cocción en los hogares – CP Cahuacho (Cuadro N° 3.52)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.combustiblesCocinarCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCombustiblesCocinarCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Leña">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCombustiblesCocinarCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCombustiblesCocinarCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCombustiblesCocinarCP(i)" *ngIf="(datos.combustiblesCocinarCpTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.combustiblesCocinarCpTabla || datos.combustiblesCocinarCpTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCombustiblesCocinarCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCombustiblesCocinarCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.6'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.6. Infraestructura para transportes y comunicaciones</h4>
          
          <div class="form-field">
            <label class="label">Costo mínimo de transporte (S/.)</label>
            <input type="number" class="form-control" 
              [value]="datos.costoTransporteMinimo || ''"
              (input)="onFieldChange('costoTransporteMinimo', $any($event.target).value)"
              placeholder="Ej: 25">
          </div>

          <div class="form-field">
            <label class="label">Costo máximo de transporte (S/.)</label>
            <input type="number" class="form-control" 
              [value]="datos.costoTransporteMaximo || ''"
              (input)="onFieldChange('costoTransporteMaximo', $any($event.target).value)"
              placeholder="Ej: 30">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura de transporte en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaTransporteAISITitulo || ''"
              [fuente]="datos.fotografiaTransporteAISIFuente || ''"
              [previewInicial]="fotoTransporteAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de transporte en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaTransporteAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaTransporteAISIFuente', $event)"
              (imagenChange)="onImagenTransporteAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Servicios de telecomunicaciones – CP Cahuacho (Cuadro N° 3.54)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Medio de comunicación</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.telecomunicacionesCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.medio || ''"
                        (input)="actualizarTelecomunicacionesCP(i, 'medio', $any($event.target).value)"
                        placeholder="Ej: Emisoras de radio">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.descripcion || ''"
                        (input)="actualizarTelecomunicacionesCP(i, 'descripcion', $any($event.target).value)"
                        placeholder="Ej: RPP, Nacional, Unión">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTelecomunicacionesCP(i)" *ngIf="(datos.telecomunicacionesCpTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.telecomunicacionesCpTabla || datos.telecomunicacionesCpTabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTelecomunicacionesCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTelecomunicacionesCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura de telecomunicaciones en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaTelecomunicacionesAISITitulo || ''"
              [fuente]="datos.fotografiaTelecomunicacionesAISIFuente || ''"
              [previewInicial]="fotoTelecomunicacionesAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de telecomunicaciones en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaTelecomunicacionesAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaTelecomunicacionesAISIFuente', $event)"
              (imagenChange)="onImagenTelecomunicacionesAISIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.7'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.7. Infraestructura en salud, educación, recreativa y deportiva</h4>
          
          <div class="form-field">
            <label class="label">Tabla Principales características del Puesto de Salud Cahuacho (Cuadro N° 3.55)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.puestoSaludCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPuestoSaludCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Nombre">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.descripcion || ''"
                        (input)="actualizarPuestoSaludCP(i, 'descripcion', $any($event.target).value)"
                        placeholder="Ej: Puesto de Salud Cahuacho">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPuestoSaludCP(i)" *ngIf="(datos.puestoSaludCpTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.puestoSaludCpTabla || datos.puestoSaludCpTabla.length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPuestoSaludCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPuestoSaludCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura del Puesto de Salud Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaSaludAISITitulo || ''"
              [fuente]="datos.fotografiaSaludAISIFuente || ''"
              [previewInicial]="fotoSaludAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura del Puesto de Salud Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaSaludAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaSaludAISIFuente', $event)"
              (imagenChange)="onImagenSaludAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Nombre de la IE con mayor cantidad de estudiantes</label>
            <input type="text" class="form-control" 
              [value]="datos.nombreIEMayorEstudiantes || ''"
              (input)="onFieldChange('nombreIEMayorEstudiantes', $any($event.target).value)"
              placeholder="Ej: IE Virgen de Copacabana">
          </div>

          <div class="form-field">
            <label class="label">Cantidad de estudiantes de la IE con mayor cantidad</label>
            <input type="number" class="form-control" 
              [value]="datos.cantidadEstudiantesIEMayor || ''"
              (input)="onFieldChange('cantidadEstudiantesIEMayor', $any($event.target).value)"
              placeholder="Ej: 28">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Infraestructura educativa – CP Cahuacho (Cuadro N° 3.56)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Nombre de IE</th>
                    <th>Nivel</th>
                    <th>Tipo de Gestión</th>
                    <th>Cantidad de estudiantes</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.educacionCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombreIE || ''"
                        (input)="actualizarEducacionCP(i, 'nombreIE', $any($event.target).value)"
                        placeholder="Ej: IE Cahuacho">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarEducacionCP(i, 'nivel', $any($event.target).value)"
                        placeholder="Ej: Inicial - Jardín">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.tipoGestion || ''"
                        (input)="actualizarEducacionCP(i, 'tipoGestion', $any($event.target).value)"
                        placeholder="Ej: Pública de gestión directa">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cantidadEstudiantes || ''"
                        (input)="actualizarEducacionCP(i, 'cantidadEstudiantes', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarEducacionCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarEducacionCP(i)" *ngIf="(datos.educacionCpTabla || []).length > 1 && !item.nombreIE?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.educacionCpTabla || datos.educacionCpTabla.length === 0">
                    <td colspan="6" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarEducacionCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarEducacionCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía 1 - Infraestructura de la IE Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaEducacion1AISITitulo || ''"
              [fuente]="datos.fotografiaEducacion1AISIFuente || ''"
              [previewInicial]="fotoEducacion1AISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de la IE Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              (tituloChange)="onFieldChange('fotografiaEducacion1AISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaEducacion1AISIFuente', $event)"
              (imagenChange)="onImagenEducacion1AISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía 2 - Infraestructura de la IE N°40271</label>
            <app-image-upload
              [titulo]="datos.fotografiaEducacion2AISITitulo || ''"
              [fuente]="datos.fotografiaEducacion2AISIFuente || ''"
              [previewInicial]="fotoEducacion2AISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de la IE N°40271"
              placeholderFuente="Ej: GEADES, 2024"
              (tituloChange)="onFieldChange('fotografiaEducacion2AISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaEducacion2AISIFuente', $event)"
              (imagenChange)="onImagenEducacion2AISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía 3 - Infraestructura de la IE Virgen de Copacabana</label>
            <app-image-upload
              [titulo]="datos.fotografiaEducacion3AISITitulo || ''"
              [fuente]="datos.fotografiaEducacion3AISIFuente || ''"
              [previewInicial]="fotoEducacion3AISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de la IE Virgen de Copacabana"
              placeholderFuente="Ej: GEADES, 2024"
              (tituloChange)="onFieldChange('fotografiaEducacion3AISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaEducacion3AISIFuente', $event)"
              (imagenChange)="onImagenEducacion3AISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Plaza de toros del CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaRecreacionAISITitulo || ''"
              [fuente]="datos.fotografiaRecreacionAISIFuente || ''"
              [previewInicial]="fotoRecreacionAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Plaza de toros del CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaRecreacionAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaRecreacionAISIFuente', $event)"
              (imagenChange)="onImagenRecreacionAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Losa deportiva en el CP Cahuacho</label>
            <app-image-upload
              [titulo]="datos.fotografiaDeporteAISITitulo || ''"
              [fuente]="datos.fotografiaDeporteAISIFuente || ''"
              [previewInicial]="fotoDeporteAISIPreview"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Losa deportiva en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              [requerido]="true"
              (tituloChange)="onFieldChange('fotografiaDeporteAISITitulo', $event)"
              (fuenteChange)="onFieldChange('fotografiaDeporteAISIFuente', $event)"
              (imagenChange)="onImagenDeporteAISIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.8'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.8. Indicadores de salud</h4>
          
          <div class="form-field">
            <label class="label">Tabla Indicadores de natalidad y mortalidad – CP Cahuacho (Cuadro N° 3.57)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Año</th>
                    <th>Natalidad</th>
                    <th>Mortalidad</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.natalidadMortalidadCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.anio || ''"
                        (input)="actualizarNatalidadMortalidadCP(i, 'anio', $any($event.target).value)"
                        placeholder="Ej: 2023">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.natalidad || ''"
                        (input)="actualizarNatalidadMortalidadCP(i, 'natalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mortalidad || ''"
                        (input)="actualizarNatalidadMortalidadCP(i, 'mortalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNatalidadMortalidadCP(i)" *ngIf="(datos.natalidadMortalidadCpTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.natalidadMortalidadCpTabla || datos.natalidadMortalidadCpTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNatalidadMortalidadCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNatalidadMortalidadCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Casos por grupos de morbilidad – Distrito Cahuacho (Cuadro N° 3.58)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Grupo de Morbilidad</th>
                    <th colspan="5">Bloques etarios</th>
                    <th rowspan="2">Casos Totales</th>
                    <th rowspan="2"></th>
                  </tr>
                  <tr>
                    <th>0 – 11</th>
                    <th>12 – 17</th>
                    <th>18 – 29</th>
                    <th>30 – 59</th>
                    <th>60 - ></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.morbilidadCpTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.grupo || ''"
                        (input)="actualizarMorbilidadCP(i, 'grupo', $any($event.target).value)"
                        placeholder="Ej: Enfermedades infecciosas intestinales">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad0_11 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad0_11', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad12_17 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad12_17', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad18_29 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad18_29', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad30_59 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad30_59', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad60_mas || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad60_mas', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarMorbilidadCP(i, 'casos', $any($event.target).value)"
                        placeholder="0"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarMorbilidadCP(i)" *ngIf="(datos.morbilidadCpTabla || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.morbilidadCpTabla || datos.morbilidadCpTabla.length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarMorbilidadCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarMorbilidadCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Población según tipo de seguro de salud afiliado – CP Cahuacho (Cuadro N° 3.59)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.afiliacionSaludTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAfiliacionSaludTabla(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Seguro Integral de Salud (SIS)">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAfiliacionSaludTabla(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAfiliacionSaludTabla(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAfiliacionSaludTabla(i)" *ngIf="(datos.afiliacionSaludTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.afiliacionSaludTabla || datos.afiliacionSaludTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAfiliacionSaludTabla()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAfiliacionSaludTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.9'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.9. Indicadores de educación</h4>
          
          <div class="form-field">
            <label class="label">Tabla Población de 15 años a más según nivel educativo alcanzado – CP Cahuacho (Cuadro N° 3.60)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.nivelEducativoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNivelEducativoTabla(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Sin nivel o Inicial">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNivelEducativoTabla(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNivelEducativoTabla(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNivelEducativoTabla(i)" *ngIf="(datos.nivelEducativoTabla || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.nivelEducativoTabla || datos.nivelEducativoTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNivelEducativoTabla()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNivelEducativoTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tasa de analfabetismo en población de 15 años a más – CP Cahuacho (Cuadro N° 3.61)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Indicador</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.tasaAnalfabetismoTabla || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.indicador || ''"
                        (input)="actualizarTasaAnalfabetismoTabla(i, 'indicador', $any($event.target).value)"
                        placeholder="Ej: Sabe leer y escribir">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTasaAnalfabetismoTabla(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTasaAnalfabetismoTabla(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTasaAnalfabetismoTabla(i)" *ngIf="(datos.tasaAnalfabetismoTabla || []).length > 1 && !item.indicador?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.tasaAnalfabetismoTabla || datos.tasaAnalfabetismoTabla.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTasaAnalfabetismoTabla()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTasaAnalfabetismoTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <!-- Formulario por defecto para otras secciones -->
      <ng-template #defaultForm>
        <div class="form-section" *ngFor="let field of sectionFields">
          <label class="label">
            {{ field.label }}
            <span *ngIf="field.required" class="required">*</span>
          </label>
          
          <input 
            *ngIf="field.type === 'text'"
            type="text" 
            class="input" 
            [placeholder]="field.placeholder"
            [value]="formData[field.id]"
            (input)="onFieldChange(field.id, $any($event.target).value)"
            (blur)="field.id === 'projectName' ? onFieldChange(field.id, formData[field.id]) : null">
        
        <div *ngIf="field.type === 'autocomplete' && field.id === 'distritoSeleccionado'" class="autocomplete-wrapper">
          <input 
            type="text" 
            class="input" 
            [placeholder]="field.placeholder"
            [value]="distritoBuscado || formData[field.id] || ''"
            (input)="onDistritoInput($any($event.target).value)"
            (focus)="distritoBuscado && distritoBuscado.length >= 2 && distritosSugeridos.length > 0 ? mostrarSugerencias = true : null">
          
          <div *ngIf="mostrarSugerencias && distritosSugeridos.length > 0" 
               class="autocomplete-dropdown"
               (mouseenter)="mostrarSugerencias = true"
               (mouseleave)="cerrarSugerencias()">
            <div 
              *ngFor="let distrito of distritosSugeridos" 
              class="autocomplete-item"
              (mousedown)="seleccionarDistrito(distrito)"
              (click)="seleccionarDistrito(distrito)">
              {{ distrito }}
            </div>
          </div>
        </div>
        
        <div *ngIf="field.type === 'autocomplete' && field.id !== 'distritoSeleccionado'" class="autocomplete-wrapper">
          <input 
            type="text" 
            class="input" 
            [placeholder]="field.placeholder"
            [value]="(autocompleteData[field.id]?.buscado || formData[field.id] || '')"
            (input)="onAutocompleteInput(field.id, $any($event.target).value)"
            (focus)="autocompleteData[field.id]?.buscado && autocompleteData[field.id].buscado.length >= 2 && autocompleteData[field.id].sugerencias.length > 0 ? autocompleteData[field.id].mostrar = true : null">
          
          <div *ngIf="autocompleteData[field.id]?.mostrar && autocompleteData[field.id].sugerencias.length > 0" 
               class="autocomplete-dropdown"
               (mouseenter)="autocompleteData[field.id].mostrar = true"
               (mouseleave)="cerrarSugerenciasAutocomplete(field.id)">
            <div 
              *ngFor="let sugerencia of autocompleteData[field.id].sugerencias" 
              class="autocomplete-item"
              (mousedown)="seleccionarSugerencia(field.id, sugerencia)"
              (click)="seleccionarSugerencia(field.id, sugerencia)">
              {{ sugerencia }}
            </div>
          </div>
        </div>
        
        <select
          *ngIf="field.type === 'select' && field.id === 'provinciaSeleccionada'"
          class="input"
          [value]="formData[field.id]"
          (change)="onFieldChange(field.id, $any($event.target).value)"
          [disabled]="!formData['distritoSeleccionado']">
          <option value="">{{ field.placeholder }}</option>
          <option *ngFor="let provincia of provincias" [value]="provincia">{{ provincia }}</option>
        </select>
        
        <select
          *ngIf="field.type === 'select' && field.id === 'departamentoSeleccionado'"
          class="input"
          [value]="formData[field.id]"
          (change)="onFieldChange(field.id, $any($event.target).value)"
          [disabled]="!formData['distritoSeleccionado']">
          <option value="">{{ field.placeholder }}</option>
          <option *ngFor="let departamento of departamentos" [value]="departamento">{{ departamento }}</option>
        </select>
        
        <textarea 
          *ngIf="field.type === 'textarea'"
          class="textarea" 
          [placeholder]="field.placeholder"
          [value]="formData[field.id]"
          (input)="onFieldChange(field.id, $any($event.target).value)"></textarea>
        
        <div *ngIf="loadingOptions[field.id]" class="loading-indicator">
          <span>Cargando datos del backend...</span>
        </div>
      </div>
      </ng-template>
    </div>

    <div class="formulario-footer">
      <button class="btn btn-ghost" (click)="seccionAnterior()" [disabled]="!puedeIrAnterior">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        Anterior
      </button>
      <button class="btn btn-primary" (click)="seccionSiguiente()" [disabled]="!puedeIrSiguiente">
        Siguiente
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>
    </div>
  </div>
</div>

