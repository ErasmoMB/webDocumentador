<div class="seccion-container">
  <div class="seccion-preview" [style.flex]="previewFlex">
    <div class="preview-header">
      <div class="preview-header-titles">
        <h3 *ngIf="seccionPadreTitulo" class="seccion-padre-titulo">{{ seccionPadreTitulo }}</h3>
        <h2>{{ seccionTitulo }}</h2>
      </div>
      <div class="preview-actions">
        <button class="btn btn-clear" (click)="limpiarDatos()" title="Limpiar todos los datos guardados">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12c0 1.66-1.34 3-3 3H6c-1.66 0-3-1.34-3-3s1.34-3 3-3h12c1.66 0 3 1.34 3 3z"/>
            <path d="M9 9V6c0-1.1.9-2 2-2h2c1.1 0 2 .9 2 2v3"/>
            <path d="M12 9v9"/>
            <path d="M8 9h8"/>
          </svg>
          Limpiar
        </button>
        <button class="btn btn-test" (click)="llenarDatosPrueba()" title="Llenar todos los campos con datos de prueba">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          Llenar Prueba
        </button>
        <button class="btn btn-ghost" (click)="irAPlantilla()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          Ver Plantilla Completa
        </button>
      </div>
    </div>
    <div class="preview-content scrollbar-thin">
      <div class="preview-document">
        <!-- Usar componente seccion1 para la sección 3.1.1 -->
        <div class="preview preview-static" *ngIf="seccionId === '3.1.1'">
          <div class="viewport-content">
            <app-seccion1></app-seccion1>
          </div>
        </div>
        <!-- Usar componente seccion2 para la sección 3.1.2, 3.1.2.A y 3.1.2.B -->
        <div class="preview preview-static" *ngIf="seccionId === '3.1.2' || seccionId === '3.1.2.A' || seccionId === '3.1.2.B'">
          <div class="viewport-content">
            <app-seccion2></app-seccion2>
          </div>
        </div>
        <!-- Usar componente seccion3 para la sección 3.1.3 -->
        <div class="preview preview-static" *ngIf="seccionId === '3.1.3' || seccionId === '3.1.3.A' || seccionId === '3.1.3.B'">
          <div class="viewport-content">
            <app-seccion3></app-seccion3>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.A' || seccionId === '3.1.4.A.1' || seccionId === '3.1.4.A.2'">
          <div class="viewport-content">
            <app-seccion4 [seccionId]="seccionId"></app-seccion4>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 1)">
          <div class="viewport-content">
            <app-seccion5 [seccionId]="seccionId"></app-seccion5>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 2)">
          <div class="viewport-content">
            <app-seccion6 [seccionId]="seccionId"></app-seccion6>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 3)">
          <div class="viewport-content">
            <app-seccion7 [seccionId]="seccionId"></app-seccion7>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 4)">
          <div class="viewport-content">
            <app-seccion8 [seccionId]="seccionId"></app-seccion8>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 5)">
          <div class="viewport-content">
            <app-seccion9 [seccionId]="seccionId"></app-seccion9>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 6)">
          <div class="viewport-content">
            <app-seccion10 [seccionId]="seccionId"></app-seccion10>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 7)">
          <div class="viewport-content">
            <app-seccion11 [seccionId]="seccionId"></app-seccion11>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 8)">
          <div class="viewport-content">
            <app-seccion12 [seccionId]="seccionId"></app-seccion12>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 9)">
          <div class="viewport-content">
            <app-seccion13 [seccionId]="seccionId"></app-seccion13>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 10)">
          <div class="viewport-content">
            <app-seccion14 [seccionId]="seccionId"></app-seccion14>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 11)">
          <div class="viewport-content">
            <app-seccion15 [seccionId]="seccionId"></app-seccion15>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 12)">
          <div class="viewport-content">
            <app-seccion16 [seccionId]="seccionId"></app-seccion16>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 13)">
          <div class="viewport-content">
            <app-seccion17 [seccionId]="seccionId"></app-seccion17>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 14)">
          <div class="viewport-content">
            <app-seccion18 [seccionId]="seccionId"></app-seccion18>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 15)">
          <div class="viewport-content">
            <app-seccion19 [seccionId]="seccionId"></app-seccion19>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="esSubseccionAISD(seccionId, 16)">
          <div class="viewport-content">
            <app-seccion20 [seccionId]="seccionId"></app-seccion20>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B' || seccionId === '3.1.4.B.1' || seccionId === '3.1.4.B.2'">
          <div class="viewport-content">
            <app-seccion21></app-seccion21>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.1' || seccionId === '3.1.4.B.2.1'">
          <div class="viewport-content">
            <app-seccion22 [seccionId]="seccionId"></app-seccion22>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.2' || seccionId === '3.1.4.B.2.2'">
          <div class="viewport-content">
            <app-seccion23 [seccionId]="seccionId"></app-seccion23>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.3' || seccionId === '3.1.4.B.2.3'">
          <div class="viewport-content">
            <app-seccion24 [seccionId]="seccionId"></app-seccion24>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.4' || seccionId === '3.1.4.B.2.4'">
          <div class="viewport-content">
            <app-seccion25 [seccionId]="seccionId"></app-seccion25>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.5' || seccionId === '3.1.4.B.2.5'">
          <div class="viewport-content">
            <app-seccion26 [seccionId]="seccionId"></app-seccion26>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.6' || seccionId === '3.1.4.B.2.6'">
          <div class="viewport-content">
            <app-seccion27 [seccionId]="seccionId"></app-seccion27>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.7' || seccionId === '3.1.4.B.2.7'">
          <div class="viewport-content">
            <app-seccion28 [seccionId]="seccionId"></app-seccion28>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.8' || seccionId === '3.1.4.B.2.8'">
          <div class="viewport-content">
            <app-seccion29 [seccionId]="seccionId"></app-seccion29>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.9' || seccionId === '3.1.4.B.2.9'">
          <div class="viewport-content">
            <app-seccion30 [seccionId]="seccionId"></app-seccion30>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.10' || seccionId === '3.1.4.B.2.10'">
          <div class="viewport-content">
            <app-seccion31 [seccionId]="seccionId"></app-seccion31>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.11' || seccionId === '3.1.4.B.2.11'">
          <div class="viewport-content">
            <app-seccion32 [seccionId]="seccionId"></app-seccion32>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.12' || seccionId === '3.1.4.B.2.12'">
          <div class="viewport-content">
            <app-seccion33 [seccionId]="seccionId"></app-seccion33>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.13' || seccionId === '3.1.4.B.2.13'">
          <div class="viewport-content">
            <app-seccion34 [seccionId]="seccionId"></app-seccion34>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.14' || seccionId === '3.1.4.B.2.14'">
          <div class="viewport-content">
            <app-seccion35 [seccionId]="seccionId"></app-seccion35>
          </div>
        </div>
        <div class="preview preview-static" *ngIf="seccionId === '3.1.4.B.1.15' || seccionId === '3.1.4.B.2.15'">
          <div class="viewport-content">
            <app-seccion36 [seccionId]="seccionId"></app-seccion36>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="resizer" (mousedown)="startResize($event)" 
       [class.resizing]="isResizing"
       title="Arrastra para redimensionar"></div>

  <div class="seccion-formulario" [style.flex]="formularioFlex">
    <div class="formulario-header">
      <h3>Formulario de Datos</h3>
      <span class="badge badge-primary">{{ seccionTitulo }}</span>
    </div>
    <div class="formulario-content scrollbar-thin">
      <!-- Formulario especializado para 3.1.1 y 3.1.2 -->
      <ng-container *ngIf="seccionId === '3.1.1' || seccionId === '3.1.2' || seccionId === '3.1.2.A' || seccionId === '3.1.2.B'">
        <div class="form-group-section" *ngIf="seccionId === '3.1.1'">
          <h4 class="section-title">Información del Proyecto</h4>
          
          <div class="form-field">
            <label class="label">Nombre del Proyecto <span class="required">*</span></label>
            <input 
              type="text" 
              class="input" 
              placeholder="Ej: Paka"
              [value]="formData['projectName'] || ''"
              (input)="onFieldChange('projectName', $any($event.target).value)">
          </div>
        </div>

        <div class="form-group-section" *ngIf="seccionId === '3.1.1'">
          <h4 class="section-title">Cargar Datos de Centros Poblados</h4>
          
          <div class="form-field">
            <label class="label">Subir UBIGEO de Centro Poblado <span class="required">*</span></label>
            <div class="file-upload-wrapper">
              <input 
                type="file" 
                id="jsonFileInput" 
                accept=".json" 
                (change)="onJSONFileSelected($event)"
                style="display: none;">
              <button 
                type="button" 
                class="btn btn-secondary" 
                (click)="selectJSONFile()">
                Seleccionar archivo
              </button>
              <span *ngIf="jsonFileName" class="file-name">{{ jsonFileName }}</span>
              <span *ngIf="!jsonFileName" class="file-name">Ningún archivo seleccionado</span>
            </div>
            <small class="form-hint">Seleccione un archivo JSON con datos de centros poblados</small>
          </div>

          <div class="form-field" *ngIf="centrosPobladosJSON.length > 0">
            <label class="label">Información Geográfica</label>
            <div class="form-row">
              <div class="form-field">
                <label class="label">Departamento <span class="required">*</span></label>
                <input 
                  type="text" 
                  class="input" 
                  [value]="formData['departamentoSeleccionado'] || geoInfo.DPTO || ''"
                  [readonly]="!!geoInfo.DPTO"
                  (input)="onFieldChange('departamentoSeleccionado', $any($event.target).value)">
              </div>
              <div class="form-field">
                <label class="label">Provincia <span class="required">*</span></label>
                <input 
                  type="text" 
                  class="input" 
                  [value]="formData['provinciaSeleccionada'] || geoInfo.PROV || ''"
                  [readonly]="!!geoInfo.PROV"
                  (input)="onFieldChange('provinciaSeleccionada', $any($event.target).value)">
              </div>
              <div class="form-field">
                <label class="label">Distrito <span class="required">*</span></label>
                <input 
                  type="text" 
                  class="input" 
                  [value]="formData['distritoSeleccionado'] || geoInfo.DIST || ''"
                  [readonly]="!!geoInfo.DIST"
                  (input)="onFieldChange('distritoSeleccionado', $any($event.target).value)">
              </div>
            </div>
            <small class="form-hint">Esta información se completa automáticamente desde el JSON</small>
          </div>
        </div>

        <div class="form-group-section" *ngIf="seccionId === '3.1.1'">
          <h4 class="section-title">Editar Párrafos</h4>
          
          <div class="form-field">
            <label class="label">Párrafo Principal</label>
            <textarea 
              class="textarea" 
              rows="8"
              [value]="obtenerTextoParrafoPrincipal()"
              (input)="onFieldChange('parrafoSeccion1_principal', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
          </div>

          <div class="form-field">
            <label class="label">Introducción a Objetivos</label>
            <textarea 
              class="textarea" 
              rows="2"
              [value]="obtenerTextoIntroduccionObjetivos()"
              (input)="onFieldChange('parrafoSeccion1_4', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
          </div>

          <div class="form-field">
            <label class="label">Objetivo 1</label>
            <textarea 
              class="textarea" 
              rows="3"
              [value]="obtenerTextoObjetivo1()"
              (input)="onFieldChange('objetivoSeccion1_1', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
          </div>

          <div class="form-field">
            <label class="label">Objetivo 2</label>
            <textarea 
              class="textarea" 
              rows="4"
              [value]="obtenerTextoObjetivo2()"
              (input)="onFieldChange('objetivoSeccion1_2', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
          </div>

          <app-image-upload
            [fotografias]="fotografiasSeccion1FormMulti"
            [sectionId]="seccionId"
            [permitirMultiples]="true"
            labelTitulo="Título de la fotografía"
            labelFuente="Fuente de la fotografía"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Fotografía de la sección 1"
            placeholderFuente="Ej: GEADES, 2024"
            tituloDefault="Sección 1"
            fuenteDefault="GEADES, 2024"
            (fotografiasChange)="onFotografiasSeccion1Change($event)">
          </app-image-upload>
        </div>

        <div class="form-group-section" *ngIf="seccionId === '3.1.2' || seccionId === '3.1.2.A' || seccionId === '3.1.2.B'">
          <h4 class="section-title">Delimitación de Áreas de Influencia Social</h4>
          
          <div *ngFor="let comunidad of comunidadesCampesinas; let i = index" 
               style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; background-color: #f9f9f9;">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h5 style="margin: 0; color: #333;">Comunidad Campesina {{ i + 1 }}</h5>
              <button 
                type="button" 
                class="btn btn-danger" 
                (click)="eliminarComunidadCampesina(comunidad.id)"
                style="font-size: 12px; padding: 5px 10px;"
                *ngIf="comunidadesCampesinas.length > 1">
                Eliminar
              </button>
            </div>

            <div class="form-field" *ngIf="centrosPobladosJSON.length > 0">
              <label class="label">Seleccionar Centros Poblados para AISD <span class="required">*</span></label>
              <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button 
                  type="button" 
                  class="btn btn-secondary" 
                  (click)="seleccionarTodosCentrosPobladosComunidad(comunidad.id)" 
                  style="font-size: 12px; padding: 5px 10px;">
                  Seleccionar Todos
                </button>
                <button 
                  type="button" 
                  class="btn btn-secondary" 
                  (click)="deseleccionarTodosCentrosPobladosComunidad(comunidad.id)" 
                  style="font-size: 12px; padding: 5px 10px;">
                  Deseleccionar Todos
                </button>
              </div>
              <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background-color: white;">
                <div *ngFor="let cp of centrosPobladosJSON" 
                     style="display: flex; align-items: center; padding: 5px 0; border-bottom: 1px solid #f0f0f0;">
                  <input 
                    type="checkbox" 
                    [checked]="estaCentroPobladoSeleccionadoComunidad(comunidad.id, cp.CODIGO?.toString() || '')"
                    (change)="toggleCentroPobladoComunidad(comunidad.id, cp.CODIGO?.toString() || '')"
                    style="margin-right: 8px;">
                  <span style="flex: 1;">{{ cp.CCPP }}</span>
                </div>
              </div>
              <small class="form-hint">Seleccione los centros poblados que formarán parte del AISD. Debe seleccionar al menos uno.</small>
            </div>

            <div class="form-field">
              <label class="label">Comunidad Campesina (CC) AISD <span class="required">*</span></label>
              <input 
                type="text" 
                class="input" 
                placeholder="Ingrese el nombre de la comunidad campesina"
                [value]="comunidad.nombre"
                (input)="actualizarNombreComunidad(comunidad.id, $any($event.target).value)"
                [disabled]="obtenerCentrosPobladosSeleccionadosComunidad(comunidad.id).length === 0">
              <small class="form-hint">Asigne un nombre a la Comunidad Campesina. Primero seleccione los centros poblados.</small>
            </div>
          </div>

          <div style="margin-top: 20px;">
            <button 
              type="button" 
              class="btn btn-primary" 
              (click)="agregarComunidadCampesina()"
              style="font-size: 14px; padding: 10px 20px;">
              + Agregar Otra Comunidad Campesina
            </button>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label class="label">Distrito Adicional 1</label>
              <div class="autocomplete-wrapper">
                <input 
                  type="text" 
                  class="input" 
                  placeholder="Buscar distrito adicional..."
                  [value]="((autocompleteData['aisdComponente1'] && autocompleteData['aisdComponente1'].buscado) || formData['aisdComponente1'] || '')"
                  (input)="onAutocompleteInput('aisdComponente1', $any($event.target).value)"
                  (focus)="onFocusDistritoAdicional('aisdComponente1')"
                  [disabled]="false">
                
                <div *ngIf="autocompleteData['aisdComponente1'] && autocompleteData['aisdComponente1'].mostrar && autocompleteData['aisdComponente1'].sugerencias.length > 0" 
                     class="autocomplete-dropdown"
                     (mouseenter)="autocompleteData['aisdComponente1'].mostrar = true"
                     (mouseleave)="cerrarSugerenciasAutocomplete('aisdComponente1')">
                  <div 
                    *ngFor="let sugerencia of autocompleteData['aisdComponente1'].sugerencias" 
                    class="autocomplete-item"
                    (mousedown)="seleccionarSugerencia('aisdComponente1', sugerencia)"
                    (click)="seleccionarSugerencia('aisdComponente1', sugerencia)">
                    {{ sugerencia }}
                  </div>
                </div>
              </div>
              <small class="form-hint">Busca distritos de la provincia seleccionada</small>
            </div>
            <div class="form-field">
              <label class="label">Distrito Adicional 2</label>
              <div class="autocomplete-wrapper">
                <input 
                  type="text" 
                  class="input" 
                  placeholder="Buscar distrito adicional..."
                  [value]="((autocompleteData['aisdComponente2'] && autocompleteData['aisdComponente2'].buscado) || formData['aisdComponente2'] || '')"
                  (input)="onAutocompleteInput('aisdComponente2', $any($event.target).value)"
                  (focus)="onFocusDistritoAdicional('aisdComponente2')"
                  [disabled]="false">
                
                <div *ngIf="autocompleteData['aisdComponente2'] && autocompleteData['aisdComponente2'].mostrar && autocompleteData['aisdComponente2'].sugerencias.length > 0" 
                     class="autocomplete-dropdown"
                     (mouseenter)="autocompleteData['aisdComponente2'].mostrar = true"
                     (mouseleave)="cerrarSugerenciasAutocomplete('aisdComponente2')">
                  <div 
                    *ngFor="let sugerencia of autocompleteData['aisdComponente2'].sugerencias" 
                    class="autocomplete-item"
                    (mousedown)="seleccionarSugerencia('aisdComponente2', sugerencia)"
                    (click)="seleccionarSugerencia('aisdComponente2', sugerencia)">
                    {{ sugerencia }}
                  </div>
                </div>
              </div>
              <small class="form-hint">Busca distritos de la provincia seleccionada</small>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Formulario para IDH (Sección 17) y NBI (Sección 18) -->
      <ng-container *ngIf="seccionId?.includes('3.1.4.A.1.13') || seccionId?.includes('3.1.4.A.2.13') || seccionId?.includes('3.1.4.B.1.13') || seccionId?.includes('3.1.4.B.2.13') || seccionId?.includes('3.1.4.A.1.14') || seccionId?.includes('3.1.4.A.2.14') || seccionId?.includes('3.1.4.B.1.14') || seccionId?.includes('3.1.4.B.2.14')">
        <div class="form-group-section">
          <h4 class="section-title" *ngIf="seccionId?.includes('3.1.4.A.1.13') || seccionId?.includes('3.1.4.A.2.13') || seccionId?.includes('3.1.4.B.1.13') || seccionId?.includes('3.1.4.B.2.13')">Fotografías de Índice de Desarrollo Humano (IDH)</h4>
          <h4 class="section-title" *ngIf="seccionId?.includes('3.1.4.A.1.14') || seccionId?.includes('3.1.4.A.2.14') || seccionId?.includes('3.1.4.B.1.14') || seccionId?.includes('3.1.4.B.2.14')">Fotografías de Necesidades Básicas Insatisfechas (NBI)</h4>
          
          <div class="form-field" *ngIf="seccionId?.includes('3.1.4.A.1.13') || seccionId?.includes('3.1.4.A.2.13') || seccionId?.includes('3.1.4.B.1.13') || seccionId?.includes('3.1.4.B.2.13')">
            <label class="label">Fotografías de IDH</label>
            <app-image-upload
              [fotografias]="fotografiasIDHFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaIDH'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Índice de Desarrollo Humano"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Índice de Desarrollo Humano"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasIDHChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" *ngIf="seccionId?.includes('3.1.4.A.1.14') || seccionId?.includes('3.1.4.A.2.14') || seccionId?.includes('3.1.4.B.1.14') || seccionId?.includes('3.1.4.B.2.14')">
            <label class="label">Fotografías de NBI</label>
            <app-image-upload
              [fotografias]="fotografiasNBIFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaNBI'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Necesidades Básicas Insatisfechas"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Necesidades Básicas Insatisfechas"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasNBIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <!-- Continuación: Seleccionar Distritos para AISI (parte de 3.1.2) -->
      <ng-container *ngIf="seccionId === '3.1.2' || seccionId === '3.1.2.A' || seccionId === '3.1.2.B'">
        <div class="form-field" *ngIf="distritosDisponiblesAISI.length > 0">
            <label class="label">Seleccionar Distritos para AISI</label>
            <div style="margin-bottom: 10px;">
              <span class="badge badge-primary">{{ distritosDisponiblesAISI.length }} distrito(s) disponible(s)</span>
              <span class="badge badge-primary" style="margin-left: 10px;">{{ distritosSeleccionadosAISI.length }} seleccionado(s)</span>
            </div>
            <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px;">
              <div *ngFor="let distrito of distritosDisponiblesAISI" style="display: flex; align-items: center; padding: 5px 0; border-bottom: 1px solid #f0f0f0;">
                <input 
                  type="checkbox" 
                  [checked]="estaDistritoSeleccionadoAISI(distrito)"
                  (change)="toggleDistritoAISI(distrito)"
                  style="margin-right: 8px;">
                <span style="flex: 1;">{{ distrito }}</span>
              </div>
            </div>
            <small class="form-hint">Seleccione los distritos que formarán parte del AISI. Cada distrito seleccionado generará una sección B.X correspondiente.</small>
          </div>

          <div class="form-group-section">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Introducción - Delimitación de Áreas</label>
              <textarea 
                class="textarea" 
                rows="6"
                [value]="obtenerTextoSeccion2Introduccion()"
                (input)="onFieldChange('parrafoSeccion2_introduccion', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">A. Áreas de influencia social directa (AISD) - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="10"
                [value]="obtenerTextoSeccion2AISDCompleto()"
                (input)="onFieldChange('parrafoSeccion2_aisd_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto de AISD. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">B. Áreas de influencia social indirecta (AISI) - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="8"
                [value]="obtenerTextoSeccion2AISICompleto()"
                (input)="onFieldChange('parrafoSeccion2_aisi_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto de AISI. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>

          <app-image-upload
            [fotografias]="fotografiasSeccion2FormMulti"
            [sectionId]="seccionId"
            [permitirMultiples]="true"
            labelTitulo="Título de la fotografía"
            labelFuente="Fuente de la fotografía"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Fotografía de la sección 2"
            placeholderFuente="Ej: GEADES, 2024"
            tituloDefault="Sección 2"
            fuenteDefault="GEADES, 2024"
            (fotografiasChange)="onFotografiasSeccion2Change($event)">
          </app-image-upload>
      </ng-container>

      <!-- Formulario especializado para 3.1.4.B, 3.1.4.B.1 y 3.1.4.B.2 -->
      <ng-container *ngIf="seccionId === '3.1.4.B' || seccionId === '3.1.4.B.1' || seccionId === '3.1.4.B.2'">
        <div class="form-group-section">
          <h4 class="section-title">Información General del Centro Poblado</h4>
          
          <div class="form-field">
            <label class="label">Centro Poblado (CP) AISI <span class="required">*</span></label>
            <div class="autocomplete-wrapper">
              <input 
                type="text" 
                class="input" 
                placeholder="Buscar centro poblado..."
                [value]="((autocompleteData['centroPobladoAISI'] && autocompleteData['centroPobladoAISI'].buscado) || obtenerValorConPrefijo('centroPobladoAISI') || '')"
                (input)="onAutocompleteInput('centroPobladoAISI', $any($event.target).value)"
                (focus)="autocompleteData['centroPobladoAISI'] && autocompleteData['centroPobladoAISI'].buscado && autocompleteData['centroPobladoAISI'].buscado.length >= 2 && autocompleteData['centroPobladoAISI'].sugerencias.length > 0 ? autocompleteData['centroPobladoAISI'].mostrar = true : null"
                [disabled]="!formData['distritoSeleccionado'] || !formData['provinciaSeleccionada'] || !formData['departamentoSeleccionado']">
              
              <div *ngIf="autocompleteData['centroPobladoAISI'] && autocompleteData['centroPobladoAISI'].mostrar && autocompleteData['centroPobladoAISI'].sugerencias.length > 0" 
                   class="autocomplete-dropdown"
                   (mouseenter)="autocompleteData['centroPobladoAISI'].mostrar = true"
                   (mouseleave)="cerrarSugerenciasAutocomplete('centroPobladoAISI')">
                <div 
                  *ngFor="let sugerencia of autocompleteData['centroPobladoAISI'].sugerencias" 
                  class="autocomplete-item"
                  (mousedown)="seleccionarSugerencia('centroPobladoAISI', sugerencia)"
                  (click)="seleccionarSugerencia('centroPobladoAISI', sugerencia)">
                  {{ sugerencia }}
                </div>
              </div>
            </div>
            <small class="form-hint">Seleccione primero distrito, provincia y departamento para ver los centros poblados disponibles</small>
          </div>

          <div class="form-field">
            <label class="label">Distrito Principal <span class="required">*</span></label>
            <div class="autocomplete-wrapper">
              <input 
                type="text" 
                class="input" 
                placeholder="Buscar distrito..."
                [value]="distritoBuscado || formData['distritoSeleccionado'] || ''"
                (input)="onDistritoInput($any($event.target).value)"
                (focus)="distritoBuscado && distritoBuscado.length >= 2 && distritosSugeridos.length > 0 ? mostrarSugerencias = true : null">
              
              <div *ngIf="mostrarSugerencias && distritosSugeridos.length > 0" 
                   class="autocomplete-dropdown"
                   (mouseenter)="mostrarSugerencias = true"
                   (mouseleave)="mostrarSugerencias = false">
                <div 
                  *ngFor="let distrito of distritosSugeridos" 
                  class="autocomplete-item"
                  (mousedown)="seleccionarDistrito(distrito)"
                  (click)="seleccionarDistrito(distrito)">
                  {{ distrito }}
                </div>
              </div>
            </div>
            <small class="form-hint">Seleccione el distrito principal</small>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label class="label">Provincia</label>
              <input 
                type="text" 
                class="input" 
                [value]="formData['provinciaSeleccionada'] || ''"
                placeholder="Se auto-completará al seleccionar distrito"
                readonly>
            </div>
            <div class="form-field">
              <label class="label">Departamento</label>
              <input 
                type="text" 
                class="input" 
                [value]="formData['departamentoSeleccionado'] || ''"
                placeholder="Se auto-completará al seleccionar distrito"
                readonly>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Formulario especializado para 3.1.3, 3.1.3.A y 3.1.3.B -->
      <ng-container *ngIf="seccionId === '3.1.3' || seccionId === '3.1.3.A' || seccionId === '3.1.3.B'">
        <div class="form-group-section">
          <h4 class="section-title">3.1.3 Índices demográficos, sociales, económicos, de ocupación laboral y otros similares</h4>
          
          <div class="form-field">
            <label class="label">Cantidad de Entrevistas <span class="required">*</span></label>
            <input 
              type="number" 
              class="input" 
              placeholder="Ej: 18"
              [value]="formData['cantidadEntrevistas'] || ''"
              (input)="onFieldChange('cantidadEntrevistas', $any($event.target).value)">
          </div>

          <div class="form-field">
            <label class="label">Fecha de Trabajo de Campo <span class="required">*</span></label>
            <input 
              type="text" 
              class="input" 
              placeholder="Ej: noviembre 2024"
              [value]="formData['fechaTrabajoCampo'] || ''"
              (input)="onFieldChange('fechaTrabajoCampo', $any($event.target).value)">
          </div>

          <div class="form-field">
            <label class="label">Consultora / Fuente <span class="required">*</span></label>
            <input 
              type="text" 
              class="input" 
              placeholder="Ej: GEADES (2024)"
              [value]="formData['consultora'] || ''"
              (input)="onFieldChange('consultora', $any($event.target).value)">
          </div>

          <div class="form-field">
            <label class="label">Lista de Entrevistados</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Nombres y Apellidos</th>
                    <th>Cargo u Ocupación</th>
                    <th>Organización</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let entrevistado of (datos.entrevistados || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="entrevistado.nombre || ''"
                        (input)="actualizarEntrevistado(i, 'nombre', $any($event.target).value)"
                        placeholder="Ej: Miguel Ángel Sayaverde Rospigliosi">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="entrevistado.cargo || ''"
                        (input)="actualizarEntrevistado(i, 'cargo', $any($event.target).value)"
                        placeholder="Ej: Presidente">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="entrevistado.organizacion || ''"
                        (input)="actualizarEntrevistado(i, 'organizacion', $any($event.target).value)"
                        placeholder="Ej: CC Ayroca">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarEntrevistado(i)" title="Eliminar entrevistado">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.entrevistados || datos.entrevistados.length === 0">
                    <td colspan="4" class="text-center">
                      <button type="button" class="btn btn-secondary" (click)="agregarEntrevistado()">
                        + Agregar Entrevistado
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="form-field" style="margin-top: 10px;">
                <button type="button" class="btn btn-secondary" (click)="agregarEntrevistado()">
                  + Agregar Entrevistado
                </button>
              </div>
            </div>
          </div>

          <div class="form-group-section" *ngIf="seccionId === '3.1.3' || seccionId === '3.1.3.A' || seccionId === '3.1.3.B'">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Metodología</label>
              <textarea 
                class="textarea" 
                rows="3"
                [value]="obtenerTextoSeccion3Metodologia()"
                (input)="onFieldChange('parrafoSeccion3_metodologia', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Fuentes Primarias</label>
              <textarea 
                class="textarea" 
                rows="3"
                [value]="obtenerTextoSeccion3FuentesPrimarias()"
                (input)="onFieldChange('parrafoSeccion3_fuentes_primarias', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. El número de entrevistas se agregará automáticamente. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Fuentes Secundarias - Texto Introductorio</label>
              <textarea 
                class="textarea" 
                rows="2"
                [value]="obtenerTextoSeccion3FuentesSecundarias()"
                (input)="onFieldChange('parrafoSeccion3_fuentes_secundarias', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>

          <div class="form-group-section" *ngIf="seccionId === '3.1.3' || seccionId === '3.1.3.A' || seccionId === '3.1.3.B'">
            <h4 class="section-title">Lista de Fuentes Secundarias</h4>
            
            <div class="form-field" *ngFor="let fuente of obtenerListaFuentesSecundarias(); let i = index" style="display: flex; gap: 8px; align-items: flex-start; margin-bottom: 8px;">
              <input 
                type="text" 
                class="input" 
                [value]="fuente"
                (input)="actualizarFuenteSecundaria(i, $any($event.target).value)"
                style="flex: 1;">
              <button 
                type="button" 
                class="btn btn-danger" 
                (click)="eliminarFuenteSecundaria(i)"
                style="padding: 8px 16px; white-space: nowrap;">
                Eliminar
              </button>
            </div>

            <div class="form-field">
              <button 
                type="button" 
                class="btn btn-primary" 
                (click)="agregarFuenteSecundaria()"
                style="width: 100%;">
                Agregar Nueva Fuente
              </button>
            </div>
          </div>

          <app-image-upload
            [fotografias]="fotografiasSeccion3FormMulti"
            [sectionId]="seccionId"
            [permitirMultiples]="true"
            labelTitulo="Título de la fotografía"
            labelFuente="Fuente de la fotografía"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Fotografía de la sección 3"
            placeholderFuente="Ej: GEADES, 2024"
            tituloDefault="Sección 3"
            fuenteDefault="GEADES, 2024"
            (fotografiasChange)="onFotografiasSeccion3Change($event)">
          </app-image-upload>
        </div>
      </ng-container>

      <!-- Formulario especializado para 3.1.4, 3.1.4.A y 3.1.4.A.1 -->
      <ng-container *ngIf="seccionId === '3.1.4' || seccionId === '3.1.4.A' || seccionId === '3.1.4.A.1' || seccionId === '3.1.4.A.2'">
        <!-- Información General de la Comunidad -->
        <div class="form-group-section">
          <h4 class="section-title">Información General de la Comunidad</h4>
          
          <div class="form-field">
            <label class="label">Distrito Principal <span class="required">*</span></label>
            <select 
              *ngIf="obtenerDistritosDeComunidad().length > 1"
              class="input" 
              [value]="formData['distritoSeleccionado'] || ''"
              (change)="onDistritoPrincipalChange($any($event.target).value)">
              <option value="">Seleccione un distrito</option>
              <option *ngFor="let distrito of obtenerDistritosDeComunidad()" [value]="distrito">{{ distrito }}</option>
            </select>
            <input 
              *ngIf="obtenerDistritosDeComunidad().length === 1"
              type="text" 
              class="input" 
              [value]="formData['distritoSeleccionado'] || obtenerDistritosDeComunidad()[0] || ''"
              [disabled]="true">
            <small class="form-hint" *ngIf="obtenerDistritosDeComunidad().length > 1">Seleccione el distrito principal de la comunidad</small>
            <small class="form-hint" *ngIf="obtenerDistritosDeComunidad().length === 1">Distrito único de la comunidad</small>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label class="label">Coordenadas</label>
              <input type="text" class="input" placeholder="Ej: 18L E: 660 619 m N: 8 291 173 m" 
                [value]="formData['coordenadasAISD'] || ''"
                (input)="onFieldChange('coordenadasAISD', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Altitud (msnm) <span class="required">*</span></label>
              <input type="text" class="input" placeholder="Ej: 3 599" 
                [value]="formData['altitudAISD'] || ''"
                (input)="onAltitudChange($any($event.target).value)"
                (blur)="normalizarAltitud()">
            </div>
          </div>
        </div>

        <div class="form-group-section" *ngIf="seccionId === '3.1.4.A' || seccionId === '3.1.4.A.1' || seccionId === '3.1.4.A.2'">
          <h4 class="section-title">Editar Párrafos</h4>
          
          <div class="form-field">
            <label class="label">Introducción AISD</label>
            <textarea 
              class="textarea" 
              rows="3"
              [value]="obtenerTextoSeccion4IntroduccionAISD()"
              (input)="onFieldChange('parrafoSeccion4_introduccion_aisd', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
          </div>

          <div class="form-field">
            <label class="label">Información de la Comunidad - Texto Completo</label>
            <textarea 
              class="textarea" 
              rows="12"
              [value]="obtenerTextoSeccion4ComunidadCompleto()"
              (input)="onFieldChange('parrafoSeccion4_comunidad_completo', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite todo el bloque de texto sobre la comunidad. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
          </div>

          <div class="form-field">
            <label class="label">Caracterización de Indicadores</label>
            <textarea 
              class="textarea" 
              rows="2"
              [value]="obtenerTextoSeccion4CaracterizacionIndicadores()"
              (input)="onFieldChange('parrafoSeccion4_caracterizacion_indicadores', $any($event.target).value)"></textarea>
            <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
          </div>
        </div>

        <!-- Cuadro 1: Ubicación referencial -->
        <div class="form-group-section">
          <h4 class="section-title">Cuadro 1: Ubicación referencial</h4>
          <div class="form-field">
            <label class="label">Título <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Ubicación referencial" 
              [value]="formData['cuadroTituloAISD1'] || ''"
              (input)="onFieldChange('cuadroTituloAISD1', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Fuente <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: GEADES (2024)" 
              [value]="formData['cuadroFuenteAISD1'] || ''"
              (input)="onFieldChange('cuadroFuenteAISD1', $any($event.target).value)">
          </div>
          <small class="form-hint">El número de cuadro se genera automáticamente. Los demás campos (Localidad, Distrito, Provincia, Departamento) se completan automáticamente desde la información general</small>
        </div>

        <!-- Cuadro 2: Población y viviendas -->
        <div class="form-group-section">
          <h4 class="section-title">Cuadro 2: Población y viviendas</h4>
          <div class="form-field">
            <label class="label">Título <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Cantidad total de población y viviendas" 
              [value]="formData['cuadroTituloAISD2'] || ''"
              (input)="onFieldChange('cuadroTituloAISD2', $any($event.target).value)">
          </div>
          <!-- Tabla editable dinámica -->
          <div class="table-editor">
            <table class="editor-table">
              <thead>
                <tr>
                  <th>Punto de Población</th>
                  <th>Código</th>
                  <th>Población</th>
                  <th>Viviendas Empadronadas</th>
                  <th>Viviendas Ocupadas</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of getFilasTabla(); let i = index">
                  <td>
                    <div class="autocomplete-wrapper">
                      <input type="text" class="table-input" 
                        [value]="obtenerValorConPrefijo('tablaAISD2Fila' + (i+1) + 'Punto') || ''"
                        (input)="onPuntoPoblacionInput(i+1, $any($event.target).value)"
                        (blur)="onPuntoPoblacionBlur(i+1)"
                        placeholder="Buscar punto de población...">
                      <div *ngIf="autocompleteData['puntoPoblacion' + (i+1)] && autocompleteData['puntoPoblacion' + (i+1)].mostrar && autocompleteData['puntoPoblacion' + (i+1)].sugerencias.length > 0" 
                           class="autocomplete-dropdown"
                           (mouseenter)="autocompleteData['puntoPoblacion' + (i+1)].mostrar = true"
                           (mouseleave)="cerrarSugerenciasAutocomplete('puntoPoblacion' + (i+1))">
                        <div 
                          *ngFor="let sugerencia of autocompleteData['puntoPoblacion' + (i+1)].sugerencias" 
                          class="autocomplete-item"
                          (mousedown)="seleccionarPuntoPoblacion(i+1, sugerencia)"
                          (click)="seleccionarPuntoPoblacion(i+1, sugerencia)">
                          {{ sugerencia.nombre }} ({{ sugerencia.codigo }})
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2Fila' + (i+1) + 'Codigo') || ''"
                      (input)="onTablaFieldChange('tablaAISD2Fila' + (i+1) + 'Codigo', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2Fila' + (i+1) + 'Poblacion') || ''"
                      (input)="onTablaFieldChange('tablaAISD2Fila' + (i+1) + 'Poblacion', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2Fila' + (i+1) + 'ViviendasEmpadronadas') || ''"
                      (input)="onTablaFieldChange('tablaAISD2Fila' + (i+1) + 'ViviendasEmpadronadas', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2Fila' + (i+1) + 'ViviendasOcupadas') || ''"
                      (input)="onTablaFieldChange('tablaAISD2Fila' + (i+1) + 'ViviendasOcupadas', $any($event.target).value)"
                      placeholder="____">
                  </td>
                  <td>
                    <button type="button" class="btn-icon" (click)="eliminarFilaTabla(i)" *ngIf="filasTablaAISD2 > 1" title="Eliminar fila">
                      ×
                    </button>
                  </td>
                </tr>
                <tr class="total-row">
                  <td><strong>Total</strong></td>
                  <td></td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2TotalPoblacion') || '0'"
                      readonly
                      style="background-color: #f5f5f5; cursor: not-allowed;">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2TotalViviendasEmpadronadas') || '0'"
                      readonly
                      style="background-color: #f5f5f5; cursor: not-allowed;">
                  </td>
                  <td>
                    <input type="text" class="table-input" 
                      [value]="obtenerValorConPrefijo('tablaAISD2TotalViviendasOcupadas') || '0'"
                      readonly
                      style="background-color: #f5f5f5; cursor: not-allowed;">
                  </td>
                  <td></td>
                </tr>
              </tbody>
            </table>
            <button type="button" class="btn btn-secondary" (click)="agregarFilaTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fuente <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Reporte de Indicadores... REDINFORMA (MIDIS)" 
              [value]="formData['cuadroFuenteAISD2'] || ''"
              (input)="onFieldChange('cuadroFuenteAISD2', $any($event.target).value)">
          </div>
          <small class="form-hint">El número de cuadro se genera automáticamente</small>
        </div>

        <!-- Fotografías Sección 4 -->
        <div class="form-group-section">
          <h4 class="section-title">Fotografías de Sección 4</h4>
          <app-image-upload
            [fotografias]="fotografiasAISDFormMulti"
            [sectionId]="seccionId"
            [permitirMultiples]="true"
            labelTitulo="Título de la fotografía"
            labelFuente="Fuente de la fotografía"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Fotografía de la sección 4"
            placeholderFuente="Ej: GEADES, 2024"
            tituloDefault="Sección 4"
            fuenteDefault="GEADES, 2024"
            (fotografiasChange)="onFotografiasAISDChange($event)">
          </app-image-upload>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 1)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.1. Institucionalidad local</h4>
          <div class="form-field">
            <label class="label">Título de la Tabla <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: Instituciones existentes - CC Ayroca"
              [value]="formData['tituloInstituciones'] || 'Instituciones existentes - CC ' + (formData['grupoAISD'] || 'Ayroca')"
              (input)="onFieldChange('tituloInstituciones', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Fuente de la Tabla <span class="required">*</span></label>
            <input type="text" class="input" placeholder="Ej: GEADES (2024)"
              [value]="formData['fuenteInstituciones'] || 'GEADES (2024)'"
              (input)="onFieldChange('fuenteInstituciones', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Tabla de Instituciones</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>SI/NO</th>
                    <th>Nombre</th>
                    <th>Comentario</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let institucion of (datos.tablepagina6 || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="institucion.categoria || ''"
                        (input)="actualizarInstitucion(i, 'categoria', $any($event.target).value)"
                        placeholder="Categoría">
                    </td>
                    <td>
                      <select class="table-input" 
                        [value]="institucion.respuesta || ''"
                        (change)="actualizarInstitucion(i, 'respuesta', $any($event.target).value)">
                        <option value="">--</option>
                        <option value="SI">SI</option>
                        <option value="NO">NO</option>
                      </select>
                    </td>
                    <td>
                      <textarea class="table-input" rows="2"
                        [value]="institucion.nombre || ''"
                        (input)="actualizarInstitucion(i, 'nombre', $any($event.target).value)"
                        placeholder="Nombre (puede ser múltiples líneas)"></textarea>
                    </td>
                    <td>
                      <textarea class="table-input" rows="2"
                        [value]="institucion.comentario || ''"
                        (input)="actualizarInstitucion(i, 'comentario', $any($event.target).value)"
                        placeholder="Comentario"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarInstitucion(i)" *ngIf="(datos.tablepagina6 || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.tablepagina6 || datos.tablepagina6.length === 0">
                    <td colspan="5" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarInstituciones()">
                        Agregar Primera Institución
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarInstitucion()" style="margin-top: 10px;">
              + Agregar Institución
            </button>
          </div>
          <app-image-upload
            [fotografias]="fotografiasInstitucionalidadFormMulti"
            [sectionId]="seccionId"
            [permitirMultiples]="true"
            labelTitulo="Título de la fotografía"
            labelFuente="Fuente de la fotografía"
            labelImagen="Fotografía - Imagen"
            placeholderTitulo="Ej: Local Comunal de la CC Ayroca"
            placeholderFuente="Ej: GEADES, 2024"
            tituloDefault="Local Comunal de la CC Ayroca"
            fuenteDefault="GEADES, 2024"
            [requerido]="true"
            (fotografiasChange)="onFotografiasInstitucionalidadChange($event)">
          </app-image-upload>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 2)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.2. Aspectos Demográficos</h4>
          <div class="form-field">
            <label class="label">Población por Sexo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Sexo</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['poblacionSexoAISD'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.sexo || ''"
                        (input)="actualizarPoblacionSexo(i, 'sexo', $any($event.target).value)"
                        placeholder="Hombres/Mujeres">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionSexo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionSexo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                  </tr>
                  <tr class="total-row" *ngIf="datos['poblacionSexoAISD'] && datos['poblacionSexoAISD'].length > 0">
                    <td><strong>Total</strong></td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="getTotalPoblacionSexo()"
                        readonly
                        style="background-color: #f5f5f5; cursor: not-allowed;">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        value="100,00 %"
                        readonly
                        style="background-color: #f5f5f5; cursor: not-allowed;">
                    </td>
                  </tr>
                  <tr *ngIf="!datos['poblacionSexoAISD'] || datos['poblacionSexoAISD'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionSexo()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Población por Grupo Etario</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['poblacionEtarioAISD'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPoblacionEtario(i, 'categoria', $any($event.target).value)"
                        placeholder="0 a 14 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionEtario(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionEtario(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                  </tr>
                  <tr class="total-row" *ngIf="datos['poblacionEtarioAISD'] && datos['poblacionEtarioAISD'].length > 0">
                    <td><strong>Total</strong></td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="getTotalPoblacionEtario()"
                        readonly
                        style="background-color: #f5f5f5; cursor: not-allowed;">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        value="100,00 %"
                        readonly
                        style="background-color: #f5f5f5; cursor: not-allowed;">
                    </td>
                  </tr>
                  <tr *ngIf="!datos['poblacionEtarioAISD'] || datos['poblacionEtarioAISD'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionEtario()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="form-field">
            <label class="label">Fotografías de Aspectos Demográficos</label>
            <app-image-upload
              [fotografias]="fotografiasDemografiaFormMulti"
              [sectionId]="seccionId"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Población de la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Población"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasDemografiaChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 3)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.3. Aspectos Económicos</h4>
          
          <div class="form-field">
            <label class="label">Población Distrital</label>
            <input type="text" class="input" placeholder="Ej: 610"
              [value]="formData['poblacionDistritalCahuacho'] || ''"
              (input)="onFieldChange('poblacionDistritalCahuacho', $any($event.target).value)"
              readonly>
            <small class="form-hint">Se carga automáticamente desde el backend</small>
          </div>
          
          <div class="form-field">
            <label class="label">PET Distrital (14 años a más)</label>
            <input type="text" class="input" placeholder="Ej: 461"
              [value]="formData['petDistritalCahuacho'] || ''"
              (input)="onFieldChange('petDistritalCahuacho', $any($event.target).value)"
              readonly>
            <small class="form-hint">Se carga automáticamente desde el backend</small>
          </div>
          
          <div class="form-field">
            <label class="label">Ingreso Familiar Per Cápita (S/.)</label>
            <input type="text" class="input" placeholder="Ej: 391,06"
              [value]="formData['ingresoFamiliarPerCapita'] || ''"
              (input)="onFieldChange('ingresoFamiliarPerCapita', $any($event.target).value)">
          </div>
          
          <div class="form-field">
            <label class="label">Ranking Ingreso Per Cápita</label>
            <input type="text" class="input" placeholder="Ej: 1191"
              [value]="formData['rankingIngresoPerCapita'] || ''"
              (input)="onFieldChange('rankingIngresoPerCapita', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Tabla PET según grupos de edad</label>
            <div class="table-editor">
              <p class="note">Esta tabla se gestiona a través del componente de fotografía institucional</p>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Tabla PEA y No PEA según sexo</label>
            <div class="table-editor">
              <p class="note">Esta tabla se gestiona a través del componente de fotografía institucional</p>
            </div>
          </div>
          <div class="form-field">
            <label class="label">Tabla PEA Ocupada y Desocupada según sexo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Hombres</th>
                    <th>% Hombres</th>
                    <th>Mujeres</th>
                    <th>% Mujeres</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['peaOcupadaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEAOcupada(i, 'categoria', $any($event.target).value)"
                        placeholder="PEA Ocupada/Desocupada">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEAOcupada(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEAOcupada(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEAOcupada(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEAOcupada(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEAOcupada(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEAOcupada(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEAOcupada(i)" *ngIf="(datos['peaOcupadaTabla'] || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['peaOcupadaTabla'] || datos['peaOcupadaTabla'].length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupada()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupada()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 3)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Situación del Empleo - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="6"
                [value]="obtenerTextoSeccion7SituacionEmpleoCompleto()"
                (input)="onFieldChange('parrafoSeccion7_situacion_empleo_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre situación del empleo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Ingresos de la Población - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="8"
                [value]="obtenerTextoSeccion7IngresosCompleto()"
                (input)="onFieldChange('parrafoSeccion7_ingresos_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre ingresos. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Fotografías de PEA y Empleo</label>
              <app-image-upload
                [fotografias]="fotografiasPEAFormMulti"
                [sectionId]="seccionId"
                [permitirMultiples]="true"
                labelTitulo="Título de la fotografía"
                labelFuente="Fuente de la fotografía"
                labelImagen="Fotografía - Imagen"
                placeholderTitulo="Ej: PEA de la CC Ayroca"
                placeholderFuente="Ej: GEADES, 2024"
                tituloDefault="PEA y Empleo"
                fuenteDefault="GEADES, 2024"
                (fotografiasChange)="onFotografiasPEAChange($event)">
              </app-image-upload>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 4)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.4. Actividades económicas de la población</h4>
          <div class="form-field">
            <label class="label">Tabla PEA Ocupada según ocupaciones principales</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['peaOcupacionesTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEAOcupaciones(i, 'categoria', $any($event.target).value)"
                        placeholder="Trabajador independiente">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEAOcupaciones(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEAOcupaciones(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEAOcupaciones(i)" *ngIf="(datos['peaOcupacionesTabla'] || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['peaOcupacionesTabla'] || datos['peaOcupacionesTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupaciones()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupaciones()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Población Pecuaria</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Especie</th>
                    <th>Cantidad promedio por familia</th>
                    <th>Venta por unidad</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['poblacionPecuariaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.especie || ''"
                        (input)="actualizarPoblacionPecuaria(i, 'especie', $any($event.target).value)"
                        placeholder="Vacuno">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.cantidadPromedio || ''"
                        (input)="actualizarPoblacionPecuaria(i, 'cantidadPromedio', $any($event.target).value)"
                        placeholder="4 – 50">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.ventaUnidad || ''"
                        (input)="actualizarPoblacionPecuaria(i, 'ventaUnidad', $any($event.target).value)"
                        placeholder="S/. 1 200 – S/. 1 500">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPoblacionPecuaria(i)" *ngIf="(datos['poblacionPecuariaTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['poblacionPecuariaTabla'] || datos['poblacionPecuariaTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionPecuaria()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPoblacionPecuaria()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Características de la Agricultura</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Detalle</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['caracteristicasAgriculturaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCaracteristicasAgricultura(i, 'categoria', $any($event.target).value)"
                        placeholder="Destino de la producción">
                    </td>
                    <td>
                      <textarea class="table-input" rows="2"
                        [value]="item.detalle || ''"
                        (input)="actualizarCaracteristicasAgricultura(i, 'detalle', $any($event.target).value)"
                        placeholder="Autoconsumo: 95%"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCaracteristicasAgricultura(i)" *ngIf="(datos['caracteristicasAgriculturaTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['caracteristicasAgriculturaTabla'] || datos['caracteristicasAgriculturaTabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCaracteristicasAgricultura()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCaracteristicasAgricultura()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Ganadería</label>
            <app-image-upload
              [fotografias]="fotografiasGanaderiaFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaGanaderia'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Ganado vacuno en la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Ganado vacuno en la CC Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasGanaderiaChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Agricultura</label>
            <app-image-upload
              [fotografias]="fotografiasAgriculturaFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaAgricultura'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Parcela agrícola en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Parcela agrícola en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasAgriculturaChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Comercio</label>
            <app-image-upload
              [fotografias]="fotografiasComercioFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaComercio'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Comercio ambulatorio en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Comercio ambulatorio en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasComercioChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 4)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Ganadería - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="8"
                [value]="obtenerTextoSeccion8GanaderiaCompleto()"
                (input)="onFieldChange('parrafoSeccion8_ganaderia_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre ganadería. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Agricultura - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="6"
                [value]="obtenerTextoSeccion8AgriculturaCompleto()"
                (input)="onFieldChange('parrafoSeccion8_agricultura_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre agricultura. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 5)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.5. Viviendas</h4>
          <div class="form-field">
            <label class="label">Tabla Condición de Ocupación</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Condición de ocupación</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['condicionOcupacionTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCondicionOcupacion(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas ocupadas">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCondicionOcupacion(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCondicionOcupacion(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCondicionOcupacion(i)" *ngIf="(datos['condicionOcupacionTabla'] || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['condicionOcupacionTabla'] || datos['condicionOcupacionTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCondicionOcupacion()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCondicionOcupacion()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Tipos de Materiales</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categorías</th>
                    <th>Tipos de materiales</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['tiposMaterialesTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarTiposMateriales(i, 'categoria', $any($event.target).value)"
                        placeholder="Materiales de las paredes">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.tipoMaterial || ''"
                        (input)="actualizarTiposMateriales(i, 'tipoMaterial', $any($event.target).value)"
                        placeholder="Adobe">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTiposMateriales(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTiposMateriales(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTiposMateriales(i)" *ngIf="(datos['tiposMaterialesTabla'] || []).length > 1 && item.tipoMaterial !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['tiposMaterialesTabla'] || datos['tiposMaterialesTabla'].length === 0">
                    <td colspan="5" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTiposMateriales()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTiposMateriales()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Estructura</label>
            <app-image-upload
              [fotografias]="fotografiasEstructuraFormMulti"
              [sectionId]="seccionId"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Estructura de las viviendas en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Estructura de las viviendas en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasEstructuraChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 6)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.6. Servicios básicos</h4>
          <div class="form-field">
            <label class="label">Tabla Abastecimiento de Agua</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['abastecimientoAguaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAbastecimientoAgua(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas con abastecimiento de agua por red pública">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAbastecimientoAgua(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAbastecimientoAgua(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAbastecimientoAgua(i)" *ngIf="(datos['abastecimientoAguaTabla'] || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['abastecimientoAguaTabla'] || datos['abastecimientoAguaTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAbastecimientoAgua()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAbastecimientoAgua()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Cuota Mensual de Agua (S/.)</label>
            <input type="text" class="input" placeholder="Ej: 4"
              [value]="formData['cuotaMensualAgua'] || ''"
              (input)="onFieldChange('cuotaMensualAgua', $any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="label">Tabla Tipos de Saneamiento</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['tiposSaneamientoTabla'] || datos['saneamientoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarTiposSaneamiento(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas con saneamiento vía red pública">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTiposSaneamiento(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTiposSaneamiento(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTiposSaneamiento(i)" *ngIf="((datos['tiposSaneamientoTabla'] || datos['saneamientoTabla'] || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="(!datos['tiposSaneamientoTabla'] || datos['tiposSaneamientoTabla'].length === 0) && (!datos['saneamientoTabla'] || datos['saneamientoTabla'].length === 0)">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTiposSaneamiento()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTiposSaneamiento()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Desechos Sólidos</label>
            <app-image-upload
              [fotografias]="fotografiasDesechosSolidosFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaDesechosSolidos'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Contenedor de residuos sólidos y plásticos en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Contenedor de residuos sólidos y plásticos en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasDesechosSolidosChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Tabla Cobertura Eléctrica</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['coberturaElectricaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCoberturaElectrica(i, 'categoria', $any($event.target).value)"
                        placeholder="Viviendas con acceso a electricidad">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCoberturaElectrica(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCoberturaElectrica(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCoberturaElectrica(i)" *ngIf="(datos['coberturaElectricaTabla'] || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['coberturaElectricaTabla'] || datos['coberturaElectricaTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCoberturaElectrica()">
                        Agregar Filas
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCoberturaElectrica()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Empresa Eléctrica</label>
            <input type="text" class="input" placeholder="Ej: ADINELSA"
              [value]="formData['empresaElectrica'] || ''"
              (input)="onFieldChange('empresaElectrica', $any($event.target).value)">
          </div>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Costo Eléctrico Mínimo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 20"
                [value]="formData['costoElectricidadMinimo'] || ''"
                (input)="onFieldChange('costoElectricidadMinimo', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Costo Eléctrico Máximo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 40"
                [value]="formData['costoElectricidadMaximo'] || ''"
                (input)="onFieldChange('costoElectricidadMaximo', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Electricidad</label>
            <app-image-upload
              [fotografias]="fotografiasElectricidadFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaElectricidad'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura eléctrica en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura eléctrica en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasElectricidadChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 6)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Introducción - Servicios Básicos</label>
              <textarea 
                class="textarea" 
                rows="4"
                [value]="obtenerTextoSeccion10ServiciosBasicosIntro()"
                (input)="onFieldChange('parrafoSeccion10_servicios_basicos_intro', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 7)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.7. Infraestructura en transportes y comunicaciones</h4>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Costo Transporte Mínimo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 25"
                [value]="formData['costoTransporteMinimo'] || ''"
                (input)="onFieldChange('costoTransporteMinimo', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Costo Transporte Máximo (S/.)</label>
              <input type="text" class="input" placeholder="Ej: 30"
                [value]="formData['costoTransporteMaximo'] || ''"
                (input)="onFieldChange('costoTransporteMaximo', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Transporte</label>
            <app-image-upload
              [fotografias]="fotografiasTransporteFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaTransporte'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de transporte en la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura de transporte en la CC Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasTransporteChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Tabla Servicios de Telecomunicaciones</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Medio de comunicación</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['telecomunicacionesTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.medio || ''"
                        (input)="actualizarTelecomunicaciones(i, 'medio', $any($event.target).value)"
                        placeholder="Emisoras de radio">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.descripcion || ''"
                        (input)="actualizarTelecomunicaciones(i, 'descripcion', $any($event.target).value)"
                        placeholder="--">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTelecomunicaciones(i)" *ngIf="(datos['telecomunicacionesTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['telecomunicacionesTabla'] || datos['telecomunicacionesTabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTelecomunicaciones()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTelecomunicaciones()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Telecomunicaciones</label>
            <app-image-upload
              [fotografias]="fotografiasTelecomunicacionesFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaTelecomunicaciones'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Vivienda con antena de DIRECTV en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Vivienda con antena de DIRECTV en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasTelecomunicacionesChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 7)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Transporte - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="6"
                [value]="obtenerTextoSeccion11TransporteCompleto()"
                (input)="onFieldChange('parrafoSeccion11_transporte_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre transporte. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Telecomunicaciones - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="6"
                [value]="obtenerTextoSeccion11TelecomunicacionesCompleto()"
                (input)="onFieldChange('parrafoSeccion11_telecomunicaciones_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre telecomunicaciones. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 8)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.8. Infraestructura en salud, educación, recreativa y deportiva</h4>
          <div class="form-field">
            <label class="label">Tabla Características del Puesto de Salud</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['caracteristicasSaludTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCaracteristicasSalud(i, 'categoria', $any($event.target).value)"
                        placeholder="Nombre">
                    </td>
                    <td>
                      <textarea class="table-input" rows="3"
                        [value]="item.descripcion || ''"
                        (input)="actualizarCaracteristicasSalud(i, 'descripcion', $any($event.target).value)"
                        placeholder="Puesto de Salud Ayroca"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCaracteristicasSalud(i)" *ngIf="(datos['caracteristicasSaludTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['caracteristicasSaludTabla'] || datos['caracteristicasSaludTabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCaracteristicasSalud()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCaracteristicasSalud()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Salud</label>
            <app-image-upload
              [fotografias]="fotografiasSaludFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaSalud'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura externa del Puesto de Salud Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura externa del Puesto de Salud Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasSaludChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Tabla Infraestructura Educativa</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Nombre de IE</th>
                    <th>Nivel</th>
                    <th>Tipo de Gestión</th>
                    <th>Cantidad de estudiantes</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['cantidadEstudiantesEducacionTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.institucion || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'institucion', $any($event.target).value)"
                        placeholder="IE Ayroca">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'nivel', $any($event.target).value)"
                        placeholder="Inicial - Jardín">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.gestion || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'gestion', $any($event.target).value)"
                        placeholder="Pública de gestión directa">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.total || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'total', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCantidadEstudiantesEducacion(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCantidadEstudiantesEducacion(i)" *ngIf="(datos['cantidadEstudiantesEducacionTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['cantidadEstudiantesEducacionTabla'] || datos['cantidadEstudiantesEducacionTabla'].length === 0">
                    <td colspan="6" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCantidadEstudiantesEducacion()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCantidadEstudiantesEducacion()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Características IE Ayroca</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['ieAyrocaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarIEAyroca(i, 'categoria', $any($event.target).value)"
                        placeholder="Tipo de I.E.">
                    </td>
                    <td>
                      <textarea class="table-input" rows="3"
                        [value]="item.descripcion || ''"
                        (input)="actualizarIEAyroca(i, 'descripcion', $any($event.target).value)"
                        placeholder="Pública de gestión directa, mixta"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarIEAyroca(i)" *ngIf="(datos['ieAyrocaTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['ieAyrocaTabla'] || datos['ieAyrocaTabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarIEAyroca()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarIEAyroca()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Características IE N°40270</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['ie40270Tabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarIE40270(i, 'categoria', $any($event.target).value)"
                        placeholder="Tipo de I.E.">
                    </td>
                    <td>
                      <textarea class="table-input" rows="3"
                        [value]="item.descripcion || ''"
                        (input)="actualizarIE40270(i, 'descripcion', $any($event.target).value)"
                        placeholder="Pública de gestión directa, mixta"></textarea>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarIE40270(i)" *ngIf="(datos['ie40270Tabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['ie40270Tabla'] || datos['ie40270Tabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarIE40270()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarIE40270()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Alumnos IE Ayroca (por grado y sexo)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Nombre de IE</th>
                    <th rowspan="2">Nivel</th>
                    <th colspan="2">Total</th>
                    <th colspan="2">3 años</th>
                    <th colspan="2">4 años</th>
                    <th colspan="2">5 años</th>
                  </tr>
                  <tr>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['alumnosIEAyrocaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombre || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'nombre', $any($event.target).value)"
                        placeholder="IE Ayroca">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'nivel', $any($event.target).value)"
                        placeholder="Inicial - Jardín">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'totalH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'totalM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.tresH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'tresH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.tresM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'tresM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cuatroH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cuatroH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cuatroM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cuatroM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cincoH || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cincoH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cincoM || ''"
                        (input)="actualizarAlumnosIEAyroca(i, 'cincoM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAlumnosIEAyroca(i)" *ngIf="(datos['alumnosIEAyrocaTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['alumnosIEAyrocaTabla'] || datos['alumnosIEAyrocaTabla'].length === 0">
                    <td colspan="11" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAlumnosIEAyroca()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAlumnosIEAyroca()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Alumnos IE N°40270 (por grado y sexo)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Nombre de IE</th>
                    <th rowspan="2">Nivel</th>
                    <th colspan="2">Total</th>
                    <th colspan="2">1°</th>
                    <th colspan="2">2°</th>
                    <th colspan="2">3°</th>
                    <th colspan="2">4°</th>
                    <th colspan="2">5°</th>
                    <th colspan="2">6°</th>
                  </tr>
                  <tr>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                    <th>H</th>
                    <th>M</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['alumnosIE40270Tabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombre || ''"
                        (input)="actualizarAlumnosIE40270(i, 'nombre', $any($event.target).value)"
                        placeholder="IE N°40270">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarAlumnosIE40270(i, 'nivel', $any($event.target).value)"
                        placeholder="Primaria">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalH || ''"
                        (input)="actualizarAlumnosIE40270(i, 'totalH', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.totalM || ''"
                        (input)="actualizarAlumnosIE40270(i, 'totalM', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p1H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p1H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p1M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p1M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p2H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p2H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p2M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p2M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p3H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p3H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p3M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p3M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p4H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p4H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p4M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p4M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p5H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p5H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p5M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p5M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p6H || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p6H', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.p6M || ''"
                        (input)="actualizarAlumnosIE40270(i, 'p6M', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAlumnosIE40270(i)" *ngIf="(datos['alumnosIE40270Tabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['alumnosIE40270Tabla'] || datos['alumnosIE40270Tabla'].length === 0">
                    <td colspan="17" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAlumnosIE40270()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAlumnosIE40270()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de IE {{ datos.grupoAISD || 'Ayroca' }}</label>
            <app-image-upload
              [fotografias]="fotografiasIEAyrocaFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaIEAyroca'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de la IE Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura de la IE Ayroca"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasIEAyrocaChangeGeneric($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de IE N°40270</label>
            <app-image-upload
              [fotografias]="fotografiasIE40270FormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaIE40270'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de la IE N°40270"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura de la IE N°40270"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasIE40270ChangeGeneric($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Recreación</label>
            <app-image-upload
              [fotografias]="fotografiasRecreacionFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaRecreacion'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Parque recreacional público del anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Parque recreacional público del anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasRecreacionChangeGeneric($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Deporte</label>
            <app-image-upload
              [fotografias]="fotografiasDeporteFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaDeporte'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Losa deportiva del anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Losa deportiva del anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasDeporteChangeGeneric($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 8)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Infraestructura en Salud - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="4"
                [value]="obtenerTextoSeccion12SaludCompleto()"
                (input)="onFieldChange('parrafoSeccion12_salud_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Infraestructura en Educación - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="4"
                [value]="obtenerTextoSeccion12EducacionCompleto()"
                (input)="onFieldChange('parrafoSeccion12_educacion_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 9)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.9. Indicadores de salud</h4>
          <div class="form-field">
            <label class="label">Tabla Indicadores de Natalidad y Mortalidad</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Año</th>
                    <th>Natalidad</th>
                    <th>Mortalidad</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['natalidadMortalidadTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.anio || ''"
                        (input)="actualizarNatalidadMortalidad(i, 'anio', $any($event.target).value)"
                        placeholder="2023">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.natalidad || ''"
                        (input)="actualizarNatalidadMortalidad(i, 'natalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mortalidad || ''"
                        (input)="actualizarNatalidadMortalidad(i, 'mortalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNatalidadMortalidad(i)" *ngIf="(datos['natalidadMortalidadTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['natalidadMortalidadTabla'] || datos['natalidadMortalidadTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNatalidadMortalidad()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNatalidadMortalidad()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Casos por Grupos de Morbilidad</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Grupo de Morbilidad</th>
                    <th colspan="5">Bloques etarios</th>
                    <th rowspan="2">Casos Totales</th>
                    <th rowspan="2"></th>
                  </tr>
                  <tr>
                    <th>0 – 11</th>
                    <th>12 – 17</th>
                    <th>18 – 29</th>
                    <th>30 – 59</th>
                    <th>60 -></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['morbilidadTabla'] || datos['morbiliadTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.grupo || ''"
                        (input)="actualizarMorbilidad(i, 'grupo', $any($event.target).value)"
                        placeholder="Enfermedades infecciosas intestinales">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango0_11 || ''"
                        (input)="actualizarMorbilidad(i, 'rango0_11', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango12_17 || ''"
                        (input)="actualizarMorbilidad(i, 'rango12_17', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango18_29 || ''"
                        (input)="actualizarMorbilidad(i, 'rango18_29', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango30_59 || ''"
                        (input)="actualizarMorbilidad(i, 'rango30_59', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rango60 || ''"
                        (input)="actualizarMorbilidad(i, 'rango60', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarMorbilidad(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarMorbilidad(i)" *ngIf="((datos['morbilidadTabla'] || datos['morbiliadTabla'] || []).length > 1)" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="(!datos['morbilidadTabla'] || datos['morbilidadTabla'].length === 0) && (!datos['morbiliadTabla'] || datos['morbiliadTabla'].length === 0)">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarMorbilidad()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarMorbilidad()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Porcentaje SIS (%)</label>
              <input type="text" class="input" placeholder="Ej: 84,44"
                [value]="formData['porcentajeSIS'] || ''"
                (input)="onFieldChange('porcentajeSIS', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Porcentaje ESSALUD (%)</label>
              <input type="text" class="input" placeholder="Ej: 3,56"
                [value]="formData['porcentajeESSALUD'] || ''"
                (input)="onFieldChange('porcentajeESSALUD', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Porcentaje Sin Seguro (%)</label>
              <input type="text" class="input" placeholder="Ej: 12,00"
                [value]="formData['porcentajeSinSeguro'] || ''"
                (input)="onFieldChange('porcentajeSinSeguro', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Tabla Población según Tipo de Seguro de Salud</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['afiliacionSaludTabla'] || datos['seguroSaludTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAfiliacionSalud(i, 'categoria', $any($event.target).value)"
                        placeholder="Seguro Integral de Salud (SIS)">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAfiliacionSalud(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAfiliacionSalud(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAfiliacionSalud(i)" *ngIf="((datos['afiliacionSaludTabla'] || datos['seguroSaludTabla'] || []).length > 1) && item.categoria !== 'Total referencial'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="(!datos['afiliacionSaludTabla'] || datos['afiliacionSaludTabla'].length === 0) && (!datos['seguroSaludTabla'] || datos['seguroSaludTabla'].length === 0)">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAfiliacionSalud()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAfiliacionSalud()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field">
            <label class="label">Fotografías de Indicadores de Salud</label>
            <app-image-upload
              [fotografias]="fotografiasSaludIndicadoresFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaSaludIndicadores'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Indicadores de salud en la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Indicadores de salud"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasSaludIndicadoresChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 9)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Natalidad y Mortalidad - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="5"
                [value]="obtenerTextoSeccion13NatalidadMortalidadCompleto()"
                (input)="onFieldChange('parrafoSeccion13_natalidad_mortalidad_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre natalidad y mortalidad. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Morbilidad - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="5"
                [value]="obtenerTextoSeccion13MorbilidadCompleto()"
                (input)="onFieldChange('parrafoSeccion13_morbilidad_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre morbilidad. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 10)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.10. Indicadores de educación</h4>
          <div class="form-field">
            <label class="label">Tabla Nivel Educativo de la Población</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['nivelEducativoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNivelEducativo(i, 'categoria', $any($event.target).value)"
                        placeholder="Sin nivel o Inicial">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNivelEducativo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNivelEducativo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNivelEducativo(i)" *ngIf="((datos['nivelEducativoTabla'] || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['nivelEducativoTabla'] || datos['nivelEducativoTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNivelEducativo()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNivelEducativo()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Tasa de Analfabetismo</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Indicador</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['tasaAnalfabetismoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.indicador || ''"
                        (input)="actualizarTasaAnalfabetismo(i, 'indicador', $any($event.target).value)"
                        placeholder="Sabe leer y escribir">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTasaAnalfabetismo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTasaAnalfabetismo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTasaAnalfabetismo(i)" *ngIf="((datos['tasaAnalfabetismoTabla'] || []).length > 1) && item.indicador !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['tasaAnalfabetismoTabla'] || datos['tasaAnalfabetismoTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTasaAnalfabetismo()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTasaAnalfabetismo()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field">
            <label class="label">Fotografías de Indicadores de Educación</label>
            <app-image-upload
              [fotografias]="fotografiasEducacionIndicadoresFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaEducacionIndicadores'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Indicadores de educación en la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Indicadores de educación"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasEducacionIndicadoresChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 10)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Introducción - Indicadores de Educación</label>
              <textarea 
                class="textarea" 
                rows="4"
                [value]="obtenerTextoSeccion14IndicadoresEducacionIntro()"
                (input)="onFieldChange('parrafoSeccion14_indicadores_educacion_intro', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 11)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.11. Aspectos culturales (lenguas, dialectos, lugares)</h4>
          <div class="form-field">
            <label class="label">Tabla Lenguas Maternas</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['lenguasMaternasTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarLenguasMaternas(i, 'categoria', $any($event.target).value)"
                        placeholder="Castellano">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarLenguasMaternas(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarLenguasMaternas(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarLenguasMaternas(i)" *ngIf="((datos['lenguasMaternasTabla'] || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['lenguasMaternasTabla'] || datos['lenguasMaternasTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarLenguasMaternas()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarLenguasMaternas()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Tabla Religiones</label>
            <div class="table-editor">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['religionesTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarReligiones(i, 'categoria', $any($event.target).value)"
                        placeholder="Católica">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarReligiones(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarReligiones(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0%">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarReligiones(i)" *ngIf="((datos['religionesTabla'] || []).length > 1) && item.categoria !== 'Total'" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['religionesTabla'] || datos['religionesTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarReligiones()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarReligiones()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de la Iglesia</label>
            <app-image-upload
              [fotografias]="fotografiasIglesiaFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaIglesia'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Iglesia Matriz del anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Iglesia Matriz del anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasIglesiaChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 11)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Religión - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="4"
                [value]="obtenerTextoSeccion15ReligionCompleto()"
                (input)="onFieldChange('parrafoSeccion15_religion_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 12)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.12. Uso de los suelos y de los recursos naturales</h4>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Ojo de Agua 1</label>
              <input type="text" class="input" placeholder="Ej: Quinsa Rumi"
                [value]="formData['ojosAgua1'] || ''"
                (input)="onFieldChange('ojosAgua1', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Ojo de Agua 2</label>
              <input type="text" class="input" placeholder="Ej: Pallalli"
                [value]="formData['ojosAgua2'] || ''"
                (input)="onFieldChange('ojosAgua2', $any($event.target).value)">
            </div>
          </div>
          <div class="form-row">
            <div class="form-field">
              <label class="label">Río Agrícola</label>
              <input type="text" class="input" placeholder="Ej: Yuracyacu"
                [value]="formData['rioAgricola'] || ''"
                (input)="onFieldChange('rioAgricola', $any($event.target).value)">
            </div>
            <div class="form-field">
              <label class="label">Quebrada Agrícola</label>
              <input type="text" class="input" placeholder="Ej: Pucaccocha"
                [value]="formData['quebradaAgricola'] || ''"
                (input)="onFieldChange('quebradaAgricola', $any($event.target).value)">
            </div>
          </div>
          <div class="form-field">
            <label class="label">Fotografías del Reservorio</label>
            <app-image-upload
              [fotografias]="fotografiasReservorioFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaReservorio'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Reservorio del anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Reservorio del anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasReservorioChange($event)">
            </app-image-upload>
          </div>
          <div class="form-field">
            <label class="label">Fotografías de Uso de Suelos</label>
            <app-image-upload
              [fotografias]="fotografiasUsoSuelosFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaUsoSuelos'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Uso de los suelos en el anexo Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Uso de los suelos en el anexo Ayroca"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasUsoSuelosChange($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="esSubseccionAISD(seccionId, 12)">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Fuentes y Usos del Agua - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="6"
                [value]="obtenerTextoSeccion16AguaCompleto()"
                (input)="onFieldChange('parrafoSeccion16_agua_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre fuentes y usos del agua. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Tenencia de la Tierra y Recursos Naturales - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="8"
                [value]="obtenerTextoSeccion16RecursosNaturalesCompleto()"
                (input)="onFieldChange('parrafoSeccion16_recursos_naturales_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre tenencia de la tierra y recursos naturales. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 13)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.13. Índice de Desarrollo Humano distrital</h4>
          <div class="form-field">
            <label class="label">Tabla Componentes del IDH</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th colspan="2">Población</th>
                    <th colspan="2">Índice de Desarrollo Humano</th>
                    <th colspan="2">Esperanza de vida al nacer</th>
                    <th colspan="2">Con Educación secundaria completa (Población 18 años)</th>
                    <th colspan="2">Años de educación (Población 25 y más)</th>
                    <th colspan="2">Ingreso familiar per cápita</th>
                    <th></th>
                  </tr>
                  <tr>
                    <th>Habitantes</th>
                    <th>Rank</th>
                    <th>IDH</th>
                    <th>Rank</th>
                    <th>Años</th>
                    <th>Rank</th>
                    <th>Porcentaje</th>
                    <th>Rank</th>
                    <th>Años</th>
                    <th>Rank</th>
                    <th>N.S. mes</th>
                    <th>Rank</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['indiceDesarrolloHumanoTabla'] || []); let i = index">
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.poblacion || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'poblacion', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankIdh1 || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankIdh1', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.idh || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'idh', $any($event.target).value)"
                        placeholder="0,0000">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankEsperanza || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankEsperanza', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.esperanzaVida || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'esperanzaVida', $any($event.target).value)"
                        placeholder="0,00">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankEducacion1 || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankEducacion1', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.educacion || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'educacion', $any($event.target).value)"
                        placeholder="0,00">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankEducacion2 || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankEducacion2', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.anosEducacion || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'anosEducacion', $any($event.target).value)"
                        placeholder="0,00">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankAnios || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankAnios', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.ingreso || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'ingreso', $any($event.target).value)"
                        placeholder="0,0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.rankIngreso || item.rankIngresoFinal || ''"
                        (input)="actualizarIndiceDesarrolloHumano(i, 'rankIngreso', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarIndiceDesarrolloHumano(i)" *ngIf="(datos['indiceDesarrolloHumanoTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['indiceDesarrolloHumanoTabla'] || datos['indiceDesarrolloHumanoTabla'].length === 0">
                    <td colspan="13" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarIndiceDesarrolloHumano()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarIndiceDesarrolloHumano()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 14)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.14. Índice de necesidades básicas insatisfechas distrital</h4>
          
          <div class="form-field">
            <label class="label">Tabla NBI según población - CC Ayroca (Cuadro N° 3.35)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['nbiCCAyrocaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNBICCAyroca(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Población en Viviendas con hacinamiento">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNBICCAyroca(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNBICCAyroca(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNBICCAyroca(i)" *ngIf="(datos['nbiCCAyrocaTabla'] || []).length > 1 && item && item.categoria && !item.categoria.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['nbiCCAyrocaTabla'] || datos['nbiCCAyrocaTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNBICCAyroca()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNBICCAyroca()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tipos de NBI existentes - Distrito Cahuacho (Cuadro N° 3.36)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['nbiDistritoCahuachoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNBIDistritoCahuacho(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Viviendas sin servicios higiénicos">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNBIDistritoCahuacho(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNBIDistritoCahuacho(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNBIDistritoCahuacho(i)" *ngIf="(datos['nbiDistritoCahuachoTabla'] || []).length > 1 && item && item.categoria && !item.categoria.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['nbiDistritoCahuachoTabla'] || datos['nbiDistritoCahuachoTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNBIDistritoCahuacho()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNBIDistritoCahuacho()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 15)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.15. Organización social y liderazgo</h4>
          
          <div class="form-field">
            <label class="label">Comuneros calificados</label>
            <input type="number" class="form-control" 
              [value]="datos['comunerosCalificados'] || ''"
              (input)="onFieldChange('comunerosCalificados', $any($event.target).value)"
              placeholder="Ej: 65">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Autoridades y líderes sociales – CC Ayroca (Cuadro N° 3.37)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Organización</th>
                    <th>Cargo</th>
                    <th>Nombres y Apellidos</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos.autoridades || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.organizacion || ''"
                        (input)="actualizarAutoridades(i, 'organizacion', $any($event.target).value)"
                        placeholder="Ej: CC Ayroca (2024-2025)">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.cargo || ''"
                        (input)="actualizarAutoridades(i, 'cargo', $any($event.target).value)"
                        placeholder="Ej: Presidente">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombre || ''"
                        (input)="actualizarAutoridades(i, 'nombre', $any($event.target).value)"
                        placeholder="Ej: Miguel Ángel Sayaverde Rospigliosi">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAutoridades(i)" *ngIf="(datos.autoridades || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos.autoridades || datos.autoridades.length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAutoridades()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAutoridades()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field">
            <label class="label">Fotografías de Organización Social y Liderazgo</label>
            <app-image-upload
              [fotografias]="fotografiasOrganizacionSocialFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaOrganizacionSocial'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Autoridades de la CC Ayroca"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Organización Social y Liderazgo"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasOrganizacionSocialChangeGeneric($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="esSubseccionAISD(seccionId, 16)">
        <div class="form-group-section">
          <h4 class="section-title">A.1.16. Festividades, Costumbres y Turismo</h4>
          
          <div class="form-field">
            <label class="label">Sitio arqueológico</label>
            <input type="text" class="form-control" 
              [value]="datos['sitioArqueologico'] || ''"
              (input)="onFieldChange('sitioArqueologico', $any($event.target).value)"
              placeholder="Ej: Incahuasi">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Festividades principales – CC Ayroca (Cuadro N° 3.38)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Festividad</th>
                    <th>Fecha</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['festividades'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.festividad || ''"
                        (input)="actualizarFestividades(i, 'festividad', $any($event.target).value)"
                        placeholder="Ej: Carnavales">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.fecha || ''"
                        (input)="actualizarFestividades(i, 'fecha', $any($event.target).value)"
                        placeholder="Ej: Febrero">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarFestividades(i)" *ngIf="(datos['festividades'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['festividades'] || datos['festividades'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarFestividades()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarFestividades()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field">
            <label class="label">Fotografías de Festividades, Costumbres y Turismo</label>
            <app-image-upload
              [fotografias]="fotografiasFestividadesFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaFestividades'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Festividad de San Vicente Ferrer"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Festividades y Costumbres"
              fuenteDefault="GEADES, 2024"
              (fotografiasChange)="onFotografiasFestividadesChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B' || seccionId === '3.1.4.B.1'">
        <div class="form-group-section">
          <h4 class="section-title">B. Caracterización socioeconómica del Área de Influencia Social Indirecta (AISI) y B.1. Centro Poblado Cahuacho</h4>
          
          <div class="form-field">
            <label class="label">Centro Poblado AISI</label>
            <input type="text" class="form-control" 
              [value]="datos['centroPobladoAISI'] || ''"
              (input)="onFieldChange('centroPobladoAISI', $any($event.target).value)"
              placeholder="Ej: Cahuacho">
          </div>

          <div class="form-field">
            <label class="label">Ley de creación del distrito</label>
            <input type="text" class="form-control" 
              [value]="datos['leyCreacionDistrito'] || ''"
              (input)="onFieldChange('leyCreacionDistrito', $any($event.target).value)"
              placeholder="Ej: 8004">
          </div>

          <div class="form-field">
            <label class="label">Fecha de creación del distrito</label>
            <input type="text" class="form-control" 
              [value]="datos['fechaCreacionDistrito'] || ''"
              (input)="onFieldChange('fechaCreacionDistrito', $any($event.target).value)"
              placeholder="Ej: 22 de febrero de 1935">
          </div>

          <div class="form-field">
            <label class="label">Distrito anterior</label>
            <input type="text" class="form-control" 
              [value]="datos['distritoAnterior'] || ''"
              (input)="onFieldChange('distritoAnterior', $any($event.target).value)"
              placeholder="Ej: Caravelí">
          </div>

          <div class="form-field">
            <label class="label">Origen de pobladores 1</label>
            <input type="text" class="form-control" 
              [value]="datos['origenPobladores1'] || ''"
              (input)="onFieldChange('origenPobladores1', $any($event.target).value)"
              placeholder="Ej: Caravelí">
          </div>

          <div class="form-field">
            <label class="label">Origen de pobladores 2 (Provincia)</label>
            <input type="text" class="form-control" 
              [value]="datos['origenPobladores2'] || ''"
              (input)="onFieldChange('origenPobladores2', $any($event.target).value)"
              placeholder="Ej: Parinacochas">
          </div>

          <div class="form-field">
            <label class="label">Departamento de origen</label>
            <input type="text" class="form-control" 
              [value]="datos['departamentoOrigen'] || ''"
              (input)="onFieldChange('departamentoOrigen', $any($event.target).value)"
              placeholder="Ej: Ayacucho">
          </div>

          <div class="form-field">
            <label class="label">Anexos ejemplo</label>
            <input type="text" class="form-control" 
              [value]="datos['anexosEjemplo'] || ''"
              (input)="onFieldChange('anexosEjemplo', $any($event.target).value)"
              placeholder="Ej: Ayroca o Sóndor">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Ubicación referencial – Centro Poblado (Cuadro N° 3.39)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Localidad</th>
                    <th>Coordenadas</th>
                    <th>Altitud</th>
                    <th>Distrito</th>
                    <th>Provincia</th>
                    <th>Departamento</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['ubicacionCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.localidad || ''"
                        (input)="actualizarUbicacionCP(i, 'localidad', $any($event.target).value)"
                        placeholder="Ej: Cahuacho">
                    </td>
                    <td>
                      <textarea class="table-input" 
                        [value]="item.coordenadas || ''"
                        (input)="actualizarUbicacionCP(i, 'coordenadas', $any($event.target).value)"
                        placeholder="Ej: 18 L, E: 663 078 m, N: 8 285 498 m"
                        rows="2"></textarea>
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.altitud || ''"
                        (input)="actualizarUbicacionCP(i, 'altitud', $any($event.target).value)"
                        placeholder="Ej: 3 423 msnm">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.distrito || ''"
                        (input)="actualizarUbicacionCP(i, 'distrito', $any($event.target).value)"
                        placeholder="Ej: Cahuacho">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.provincia || ''"
                        (input)="actualizarUbicacionCP(i, 'provincia', $any($event.target).value)"
                        placeholder="Ej: Caravelí">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.departamento || ''"
                        (input)="actualizarUbicacionCP(i, 'departamento', $any($event.target).value)"
                        placeholder="Ej: Arequipa">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarUbicacionCP(i)" *ngIf="(datos['ubicacionCpTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['ubicacionCpTabla'] || datos['ubicacionCpTabla'].length === 0">
                    <td colspan="7" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarUbicacionCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarUbicacionCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías Vista panorámica del CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasCahuachoFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaCahuacho'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Vista panorámica del CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Vista panorámica del CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasCahuachoChangeGeneric($event)">
            </app-image-upload>
          </div>

          <div class="form-group-section" *ngIf="seccionId === '3.1.4.B' || seccionId === '3.1.4.B.1' || seccionId === '3.1.4.B.2'">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Introducción AISI - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="3"
                [value]="obtenerTextoSeccion21AISIIntroCompleto()"
                (input)="onFieldChange('parrafoSeccion21_aisi_intro_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>

            <div class="form-field">
              <label class="label">Centro Poblado - Texto Completo</label>
              <textarea 
                class="textarea" 
                rows="8"
                [value]="obtenerTextoSeccion21CentroPobladoCompleto()"
                (input)="onFieldChange('parrafoSeccion21_centro_poblado_completo', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite todo el bloque de texto sobre el centro poblado. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.1' || seccionId === '3.1.4.B.2.1'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.1. Aspectos demográficos</h4>
          
          <div class="form-field">
            <label class="label">Tabla Población por sexo – CP Cahuacho (Cuadro N° 3.40)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Sexo</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['poblacionSexoAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.sexo || ''"
                        (input)="actualizarPoblacionSexoAISI(i, 'sexo', $any($event.target).value)"
                        placeholder="Ej: Hombre">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionSexoAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionSexoAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPoblacionSexoAISI(i)" *ngIf="(datos['poblacionSexoAISI'] || []).length > 1 && !item.sexo?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['poblacionSexoAISI'] || datos['poblacionSexoAISI'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionSexoAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPoblacionSexoAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Población por grupo etario – CP Cahuacho (Cuadro N° 3.41)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['poblacionEtarioAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPoblacionEtarioAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: 0 a 14 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPoblacionEtarioAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPoblacionEtarioAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPoblacionEtarioAISI(i)" *ngIf="(datos['poblacionEtarioAISI'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['poblacionEtarioAISI'] || datos['poblacionEtarioAISI'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPoblacionEtarioAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPoblacionEtarioAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías de Institucionalidad</label>
            <app-image-upload
              [fotografias]="fotografiasInstitucionalidadAISIFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaCahuachoB11'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Institución pública del CP"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Institución pública del CP"
              fuenteDefault="GEADES, 2024"
              [requerido]="false"
              (fotografiasChange)="onFotografiasInstitucionalidadAISIChangeGeneric($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.2' || seccionId === '3.1.4.B.2.2'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.2. Indicadores y distribución de la Población Económicamente Activa</h4>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías de Aspectos Demográficos</label>
            <app-image-upload
              [fotografias]="fotografiasDemografiaAISIFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaCahuachoB12'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Población del CP"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Población del CP"
              fuenteDefault="GEADES, 2024"
              [requerido]="false"
              (fotografiasChange)="onFotografiasDemografiaAISIChangeGeneric($event)">
            </app-image-upload>
          </div>

          <div class="form-field">
            <label class="label">Población distrital</label>
            <input type="number" class="form-control" 
              [value]="datos['poblacionDistritalAISI'] || ''"
              (input)="onFieldChange('poblacionDistritalAISI', $any($event.target).value)"
              placeholder="Ej: 610">
          </div>

          <div class="form-field">
            <label class="label">PET distrital (14 años a más)</label>
            <input type="number" class="form-control" 
              [value]="datos['petDistritalAISI'] || ''"
              (input)="onFieldChange('petDistritalAISI', $any($event.target).value)"
              placeholder="Ej: 461">
          </div>

          <div class="form-field">
            <label class="label">Ingreso familiar per cápita (S/.)</label>
            <input type="text" class="form-control" 
              [value]="datos['ingresoPerCapitaAISI'] || ''"
              (input)="onFieldChange('ingresoPerCapitaAISI', $any($event.target).value)"
              placeholder="Ej: 391,06">
          </div>

          <div class="form-field">
            <label class="label">Ranking de ingreso</label>
            <input type="number" class="form-control" 
              [value]="datos['rankingIngresoAISI'] || ''"
              (input)="onFieldChange('rankingIngresoAISI', $any($event.target).value)"
              placeholder="Ej: 1191">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla PET según grupos de edad – CP Cahuacho (Cuadro N° 3.42)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['petGruposEdadAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPETGruposEdadAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: 14 a 29 años">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPETGruposEdadAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPETGruposEdadAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPETGruposEdadAISI(i)" *ngIf="(datos['petGruposEdadAISI'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['petGruposEdadAISI'] || datos['petGruposEdadAISI'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPETGruposEdadAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPETGruposEdadAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Conformación de la PEA y No PEA, según sexo – Distrito Cahuacho (Cuadro N° 3.43)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categorías</th>
                    <th>Hombres</th>
                    <th>Porcentaje</th>
                    <th>Mujeres</th>
                    <th>Porcentaje</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['peaDistritoSexoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEADistritoSexo(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: PEA">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEADistritoSexo(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEADistritoSexo(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEADistritoSexo(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEADistritoSexo(i)" *ngIf="(datos['peaDistritoSexoTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['peaDistritoSexoTabla'] || datos['peaDistritoSexoTabla'].length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEADistritoSexo()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEADistritoSexo()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Conformación de la PEA Ocupada y Desocupada, según sexo – Distrito Cahuacho (Cuadro N° 3.44)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categorías</th>
                    <th>Hombres</th>
                    <th>Porcentaje</th>
                    <th>Mujeres</th>
                    <th>Porcentaje</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['peaOcupadaDesocupadaTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: PEA Ocupada">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.hombres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'hombres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeHombres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'porcentajeHombres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mujeres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'mujeres', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentajeMujeres || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'porcentajeMujeres', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarPEAOcupadaDesocupada(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPEAOcupadaDesocupada(i)" *ngIf="(datos['peaOcupadaDesocupadaTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['peaOcupadaDesocupadaTabla'] || datos['peaOcupadaDesocupadaTabla'].length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupadaDesocupada()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupadaDesocupada()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías de PEA</label>
            <app-image-upload
              [fotografias]="fotografiasPEAAISIFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaPEA'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Actividad económica del CP"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Población Económicamente Activa del CP"
              fuenteDefault="GEADES, 2024"
              [requerido]="false"
              (fotografiasChange)="onFotografiasPEAAISIChangeGeneric($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.3' || seccionId === '3.1.4.B.2.3'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.3. Actividades económicas de la población</h4>
          <div class="form-field">
            <label class="label">Ciudad de origen del comercio</label>
            <input type="text" class="form-control" 
              [value]="datos['ciudadOrigenComercio'] || ''"
              (input)="onFieldChange('ciudadOrigenComercio', $any($event.target).value)"
              placeholder="Ej: Caravelí">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla PEA Ocupada según actividad económica – CP Cahuacho (Cuadro N° 3.45)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Actividad Económica</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['actividadesEconomicasAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.actividad || ''"
                        (input)="actualizarActividadesEconomicasAISI(i, 'actividad', $any($event.target).value)"
                        placeholder="Ej: Agricultura, ganadería, silvicultura y pesca">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarActividadesEconomicasAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarActividadesEconomicasAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarActividadesEconomicasAISI(i)" *ngIf="(datos['actividadesEconomicasAISI'] || []).length > 1 && !item.actividad?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['actividadesEconomicasAISI'] || datos['actividadesEconomicasAISI'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarActividadesEconomicasAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarActividadesEconomicasAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías Parcelas agrícolas en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasActividadesEconomicasFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Parcelas agrícolas en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Parcelas agrícolas en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasActividadesEconomicasChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías Bodega en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasMercadoFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Bodega en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Bodega en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasMercadoChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías de Actividades Económicas</label>
            <app-image-upload
              [fotografias]="fotografiasGanaderiaAISIFormMulti"
              [sectionId]="seccionId"
              [photoPrefix]="'fotografiaGanaderia'"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Actividad ganadera del CP"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Actividades Económicas del CP"
              fuenteDefault="GEADES, 2024"
              [requerido]="false"
              (fotografiasChange)="onFotografiasGanaderiaAISIChangeGeneric($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.4' || seccionId === '3.1.4.B.2.4'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.4. Vivienda</h4>
          <div class="form-field">
            <label class="label">Tabla Tipos de Vivienda – CP Cahuacho (Cuadro N° 3.46)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['tiposViviendaAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarTiposViviendaAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Casa independiente">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTiposViviendaAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTiposViviendaAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTiposViviendaAISI(i)" *ngIf="(datos['tiposViviendaAISI'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['tiposViviendaAISI'] || datos['tiposViviendaAISI'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTiposViviendaAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTiposViviendaAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Condición de Ocupación de la Vivienda – CP Cahuacho (Cuadro N° 3.47)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['condicionOcupacionAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCondicionOcupacionAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Ocupada, con personas presentes">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCondicionOcupacionAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCondicionOcupacionAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCondicionOcupacionAISI(i)" *ngIf="(datos['condicionOcupacionAISI'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['condicionOcupacionAISI'] || datos['condicionOcupacionAISI'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCondicionOcupacionAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCondicionOcupacionAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tipos de materiales de las viviendas – CP Cahuacho (Cuadro N° 3.48)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Tipo de material</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['materialesViviendaAISI'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Materiales de las paredes de las viviendas">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.tipoMaterial || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'tipoMaterial', $any($event.target).value)"
                        placeholder="Ej: Adobe">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarMaterialesViviendaAISI(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarMaterialesViviendaAISI(i)" *ngIf="(datos['materialesViviendaAISI'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['materialesViviendaAISI'] || datos['materialesViviendaAISI'].length === 0">
                    <td colspan="5" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarMaterialesViviendaAISI()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarMaterialesViviendaAISI()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías Estructura de viviendas en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasEstructuraAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Estructura de viviendas en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Estructura de viviendas en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasEstructuraAISIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.5' || seccionId === '3.1.4.B.2.5'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.5. Servicios básicos: Agua y desagüe; electricidad, energía y/o combustible; y disposición de residuos sólidos</h4>
          
          <div class="form-field">
            <label class="label">Tabla Tipos de abastecimiento de agua en las viviendas – CP Cahuacho (Cuadro N° 3.49)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['abastecimientoAguaCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAbastecimientoAguaCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Red pública dentro de la vivienda">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAbastecimientoAguaCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAbastecimientoAguaCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAbastecimientoAguaCP(i)" *ngIf="(datos['abastecimientoAguaCpTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['abastecimientoAguaCpTabla'] || datos['abastecimientoAguaCpTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAbastecimientoAguaCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAbastecimientoAguaCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tipos de saneamiento en las viviendas – CP Cahuacho (Cuadro N° 3.50)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['saneamientoCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarSaneamientoCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Red pública de desagüe dentro de la vivienda">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarSaneamientoCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarSaneamientoCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarSaneamientoCP(i)" *ngIf="(datos['saneamientoCpTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['saneamientoCpTabla'] || datos['saneamientoCpTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarSaneamientoCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarSaneamientoCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Contenedores de residuos sólidos en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasDesechosSolidosAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Contenedores de residuos sólidos en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Contenedores de residuos sólidos en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasDesechosSolidosAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Cobertura de alumbrado eléctrico en las viviendas – CP Cahuacho (Cuadro N° 3.51)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['coberturaElectricaCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCoberturaElectricaCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Si tiene alumbrado eléctrico">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCoberturaElectricaCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCoberturaElectricaCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCoberturaElectricaCP(i)" *ngIf="(datos['coberturaElectricaCpTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['coberturaElectricaCpTabla'] || datos['coberturaElectricaCpTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCoberturaElectricaCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCoberturaElectricaCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura eléctrica en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasElectricidadAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura eléctrica en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura eléctrica en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasElectricidadAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Combustibles para cocción en los hogares – CP Cahuacho (Cuadro N° 3.52)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['combustiblesCocinarCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarCombustiblesCocinarCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Leña">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarCombustiblesCocinarCP(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarCombustiblesCocinarCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarCombustiblesCocinarCP(i)" *ngIf="(datos['combustiblesCocinarCpTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['combustiblesCocinarCpTabla'] || datos['combustiblesCocinarCpTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarCombustiblesCocinarCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarCombustiblesCocinarCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.6' || seccionId === '3.1.4.B.2.6'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.6. Infraestructura para transportes y comunicaciones</h4>
          
          <div class="form-field">
            <label class="label">Costo mínimo de transporte (S/.)</label>
            <input type="number" class="form-control" 
              [value]="datos['costoTransporteMinimo'] || ''"
              (input)="onFieldChange('costoTransporteMinimo', $any($event.target).value)"
              placeholder="Ej: 25">
          </div>

          <div class="form-field">
            <label class="label">Costo máximo de transporte (S/.)</label>
            <input type="number" class="form-control" 
              [value]="datos['costoTransporteMaximo'] || ''"
              (input)="onFieldChange('costoTransporteMaximo', $any($event.target).value)"
              placeholder="Ej: 30">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura de transporte en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasTransporteAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de transporte en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura de transporte en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasTransporteAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Servicios de telecomunicaciones – CP Cahuacho (Cuadro N° 3.54)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Medio de comunicación</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['telecomunicacionesCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.medio || ''"
                        (input)="actualizarTelecomunicacionesCP(i, 'medio', $any($event.target).value)"
                        placeholder="Ej: Emisoras de radio">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.descripcion || ''"
                        (input)="actualizarTelecomunicacionesCP(i, 'descripcion', $any($event.target).value)"
                        placeholder="Ej: RPP, Nacional, Unión">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTelecomunicacionesCP(i)" *ngIf="(datos['telecomunicacionesCpTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['telecomunicacionesCpTabla'] || datos['telecomunicacionesCpTabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTelecomunicacionesCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTelecomunicacionesCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura de telecomunicaciones en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasTelecomunicacionesAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de telecomunicaciones en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura de telecomunicaciones en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasTelecomunicacionesAISIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.7' || seccionId === '3.1.4.B.2.7'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.7. Infraestructura en salud, educación, recreativa y deportiva</h4>
          
          <div class="form-field">
            <label class="label">Tabla Principales características del Puesto de Salud Cahuacho (Cuadro N° 3.55)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['puestoSaludCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarPuestoSaludCP(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Nombre">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.descripcion || ''"
                        (input)="actualizarPuestoSaludCP(i, 'descripcion', $any($event.target).value)"
                        placeholder="Ej: Puesto de Salud Cahuacho">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarPuestoSaludCP(i)" *ngIf="(datos['puestoSaludCpTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['puestoSaludCpTabla'] || datos['puestoSaludCpTabla'].length === 0">
                    <td colspan="3" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarPuestoSaludCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarPuestoSaludCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografía Infraestructura del Puesto de Salud Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasSaludAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura del Puesto de Salud Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura del Puesto de Salud Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasSaludAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Nombre de la IE con mayor cantidad de estudiantes</label>
            <input type="text" class="form-control" 
              [value]="datos['nombreIEMayorEstudiantes'] || ''"
              (input)="onFieldChange('nombreIEMayorEstudiantes', $any($event.target).value)"
              placeholder="Ej: IE Virgen de Copacabana">
          </div>

          <div class="form-field">
            <label class="label">Cantidad de estudiantes de la IE con mayor cantidad</label>
            <input type="number" class="form-control" 
              [value]="datos['cantidadEstudiantesIEMayor'] || ''"
              (input)="onFieldChange('cantidadEstudiantesIEMayor', $any($event.target).value)"
              placeholder="Ej: 28">
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Tabla Infraestructura educativa – CP Cahuacho (Cuadro N° 3.56)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Nombre de IE</th>
                    <th>Nivel</th>
                    <th>Tipo de Gestión</th>
                    <th>Cantidad de estudiantes</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['educacionCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nombreIE || ''"
                        (input)="actualizarEducacionCP(i, 'nombreIE', $any($event.target).value)"
                        placeholder="Ej: IE Cahuacho">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.nivel || ''"
                        (input)="actualizarEducacionCP(i, 'nivel', $any($event.target).value)"
                        placeholder="Ej: Inicial - Jardín">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.tipoGestion || ''"
                        (input)="actualizarEducacionCP(i, 'tipoGestion', $any($event.target).value)"
                        placeholder="Ej: Pública de gestión directa">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.cantidadEstudiantes || ''"
                        (input)="actualizarEducacionCP(i, 'cantidadEstudiantes', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarEducacionCP(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarEducacionCP(i)" *ngIf="(datos['educacionCpTabla'] || []).length > 1 && !item.nombreIE?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['educacionCpTabla'] || datos['educacionCpTabla'].length === 0">
                    <td colspan="6" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarEducacionCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarEducacionCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías de Educación</label>
            <app-image-upload
              [fotografias]="fotografiasEducacionAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Infraestructura de la IE Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Infraestructura de la IE Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasEducacionAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías Plaza de toros del CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasRecreacionAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Plaza de toros del CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Plaza de toros del CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasRecreacionAISIChange($event)">
            </app-image-upload>
          </div>

          <div class="form-field" style="margin-top: 20px;">
            <label class="label">Fotografías Losa deportiva en el CP Cahuacho</label>
            <app-image-upload
              [fotografias]="fotografiasDeporteAISIFormMulti"
              [permitirMultiples]="true"
              labelTitulo="Título de la fotografía"
              labelFuente="Fuente de la fotografía"
              labelImagen="Fotografía - Imagen"
              placeholderTitulo="Ej: Losa deportiva en el CP Cahuacho"
              placeholderFuente="Ej: GEADES, 2024"
              tituloDefault="Losa deportiva en el CP Cahuacho"
              fuenteDefault="GEADES, 2024"
              [requerido]="true"
              (fotografiasChange)="onFotografiasDeporteAISIChange($event)">
            </app-image-upload>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.8' || seccionId === '3.1.4.B.2.8'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.8. Indicadores de salud</h4>
          
          <div class="form-field">
            <label class="label">Tabla Indicadores de natalidad y mortalidad – CP Cahuacho (Cuadro N° 3.57)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Año</th>
                    <th>Natalidad</th>
                    <th>Mortalidad</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['natalidadMortalidadCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.anio || ''"
                        (input)="actualizarNatalidadMortalidadCP(i, 'anio', $any($event.target).value)"
                        placeholder="Ej: 2023">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.natalidad || ''"
                        (input)="actualizarNatalidadMortalidadCP(i, 'natalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.mortalidad || ''"
                        (input)="actualizarNatalidadMortalidadCP(i, 'mortalidad', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNatalidadMortalidadCP(i)" *ngIf="(datos['natalidadMortalidadCpTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['natalidadMortalidadCpTabla'] || datos['natalidadMortalidadCpTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNatalidadMortalidadCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNatalidadMortalidadCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Casos por grupos de morbilidad – Distrito Cahuacho (Cuadro N° 3.58)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th rowspan="2">Grupo de Morbilidad</th>
                    <th colspan="5">Bloques etarios</th>
                    <th rowspan="2">Casos Totales</th>
                    <th rowspan="2"></th>
                  </tr>
                  <tr>
                    <th>0 – 11</th>
                    <th>12 – 17</th>
                    <th>18 – 29</th>
                    <th>30 – 59</th>
                    <th>60 - ></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['morbilidadCpTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.grupo || ''"
                        (input)="actualizarMorbilidadCP(i, 'grupo', $any($event.target).value)"
                        placeholder="Ej: Enfermedades infecciosas intestinales">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad0_11 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad0_11', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad12_17 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad12_17', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad18_29 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad18_29', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad30_59 || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad30_59', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.edad60_mas || ''"
                        (input)="actualizarMorbilidadCP(i, 'edad60_mas', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarMorbilidadCP(i, 'casos', $any($event.target).value)"
                        placeholder="0"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarMorbilidadCP(i)" *ngIf="(datos['morbilidadCpTabla'] || []).length > 1" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['morbilidadCpTabla'] || datos['morbilidadCpTabla'].length === 0">
                    <td colspan="8" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarMorbilidadCP()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarMorbilidadCP()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Población según tipo de seguro de salud afiliado – CP Cahuacho (Cuadro N° 3.59)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['afiliacionSaludTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarAfiliacionSaludTabla(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Seguro Integral de Salud (SIS)">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarAfiliacionSaludTabla(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarAfiliacionSaludTabla(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarAfiliacionSaludTabla(i)" *ngIf="(datos['afiliacionSaludTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['afiliacionSaludTabla'] || datos['afiliacionSaludTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarAfiliacionSaludTabla()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarAfiliacionSaludTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="seccionId === '3.1.4.B.1.9' || seccionId === '3.1.4.B.2.9'">
        <div class="form-group-section">
          <h4 class="section-title">B.1.9. Indicadores de educación</h4>
          
          <div class="form-field">
            <label class="label">Tabla Población de 15 años a más según nivel educativo alcanzado – CP Cahuacho (Cuadro N° 3.60)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['nivelEducativoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.categoria || ''"
                        (input)="actualizarNivelEducativoTabla(i, 'categoria', $any($event.target).value)"
                        placeholder="Ej: Sin nivel o Inicial">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarNivelEducativoTabla(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarNivelEducativoTabla(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarNivelEducativoTabla(i)" *ngIf="(datos['nivelEducativoTabla'] || []).length > 1 && !item.categoria?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['nivelEducativoTabla'] || datos['nivelEducativoTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarNivelEducativoTabla()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarNivelEducativoTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-field" style="margin-top: 30px;">
            <label class="label">Tabla Tasa de analfabetismo en población de 15 años a más – CP Cahuacho (Cuadro N° 3.61)</label>
            <div class="table-editor" style="overflow-x: auto;">
              <table class="editor-table">
                <thead>
                  <tr>
                    <th>Indicador</th>
                    <th>Casos</th>
                    <th>Porcentaje</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of (datos['tasaAnalfabetismoTabla'] || []); let i = index">
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.indicador || ''"
                        (input)="actualizarTasaAnalfabetismoTabla(i, 'indicador', $any($event.target).value)"
                        placeholder="Ej: Sabe leer y escribir">
                    </td>
                    <td>
                      <input type="number" class="table-input" 
                        [value]="item.casos || ''"
                        (input)="actualizarTasaAnalfabetismoTabla(i, 'casos', $any($event.target).value)"
                        placeholder="0">
                    </td>
                    <td>
                      <input type="text" class="table-input" 
                        [value]="item.porcentaje || ''"
                        (input)="actualizarTasaAnalfabetismoTabla(i, 'porcentaje', $any($event.target).value)"
                        placeholder="0,00 %"
                        readonly>
                    </td>
                    <td>
                      <button type="button" class="btn-icon" (click)="eliminarTasaAnalfabetismoTabla(i)" *ngIf="(datos['tasaAnalfabetismoTabla'] || []).length > 1 && !item.indicador?.toLowerCase().includes('total')" title="Eliminar fila">
                        ×
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="!datos['tasaAnalfabetismoTabla'] || datos['tasaAnalfabetismoTabla'].length === 0">
                    <td colspan="4" style="text-align: center; padding: 10px;">
                      <button type="button" class="btn btn-secondary" (click)="inicializarTasaAnalfabetismoTabla()">
                        Agregar Primera Fila
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button type="button" class="btn btn-secondary" (click)="agregarTasaAnalfabetismoTabla()" style="margin-top: 10px;">
              + Agregar Fila
            </button>
          </div>

          <div class="form-group-section" *ngIf="seccionId === '3.1.4.B.1.9' || seccionId === '3.1.4.B.2.9'">
            <h4 class="section-title">Editar Párrafos</h4>
            
            <div class="form-field">
              <label class="label">Introducción - Indicadores de Educación</label>
              <textarea 
                class="textarea" 
                rows="4"
                [value]="obtenerTextoSeccion30IndicadoresEducacionIntro()"
                (input)="onFieldChange('parrafoSeccion30_indicadores_educacion_intro', $any($event.target).value)"></textarea>
              <small class="form-hint">Edite el texto completo. Deje vacío para usar el texto por defecto.</small>
            </div>
          </div>
        </div>
      </ng-container>

    </div>

    <div class="formulario-footer">
      <button class="btn btn-ghost" (click)="seccionAnterior()" [disabled]="!puedeIrAnterior">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        Anterior
      </button>
      <button class="btn btn-primary" (click)="seccionSiguiente()" [disabled]="!puedeIrSiguiente">
        Siguiente
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>
    </div>
  </div>
</div>

