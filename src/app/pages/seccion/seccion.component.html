<div class="seccion-container" [class.test-data-active]="testDataActive">
  <!-- Toggle para mobile (visible solo en mobile) -->
  <div class="mobile-view-toggle">
    <button 
      class="toggle-btn" 
      [class.active]="mobileViewMode === 'preview'"
      (click)="toggleMobileView()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
      Vista Previa
    </button>
    <button 
      class="toggle-btn" 
      [class.active]="mobileViewMode === 'form'"
      (click)="toggleMobileView()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <line x1="9" y1="9" x2="15" y2="9"/>
        <line x1="9" y1="13" x2="15" y2="13"/>
        <line x1="9" y1="17" x2="15" y2="17"/>
      </svg>
      Formulario
    </button>
  </div>

  <div class="seccion-preview" [style.flex]="previewFlex" [class.mobile-hidden]="mobileViewMode === 'form'">
    <div class="preview-header">
      <div class="preview-header-titles">
        <h3 *ngIf="seccionPadreTitulo" class="seccion-padre-titulo">{{ seccionPadreTitulo }}</h3>
        <h2>{{ seccionTitulo }}</h2>
      </div>
      <div class="preview-actions">
        <button class="btn btn-clear" (click)="limpiarDatos()" title="Limpiar todos los datos guardados">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12c0 1.66-1.34 3-3 3H6c-1.66 0-3-1.34-3-3s1.34-3 3-3h12c1.66 0 3 1.34 3 3z"/>
            <path d="M9 9V6c0-1.1.9-2 2-2h2c1.1 0 2 .9 2 2v3"/>
            <path d="M12 9v9"/>
            <path d="M8 9h8"/>
          </svg>
          Limpiar
        </button>
        <button class="btn btn-test" (click)="llenarDatosPrueba()" title="Llenar todos los campos con datos de ejemplo">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          Llenar Datos
        </button>
      </div>
    </div>
    <div class="preview-content scrollbar-thin">
      <div class="preview-document">
        <div class="preview preview-static">
          <div class="viewport-content">
            <ng-container #previewHost></ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="resizer" (mousedown)="startResize($event)" 
       [class.resizing]="isResizing"
       title="Arrastra para redimensionar"></div>

  <div class="seccion-formulario" [style.flex]="formularioFlex" [class.mobile-hidden]="mobileViewMode === 'preview'">
    <div class="formulario-header">
      <h3>Formulario de Datos</h3>
      <span class="badge badge-primary">{{ seccionTitulo }}</span>
    </div>
    <div class="formulario-content scrollbar-thin">
      <div *ngIf="(validationErrorsSignal() | slice:0).length > 0" class="validation-banner" style="background:#ffe5e5;border:1px solid #ffb3b3;border-radius:6px;margin-bottom:16px;padding:12px;">
        <strong>Referencias inválidas detectadas:</strong>
        <ul style="margin:8px 0 0;padding-left:18px;">
          <li *ngFor="let error of (validationErrorsSignal() | slice:0)">
            Sección {{ error.sectionId }} · Tabla {{ error.tableId }} · fila {{ error.rowId }} — {{ error.message }}
          </li>
        </ul>
      </div>
      <ng-container #formHost></ng-container>

    </div>

    <div class="formulario-footer">
      <button class="btn btn-ghost" (click)="seccionAnterior()" [disabled]="!puedeIrAnterior">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        Anterior
      </button>
      <button *ngIf="!esUltimaSeccion" class="btn btn-primary" (click)="seccionSiguiente()" [disabled]="!puedeIrSiguiente">
        Siguiente
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>
      <button *ngIf="esUltimaSeccion" class="btn btn-primary" (click)="irAPlantilla()">
        Ver Plantilla
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </button>
    </div>
  </div>
</div>

