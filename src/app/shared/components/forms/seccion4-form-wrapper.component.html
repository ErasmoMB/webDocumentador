<div class="form-group-section">
  <h4 class="section-title">3.1.4. Caracterización socioeconómica de las Áreas de Influencia Social</h4>
  <h4 class="section-title" style="margin-top: 15px;">A. Caracterización socioeconómica del Área de Influencia Social Directa (AISD)</h4>
  
  <div class="form-group-section" style="margin-top: 20px;">
    <h4 class="section-title">Editar Párrafos</h4>
    
    <app-paragraph-editor
      fieldId="parrafoSeccion4_introduccion_aisd"
      label="Introducción AISD"
      hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
      [rows]="3"
      [value]="obtenerTextoSeccion4IntroduccionAISD()"
      (valueChange)="onFieldChange('parrafoSeccion4_introduccion_aisd', $event)">
    </app-paragraph-editor>
  </div>
</div>

<div class="form-group-section" style="margin-top: 30px;">
  <h4 class="section-title" *ngIf="seccionId.includes('3.1.4.A.1')">A.1. Comunidad Campesina {{ obtenerNombreComunidadActual() }}</h4>
  <h4 class="section-title" *ngIf="seccionId.includes('3.1.4.A.2')">A.2. Comunidad Campesina {{ obtenerNombreComunidadActual() }}</h4>
  <h4 class="section-title" *ngIf="!seccionId.includes('3.1.4.A.1') && !seccionId.includes('3.1.4.A.2')">A.1. Comunidad Campesina {{ obtenerNombreComunidadActual() }}</h4>
  
  <div class="form-group-section" style="margin-top: 15px;">
    <h4 class="section-title">Editar Párrafos</h4>
    
    <app-paragraph-editor
      fieldId="parrafoSeccion4_comunidad_completo"
      label="Información de la Comunidad - Texto Completo"
      hint="Edite todo el bloque de texto sobre la comunidad. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
      [rows]="12"
      [value]="obtenerTextoSeccion4ComunidadCompleto()"
      (valueChange)="onFieldChange('parrafoSeccion4_comunidad_completo', $event)">
    </app-paragraph-editor>
  </div>
</div>

<div class="form-group-section" style="margin-top: 30px;">
  <h4 class="section-title">Información General de la Comunidad</h4>
  
  <div class="form-field" style="margin-top: 15px;">
    <label class="label">Distrito Principal <span class="required">*</span></label>
    <select 
      *ngIf="obtenerDistritosDeComunidad().length > 1"
      class="input" 
      [value]="formData['distritoSeleccionado'] || ''"
      (change)="onDistritoPrincipalChange($any($event.target).value)">
      <option value="">Seleccione un distrito</option>
      <option *ngFor="let distrito of obtenerDistritosDeComunidad()" [value]="distrito">{{ distrito }}</option>
    </select>
    <input 
      *ngIf="obtenerDistritosDeComunidad().length === 1"
      type="text" 
      class="input" 
      [value]="formData['distritoSeleccionado'] || obtenerDistritosDeComunidad()[0] || ''"
      [disabled]="true">
    <small class="form-hint" *ngIf="obtenerDistritosDeComunidad().length > 1">Seleccione el distrito principal de la comunidad</small>
    <small class="form-hint" *ngIf="obtenerDistritosDeComunidad().length === 1">Distrito único de la comunidad</small>
  </div>

  <div class="form-row" style="margin-top: 15px;">
    <div class="form-field">
      <label class="label">Coordenadas</label>
      <input type="text" class="input" placeholder="Ej: 18L E: 660 619 m N: 8 291 173 m" 
        [value]="formData['coordenadasAISD'] || ''"
        (input)="onFieldChange('coordenadasAISD', $any($event.target).value)">
    </div>
    <div class="form-field">
      <label class="label">Altitud (msnm) <span class="required">*</span></label>
      <input type="text" class="input" placeholder="Ej: 3 599" 
        [value]="formData['altitudAISD'] || ''"
        (input)="onAltitudChange($any($event.target).value)"
        (blur)="normalizarAltitud()">
    </div>
  </div>
</div>

<div class="form-group-section" style="margin-top: 30px;">
  <h4 class="section-title">Cuadro 1: Ubicación referencial</h4>
  
  <div class="form-field" style="margin-bottom: 15px;">
    <label class="label">Título <span class="required">*</span></label>
    <input type="text" class="input" placeholder="Ej: Ubicación referencial" 
      [value]="formData['cuadroTituloAISD1'] || ''"
      (input)="onFieldChange('cuadroTituloAISD1', $any($event.target).value)">
  </div>

  <div class="form-field" style="margin-top: 15px;">
    <label class="label">Tabla de Ubicación Referencial</label>
    <app-dynamic-table
      [datos]="datos"
      [config]="tablaAISD1Config"
      [columns]="[
        { field: 'localidad', label: 'Localidad', type: 'text', placeholder: 'Ej: ' + obtenerNombreComunidadActual() },
        { field: 'coordenadas', label: 'Coordenadas', type: 'text', placeholder: 'Ej: 18L E: 660 619 m N: 8 291 173 m' },
        { field: 'altitud', label: 'Altitud', type: 'text', placeholder: 'Ej: 3 599 msnm' },
        { field: 'distrito', label: 'Distrito', type: 'text', placeholder: 'Ej: ' + (datos.distritoSeleccionado || '') },
        { field: 'provincia', label: 'Provincia', type: 'text', placeholder: 'Ej: ' + (datos.provinciaSeleccionada || '') },
        { field: 'departamento', label: 'Departamento', type: 'text', placeholder: 'Ej: ' + (datos.departamentoSeleccionado || '') }
      ]"
      [tablaKey]="'tablaAISD1Datos'"
      [totalKey]="'localidad'"
      (tableUpdated)="onTablaAISD1Updated()">
    </app-dynamic-table>
  </div>

  <div class="form-field" style="margin-top: 15px;">
    <label class="label">Fuente <span class="required">*</span></label>
    <input type="text" class="input" placeholder="Ej: GEADES (2024)" 
      [value]="formData['cuadroFuenteAISD1'] || ''"
      (input)="onFieldChange('cuadroFuenteAISD1', $any($event.target).value)">
  </div>
  <small class="form-hint">El número de cuadro se genera automáticamente</small>
</div>

<div class="form-field" style="margin-top: 30px;">
  <label class="label">Fotografías de Ubicación Referencial</label>
  <app-image-upload
    [fotografias]="fotografiasUbicacionFormMulti"
    [sectionId]="seccionId"
    [photoPrefix]="'fotografiaUbicacionReferencial'"
    [permitirMultiples]="true"
    labelTitulo="Título de la fotografía"
    labelFuente="Fuente de la fotografía"
    labelImagen="Fotografía - Imagen"
    placeholderTitulo="Ej: Ubicación referencial"
    placeholderFuente="Ej: GEADES, 2024"
    tituloDefault="Ubicación referencial"
    fuenteDefault="GEADES, 2024"
    [requerido]="false"
    (fotografiasChange)="onFotografiasUbicacionChange($event)">
  </app-image-upload>
</div>

<div class="form-group-section" style="margin-top: 30px;">
  <h4 class="section-title">Párrafo de Caracterización de Indicadores</h4>
  
  <app-paragraph-editor
    fieldId="parrafoSeccion4_caracterizacion_indicadores"
    label="Caracterización de Indicadores"
    hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
    [rows]="3"
    [value]="obtenerTextoSeccion4CaracterizacionIndicadores()"
    (valueChange)="onFieldChange('parrafoSeccion4_caracterizacion_indicadores', $event)">
  </app-paragraph-editor>
</div>

<div class="form-group-section">
  <h4 class="section-title">Cuadro 2: Población y viviendas</h4>
  <div class="form-field">
    <label class="label">Título <span class="required">*</span></label>
    <input type="text" class="input" placeholder="Ej: Cantidad total de población y viviendas" 
      [value]="formData['cuadroTituloAISD2'] || ''"
      (input)="onFieldChange('cuadroTituloAISD2', $any($event.target).value)">
  </div>
  
  <div class="form-field" style="margin-top: 15px;">
    <label class="label">Tabla de Población y Viviendas</label>
    <app-dynamic-table
      [datos]="datos"
      [config]="tablaAISD2Config"
      [columns]="[
        { field: 'punto', label: 'Punto de Población (INEI)', type: 'text', placeholder: 'Ej: CAHUACHO' },
        { field: 'codigo', label: 'Código', type: 'text', placeholder: 'Ej: 080401001' },
        { field: 'poblacion', label: 'Población', type: 'number', placeholder: 'Ej: 450' },
        { field: 'viviendasEmpadronadas', label: 'Viviendas Empadronadas', type: 'number', placeholder: 'Ej: 120' },
        { field: 'viviendasOcupadas', label: 'Viviendas Ocupadas', type: 'number', placeholder: 'Ej: 100' }
      ]"
      [tablaKey]="'tablaAISD2Datos'"
      [totalKey]="'punto'"
      (tableUpdated)="onTablaAISD2Updated()">
    </app-dynamic-table>
  </div>

  <div class="form-field">
    <label class="label">Fuente <span class="required">*</span></label>
    <input type="text" class="input" placeholder="Ej: Reporte de Indicadores... REDINFORMA (MIDIS)" 
      [value]="formData['cuadroFuenteAISD2'] || ''"
      (input)="onFieldChange('cuadroFuenteAISD2', $any($event.target).value)">
  </div>
  <small class="form-hint">El número de cuadro se genera automáticamente</small>
</div>

<div class="form-group-section">
  <h4 class="section-title">Fotografías después de Tabla Población y Viviendas</h4>
  <app-image-upload
    [fotografias]="fotografiasPoblacionFormMulti"
    [sectionId]="seccionId"
    [photoPrefix]="'fotografiaPoblacionViviendas'"
    [permitirMultiples]="true"
    labelTitulo="Título de la fotografía"
    labelFuente="Fuente de la fotografía"
    labelImagen="Fotografía - Imagen"
    placeholderTitulo="Ej: Población y viviendas de la CC"
    placeholderFuente="Ej: GEADES, 2024"
    tituloDefault="Población y Viviendas"
    fuenteDefault="GEADES, 2024"
    (fotografiasChange)="onFotografiasPoblacionChange($event)">
  </app-image-upload>
</div>

