<div class="form-group-section">
  <h4 class="section-title">A.1.3. Indicadores y distribución de la Población Económicamente Activa por rama de actividad, tipo de empleo, tasas e ingresos.</h4>
  
  <div class="form-group-section" style="margin-top: 20px;">
    <h4 class="section-title">a. Población en edad de Trabajar (PET)</h4>
    
    <div class="form-group-section" style="margin-top: 15px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoPET"
        label="Población en edad de Trabajar (PET) - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="4"
        [value]="obtenerTextoPET()"
        (valueChange)="onFieldChange('textoPET', $event)">
      </app-paragraph-editor>
    </div>
    
    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Tabla PET según grupos de edad</label>
      <app-dynamic-table
        [datos]="datos"
        [config]="getPetConfig()"
        [columns]="[
          { field: 'categoria', label: 'Categoría', type: 'text', placeholder: 'Ej: 15 a 29 años' },
          { field: 'casos', label: 'Casos', type: 'number', placeholder: '0' },
          { field: 'porcentaje', label: 'Porcentaje', type: 'text', placeholder: '0,00 %', readonly: true }
        ]"
        [tablaKey]="getTablaKeyPET()"
        [totalKey]="'categoria'"
        [customFieldChangeHandler]="onPETFieldChange.bind(this)"
        (tableUpdated)="onPETTableUpdated()">
      </app-dynamic-table>
      <div class="table-editor" *ngIf="getTablaPET().length > 0" style="margin-top: 10px;">
        <table class="editor-table">
          <tbody>
            <tr class="total-row">
              <td><strong>Total</strong></td>
              <td>
                <input type="text" class="table-input" 
                  [value]="getTotalPET()"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="100,00 %"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="form-group-section" style="margin-top: 30px;">
    <h4 class="section-title">Editar Párrafos</h4>
    
    <app-paragraph-editor
      fieldId="textoDetalePEA"
      label="Detalle PEA - Texto Completo"
      hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
      [rows]="3"
      [value]="obtenerTextoDetalePEA()"
      (valueChange)="onFieldChange('textoDetalePEA', $event)">
    </app-paragraph-editor>
  </div>

  <div class="form-group-section" style="margin-top: 30px;">
    <h4 class="section-title">b. Población Económicamente Activa (PEA)</h4>
    
    <div class="form-group-section" style="margin-top: 15px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoDefinicionPEA"
        label="Definición PEA - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="3"
        [value]="obtenerTextoDefinicionPEA()"
        (valueChange)="onFieldChange('textoDefinicionPEA', $event)">
      </app-paragraph-editor>
    </div>
    
    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Tabla PEA y No PEA según sexo</label>
      <app-dynamic-table
        [datos]="datos"
        [config]="peaConfig"
        [columns]="[
          { field: 'categoria', label: 'Categorías', type: 'text', placeholder: 'Ej: PEA', readonly: true },
          { field: 'hombres', label: 'Hombres', type: 'number', placeholder: '0' },
          { field: 'porcentajeHombres', label: 'Porcentaje', type: 'text', placeholder: '0,00 %', readonly: true },
          { field: 'mujeres', label: 'Mujeres', type: 'number', placeholder: '0' },
          { field: 'porcentajeMujeres', label: 'Porcentaje', type: 'text', placeholder: '0,00 %', readonly: true },
          { field: 'casos', label: 'Casos', type: 'number', placeholder: '0', readonly: true },
          { field: 'porcentaje', label: 'Porcentaje', type: 'text', placeholder: '0,00 %', readonly: true }
        ]"
        [tablaKey]="'peaTabla'"
        [totalKey]="'categoria'"
        [customFieldChangeHandler]="onPEAFieldChange.bind(this)"
        (tableUpdated)="onPEATableUpdated()">
      </app-dynamic-table>
      <div class="table-editor" *ngIf="datos['peaTabla'] && datos['peaTabla'].length > 0" style="margin-top: 10px;">
        <table class="editor-table">
          <tbody>
            <tr class="total-row">
              <td><strong>Total</strong></td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  [value]="getTotalPEA()"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="100,00 %"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="form-group-section" style="margin-top: 20px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoAnalisisPEA"
        label="Análisis PEA - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="3"
        [value]="obtenerTextoAnalisisPEA()"
        (valueChange)="onFieldChange('textoAnalisisPEA', $event)">
      </app-paragraph-editor>
    </div>
  </div>
</div>

<app-seccion7 [seccionId]="seccionId" [modoFormulario]="true"></app-seccion7>

<div class="form-group-section">
  <div class="form-group-section" style="margin-top: 30px;">
    <h4 class="section-title">b.2. Ingresos de la población</h4>
    
    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Ingreso Familiar Per Cápita (S/.)</label>
      <input type="text" class="input" placeholder="Ej: 391,06"
        [value]="formData['ingresoFamiliarPerCapita'] || ''"
        (input)="onFieldChange('ingresoFamiliarPerCapita', $any($event.target).value)">
    </div>
    
    <div class="form-field" style="margin-top: 15px;">
      <label class="label">Ranking Ingreso Per Cápita</label>
      <input type="text" class="input" placeholder="Ej: 1191"
        [value]="formData['rankingIngresoPerCapita'] || ''"
        (input)="onFieldChange('rankingIngresoPerCapita', $any($event.target).value)">
    </div>
  </div>

  <div class="form-group-section" style="margin-top: 30px;">
    <h4 class="section-title">b.3. Índice de desempleo</h4>
    
    <div class="form-group-section" style="margin-top: 15px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoIndiceDesempleo"
        label="Índice de Desempleo - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="3"
        [value]="obtenerTextoIndiceDesempleo()"
        (valueChange)="onFieldChange('textoIndiceDesempleo', $event)">
      </app-paragraph-editor>
    </div>
    
    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Tabla PEA Ocupada y Desocupada según sexo</label>
      <div class="table-editor">
        <table class="editor-table">
          <thead>
            <tr>
              <th>Categoría</th>
              <th>Hombres</th>
              <th>% Hombres</th>
              <th>Mujeres</th>
              <th>% Mujeres</th>
              <th>Casos</th>
              <th>Porcentaje</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of getPEAOcupadaSinTotal(); let i = index">
              <td>
                <input type="text" class="table-input" 
                  [value]="item.categoria || ''"
                  (input)="actualizarPEAOcupada(i, 'categoria', $any($event.target).value)"
                  placeholder="PEA Ocupada/Desocupada">
              </td>
              <td>
                <input type="number" class="table-input" 
                  [value]="item.hombres || ''"
                  (input)="actualizarPEAOcupada(i, 'hombres', $any($event.target).value)"
                  placeholder="0">
              </td>
              <td>
                <input type="text" class="table-input" 
                  [value]="item.porcentajeHombres || ''"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;"
                  placeholder="0%">
              </td>
              <td>
                <input type="number" class="table-input" 
                  [value]="item.mujeres || ''"
                  (input)="actualizarPEAOcupada(i, 'mujeres', $any($event.target).value)"
                  placeholder="0">
              </td>
              <td>
                <input type="text" class="table-input" 
                  [value]="item.porcentajeMujeres || ''"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;"
                  placeholder="0%">
              </td>
              <td>
                <input type="number" class="table-input" 
                  [value]="item.casos || ''"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;"
                  placeholder="0">
              </td>
              <td>
                <input type="text" class="table-input" 
                  [value]="item.porcentaje || ''"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;"
                  placeholder="0%">
              </td>
              <td>
                <button type="button" class="btn-icon" (click)="eliminarPEAOcupada(i)" *ngIf="(datos['peaOcupadaTabla'] || []).length > 1 && item.categoria !== 'Total'" title="Eliminar fila">
                  ×
                </button>
              </td>
            </tr>
            <tr class="total-row" *ngIf="getPEAOcupadaSinTotal().length > 0">
              <td><strong>Total</strong></td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="____"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  [value]="getTotalPEAOcupada()"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="100,00 %"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
            </tr>
            <tr *ngIf="!datos['peaOcupadaTabla'] || datos['peaOcupadaTabla'].length === 0">
              <td colspan="8" style="text-align: center; padding: 10px;">
                <button type="button" class="btn btn-secondary" (click)="inicializarPEAOcupada()">
                  Agregar Filas
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button type="button" class="btn btn-secondary" (click)="agregarPEAOcupada()" style="margin-top: 10px;">
        + Agregar Fila
      </button>
    </div>

    <div class="form-group-section" style="margin-top: 20px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoAnalisisOcupacion"
        label="Análisis Ocupación - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="3"
        [value]="obtenerTextoAnalisisOcupacion()"
        (valueChange)="onFieldChange('textoAnalisisOcupacion', $event)">
      </app-paragraph-editor>
    </div>
  </div>
</div>
