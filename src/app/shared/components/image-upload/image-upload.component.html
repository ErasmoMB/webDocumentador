<ng-template #vistaTemplate>
  <div class="image-upload-container" *ngIf="hasFotos()" style="text-align: center;">
    <div *ngIf="permitirMultiples; else vistaUnica">
      <ng-container *ngFor="let foto of _fotografias; let i = index">
        <div *ngIf="foto?.imagen" class="foto-item" style="margin: 0 auto 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px; max-width: 520px;">
          <p class="foto-numero" *ngIf="mostrarNumero" style="font-weight: 600; margin: 0 0 6px;">Fotograf√≠a N¬∞ {{ getFormattedPhotoNumber(i) }}</p>
          <p class="foto-titulo" *ngIf="mostrarTitulo" style="margin: 0 0 10px;">{{ foto.titulo || tituloDefault }}</p>
          <div class="foto-container" style="margin-bottom: 8px;">
            <img [src]="foto.imagen" [alt]="foto.titulo" class="foto-imagen" style="max-width: 100%; height: auto;">
          </div>
          <p class="foto-fuente" *ngIf="mostrarFuente" style="margin: 0;">FUENTE: {{ foto.fuente || fuenteDefault }}</p>
        </div>
      </ng-container>
    </div>
    <ng-template #vistaUnica>
      <ng-container *ngIf="_fotografias.length > 0 && _fotografias[0].imagen as fotoUnica">
        <div class="foto-item" style="margin: 0 auto 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px; max-width: 520px;">
          <p class="foto-numero" *ngIf="mostrarNumero" style="font-weight: 600; margin: 0 0 6px;">Fotograf√≠a N¬∞ {{ getFormattedPhotoNumber(0) }}</p>
          <p class="foto-titulo" *ngIf="mostrarTitulo" style="margin: 0 0 10px;">{{ _fotografias[0].titulo || tituloDefault }}</p>
          <div class="foto-container" style="margin-bottom: 8px;">
            <img [src]="_fotografias[0].imagen" [alt]="_fotografias[0].titulo" class="foto-imagen" style="max-width: 100%; height: auto;">
          </div>
          <p class="foto-fuente" *ngIf="mostrarFuente" style="margin: 0;">FUENTE: {{ _fotografias[0].fuente || fuenteDefault }}</p>
        </div>
      </ng-container>
    </ng-template>
  </div>
</ng-template>

<div class="image-upload-container" *ngIf="!modoVista; else vistaTemplate">
  <!-- Modo m√∫ltiples im√°genes -->
  <div *ngIf="permitirMultiples">
    <div *ngFor="let foto of _fotografias; let i = index" class="foto-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #fafafa;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h5 style="margin: 0; color: #333;">Fotograf√≠a {{ getFormattedPhotoNumber(i) }}</h5>
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="eliminarImagen(i)" 
          *ngIf="_fotografias.length > 1"
          style="padding: 6px 12px; font-size: 0.85rem; background-color: #dc3545;">
          üóëÔ∏è Eliminar
        </button>
      </div>

      <div class="form-field" *ngIf="mostrarTitulo">
        <label class="label" style="font-weight: 500;">{{ labelTitulo }}</label>
        <input 
          type="text" 
          class="input" 
          [placeholder]="placeholderTitulo"
          [value]="foto.titulo"
          (input)="onTituloChange($any($event.target).value, i)"
          style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem;">
      </div>
      
      <div class="form-field" *ngIf="mostrarFuente">
        <label class="label" style="font-weight: 500;">{{ labelFuente }}</label>
        <input 
          type="text" 
          class="input" 
          [placeholder]="placeholderFuente"
          [value]="foto.fuente"
          (input)="onFuenteChange($any($event.target).value, i)"
          style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem;">
      </div>
      
      <div class="form-field">
        <label class="label" style="font-weight: 500;">
          {{ labelImagen }}
          <span *ngIf="requerido" class="required">*</span>
        </label>
        <div 
          class="image-upload-area" 
          (dragover)="onDragOver($event, i)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event, i)"
          [class.drag-over]="dragOver && dragOverIndex === i"
          style="border: 2px dashed #ccc; border-radius: 4px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
          <input 
            type="file" 
            [id]="getFileInputId(i)"
            accept="image/*"
            (change)="onFileSelected($event, i)"
            style="display: none;">
          <div *ngIf="!foto.imagen" class="upload-placeholder">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto 10px; opacity: 0.5;">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <p style="font-weight: 500; margin: 5px 0; color: #333;">Arrastra imagen aqu√≠</p>
            <p style="font-size: 0.85rem; color: #666; margin: 5px 0;">o</p>
            <button type="button" class="btn btn-secondary" (click)="triggerFileInputById(getFileInputId(i))" style="background-color: #6c757d; color: white; padding: 6px 12px; border: none; border-radius: 4px;">
              Seleccionar archivo
            </button>
          </div>
          <div *ngIf="foto.imagen" class="image-preview" style="position: relative;">
            <img [src]="foto.imagen" [alt]="foto.titulo" style="max-width: 100%; max-height: 300px; border-radius: 4px;">
            <button type="button" class="btn-icon remove-image" (click)="eliminarImagen(i)" title="Eliminar imagen" style="position: absolute; top: 5px; right: 5px; background-color: rgba(255,0,0,0.8); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center;">
              √ó
            </button>
            <button type="button" class="btn" (click)="triggerFileInputById(getFileInputId(i))" title="Cambiar imagen" style="position: absolute; bottom: 5px; right: 5px; background-color: rgba(0,123,255,0.9); color: white; border: none; padding: 6px 10px; border-radius: 4px; font-size: 0.85rem; cursor: pointer;">
              üìù Cambiar
            </button>
          </div>
        </div>
      </div>
    </div>

    <button 
      type="button" 
      class="btn btn-secondary" 
      (click)="agregarFoto()"
      style="margin-top: 15px; padding: 10px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-weight: 500; cursor: pointer;">
      ‚ûï Agregar Fotograf√≠a
    </button>
  </div>

  <!-- Modo imagen √∫nica (compatibilidad hacia atr√°s) -->
  <div *ngIf="!permitirMultiples">
    <div class="form-field" *ngIf="mostrarTitulo">
      <label class="label">{{ labelTitulo }}</label>
      <input 
        type="text" 
        class="input" 
        [placeholder]="placeholderTitulo"
        [value]="titulo"
        (input)="onTituloChange($any($event.target).value)">
    </div>
    
    <div class="form-field" *ngIf="mostrarFuente">
      <label class="label">{{ labelFuente }}</label>
      <input 
        type="text" 
        class="input" 
        [placeholder]="placeholderFuente"
        [value]="fuente"
        (input)="onFuenteChange($any($event.target).value)">
    </div>
    
    <div class="form-field">
      <label class="label">
        {{ labelImagen }}
        <span *ngIf="requerido" class="required">*</span>
      </label>
      <div 
        class="image-upload-area" 
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        [class.drag-over]="dragOver">
        <input 
          type="file" 
          #fileInput
          accept="image/*"
          (change)="onFileSelected($event)"
          style="display: none;">
        <div *ngIf="!preview" class="upload-placeholder">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-bottom: 10px; opacity: 0.5;">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
          <p style="font-weight: 500; margin-bottom: 5px;">Fotograf√≠a</p>
          <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">Arrastra una imagen aqu√≠ o</p>
          <button type="button" class="btn btn-secondary" (click)="triggerFileInput(fileInput)">
            Buscar en el explorador
          </button>
        </div>
        <div *ngIf="preview" class="image-preview">
          <img [src]="preview" alt="Preview">
          <button type="button" class="btn-icon remove-image" (click)="eliminarImagen()" title="Eliminar imagen">
            √ó
          </button>
        </div>
      </div>
    </div>
  </div>

<ng-template #vistaTemplate>
  <div class="image-upload-container">
    <div *ngIf="permitirMultiples; else vistaUnica">
      <div *ngFor="let foto of _fotografias; let i = index" class="foto-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
        <p class="foto-numero" *ngIf="mostrarNumero">Fotograf√≠a N¬∞ {{ getFormattedPhotoNumber(i) }}</p>
        <p class="foto-titulo" *ngIf="mostrarTitulo">{{ foto.titulo || tituloDefault }}</p>
        <div class="foto-container">
          <img *ngIf="foto.imagen" [src]="foto.imagen" [alt]="foto.titulo" class="foto-imagen">
          <div *ngIf="!foto.imagen" class="upload-placeholder">____</div>
        </div>
        <p class="foto-fuente" *ngIf="mostrarFuente">FUENTE: {{ foto.fuente || fuenteDefault }}</p>
      </div>
    </div>
    <ng-template #vistaUnica>
      <div *ngIf="_fotografias.length > 0 && _fotografias[0].imagen" class="foto-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px;">
        <p class="foto-numero" *ngIf="mostrarNumero">Fotograf√≠a N¬∞ {{ getFormattedPhotoNumber(0) }}</p>
        <p class="foto-titulo" *ngIf="mostrarTitulo">{{ _fotografias[0].titulo || tituloDefault }}</p>
        <div class="foto-container">
          <img [src]="_fotografias[0].imagen" [alt]="_fotografias[0].titulo" class="foto-imagen">
        </div>
        <p class="foto-fuente" *ngIf="mostrarFuente">FUENTE: {{ _fotografias[0].fuente || fuenteDefault }}</p>
      </div>
    </ng-template>
  </div>
</ng-template>

