<div *ngIf="!modoFormulario">
<h2>3.1. DESCRIPCI√ìN Y CARACTERIZACI√ìN DE LOS ASPECTOS SOCIALES, CULTURALES Y ANTROPOL√ìGICOS DE LA POBLACI√ìN UBICADA EN EL √ÅREA DE INFLUENCIA SOCIAL DEL PROYECTO</h2>
<div *ngIf="datos.parrafoSeccion1_principal; else parrafoPrincipalDefault" class="text-justify" [innerHTML]="formatearParrafo(datos.parrafoSeccion1_principal)"></div>
<ng-template #parrafoPrincipalDefault>
    <p class="text-justify">
        Este componente realiza una caracterizaci√≥n de los aspectos socioecon√≥micos, culturales y antropol√≥gicos del
        √°rea de influencia social del proyecto
        <span [appDataSource]="'manual'" [fieldName]="'projectName'">{{ datos.projectName || '____' }}</span>, como un patr√≥n de referencia inicial en
        base a la
        cual se pueda medir los impactos sobre la poblaci√≥n del entorno directo del Proyecto.
    </p>
    <p class="text-justify">
        El proyecto <span [appDataSource]="'manual'" [fieldName]="'projectName'">{{ datos.projectName || '____' }}</span> se encuentra ubicado en el distrito de
        <span [appDataSource]="'section'" [fieldName]="'distritoSeleccionado'">{{ datos.distritoSeleccionado || '____' }}</span>, en la provincia de
        <span [appDataSource]="'section'" [fieldName]="'provinciaSeleccionada'">{{ datos.provinciaSeleccionada || '____' }}</span>, en el departamento de
        <span [appDataSource]="'section'" [fieldName]="'departamentoSeleccionado'">{{ datos.departamentoSeleccionado || '____' }}</span>, bajo la administraci√≥n del Gobierno
        Regional de <span [appDataSource]="'section'" [fieldName]="'departamentoSeleccionado'">{{ datos.departamentoSeleccionado || '____' }}</span>, en el sur del Per√∫.
    </p>
    <p class="text-justify">
        Este estudio se elabora de acuerdo con el Reglamento de la Ley del Sistema Nacional de Evaluaci√≥n de Impacto Ambiental, los T√©rminos de Referencia comunes para actividades de exploraci√≥n minera y la Gu√≠a de Relaciones Comunitarias del Ministerio de Energ√≠a y Minas (MINEM).
    </p>
</ng-template>
<h3>3.1.1 Objetivos de la l√≠nea base social</h3>
<p class="text-justify" *ngIf="datos.parrafoSeccion1_4; else parrafo4Default">
    {{ datos.parrafoSeccion1_4 }}
</p>
<ng-template #parrafo4Default>
    <p class="text-justify">Los objetivos de la presente l√≠nea de base social (LBS) son
        los siguientes:</p>
</ng-template>
<ul>
    <li class="list-item" *ngFor="let objetivo of obtenerObjetivosParaVista()">
        <span>{{ objetivo }}</span>
    </li>
</ul>

<app-image-upload
    [modoVista]="true"
    [permitirMultiples]="true"
    [fotografias]="fotografiasSeccion1"
    [sectionId]="seccionId"
    [photoPrefix]="PHOTO_PREFIX"
    [labelTitulo]="'T√≠tulo'"
    [labelFuente]="'Fuente'"
    [labelImagen]="'Imagen'">
</app-image-upload>
</div>

<div *ngIf="modoFormulario" class="seccion-formulario-content">
  <div class="form-group-section">
    <h4 class="section-title">Informaci√≥n del Proyecto</h4>
    
    <div class="form-field">
      <label class="label">Nombre del Proyecto <span class="required">*</span></label>
      <input 
        type="text" 
        class="input" 
        placeholder="Ej: Paka"
        [value]="datos['projectName'] || ''"
        (input)="onFieldChange('projectName', $any($event.target).value)">
    </div>
  </div>

  <div class="form-group-section">
    <h4 class="section-title">Cargar Datos de Centros Poblados</h4>
    
    <div class="form-field">
      <label class="label">Subir UBIGEO de Centro Poblado <span class="required">*</span></label>
      <div class="file-upload-wrapper">
        <input 
          type="file" 
          id="jsonFileInput" 
          accept=".json" 
          (change)="onJSONFileSelected($event)"
          style="display: none;">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="selectJSONFile()">
          Seleccionar archivo
        </button>
        <span *ngIf="datos['jsonFileName']" class="file-name">{{ datos['jsonFileName'] }}</span>
        <span *ngIf="!datos['jsonFileName']" class="file-name">Ning√∫n archivo seleccionado</span>
      </div>
      <small class="form-hint">Seleccione un archivo JSON con datos de centros poblados</small>
    </div>

    <div class="form-field" *ngIf="datos['centrosPobladosJSON']?.length > 0">
      <label class="label">Informaci√≥n Geogr√°fica</label>
      <div class="form-row">
        <div class="form-field">
          <label class="label">Departamento <span class="required">*</span></label>
          <input 
            type="text" 
            class="input" 
            [value]="datos['departamentoSeleccionado'] || datos['geoInfo']?.DPTO || ''"
            (input)="onFieldChange('departamentoSeleccionado', $any($event.target).value)"
            placeholder="Ingrese el departamento">
          <small class="form-hint">Se completa autom√°ticamente desde el JSON, pero puede editarlo</small>
        </div>
        <div class="form-field">
          <label class="label">Provincia <span class="required">*</span></label>
          <input 
            type="text" 
            class="input" 
            [value]="datos['provinciaSeleccionada'] || datos['geoInfo']?.PROV || ''"
            (input)="onFieldChange('provinciaSeleccionada', $any($event.target).value)"
            placeholder="Ingrese la provincia">
          <small class="form-hint">Se completa autom√°ticamente desde el JSON, pero puede editarlo</small>
        </div>
        <div class="form-field">
          <label class="label">Distrito <span class="required">*</span></label>
          <input 
            type="text" 
            class="input" 
            [value]="datos['distritoSeleccionado'] || datos['geoInfo']?.DIST || ''"
            (input)="onFieldChange('distritoSeleccionado', $any($event.target).value)"
            placeholder="Ingrese el distrito">
          <small class="form-hint">Se completa autom√°ticamente desde el JSON, pero puede editarlo</small>
        </div>
      </div>
    </div>
  </div>

  <div class="form-group-section">
    <h4 class="section-title">Editar P√°rrafos</h4>
    
    <app-paragraph-editor
      fieldId="parrafoSeccion1_principal"
      label="P√°rrafo Principal"
      hint="Edite el texto completo. Use Enter para crear nuevos p√°rrafos. Deje vac√≠o para usar el texto por defecto."
      [rows]="8"
      [value]="obtenerTextoParrafoPrincipal()"
      (valueChange)="onFieldChange('parrafoSeccion1_principal', $event)">
    </app-paragraph-editor>

    <app-paragraph-editor
      fieldId="parrafoSeccion1_4"
      label="Introducci√≥n a Objetivos"
      hint="Edite el texto completo. Deje vac√≠o para usar el texto por defecto."
      [rows]="2"
      [value]="obtenerTextoIntroduccionObjetivos()"
      (valueChange)="onFieldChange('parrafoSeccion1_4', $event)">
    </app-paragraph-editor>

    <!-- Objetivos Din√°micos -->
    <div class="form-group-section mt-lg">
      <div class="dynamic-list-header">
        <h4 class="section-title">Objetivos de la L√≠nea Base Social</h4>
        <button type="button" class="btn btn--add" (click)="agregarObjetivo()">
          ‚ûï Agregar
        </button>
      </div>
      
      <div *ngFor="let objetivo of objetivosSignal(); let i = index; trackBy: trackByIndex" class="dynamic-list-item">
        <div class="dynamic-list-item-header">
          <label class="label">Objetivo {{ i + 1 }}</label>
          <button 
            type="button" 
            class="btn btn--remove" 
            (click)="eliminarObjetivo(i)"
            *ngIf="objetivosSignal().length > 1">
            üóëÔ∏è Eliminar
          </button>
        </div>
        <textarea 
          class="input"
          [ngModel]="objetivo"
          (ngModelChange)="actualizarObjetivo(i, $event)"
          rows="3"
          placeholder="Escriba el objetivo..."></textarea>
      </div>
    </div>

    <div class="form-field mt-lg">
      <label class="label">Fotograf√≠as</label>
      <app-image-upload
        [fotografias]="fotografiasFormMulti"
        [sectionId]="seccionId"
        [photoPrefix]="PHOTO_PREFIX"
        [permitirMultiples]="true"
        labelTitulo="T√≠tulo de la fotograf√≠a"
        labelFuente="Fuente de la fotograf√≠a"
        labelImagen="Fotograf√≠a - Imagen"
        placeholderTitulo="Ej: Fotograf√≠a de la secci√≥n 1"
        placeholderFuente="Ej: GEADES, 2024"
        tituloDefault="Secci√≥n 1"
        fuenteDefault="GEADES, 2024"
        [requerido]="false"
        (fotografiasChange)="onFotografiasChange($event)">
      </app-image-upload>
    </div>
  </div>
</div>

