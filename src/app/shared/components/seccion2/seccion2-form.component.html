<!-- ✅ SECCION2-FORM: Formulario de edición (solo modoFormulario = true) --> 
<div *ngIf="modoFormulario" class="seccion-formulario-content">
  <div class="form-group-section">
    <h4 class="section-title">{{ SECCION2_TEMPLATES.tituloFormulario }}</h4>
    
    <!-- Gestión de Comunidades Campesinas (AISD) -->
    <div *ngFor="let comunidad of aisdGroups(); let i = index; trackBy: trackByComunidadId" 
         style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; background-color: #f9f9f9;">
      
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h5 style="margin: 0; color: #333;">{{ SECCION2_TEMPLATES.labelAISDTitle }} {{ i + 1 }}</h5>
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="eliminarComunidadCampesina(comunidad.id)"
          style="font-size: 12px; padding: 5px 10px;"
          *ngIf="aisdGroups().length > 1">
          {{ SECCION2_TEMPLATES.btnAISDEliminar }}
        </button>
      </div>

      <div class="form-field">
        <label class="label">{{ SECCION2_TEMPLATES.labelAISDCentrosPoblados }} <span class="required">*</span></label>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="seleccionarTodosCentrosPobladosComunidad(comunidad.id)" 
            style="font-size: 12px; padding: 5px 10px;">
            {{ SECCION2_TEMPLATES.btnAISDSeleccionarTodos }}
          </button>
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="deseleccionarTodosCentrosPobladosComunidad(comunidad.id)" 
            style="font-size: 12px; padding: 5px 10px;">
            {{ SECCION2_TEMPLATES.btnAISDDeseleccionarTodos }}
          </button>
        </div>
        <div style="border: 1px solid #ddd; border-radius: 4px; padding: 10px; background-color: white; overflow-y: auto; max-height: 220px;">
          <div *ngFor="let cp of allPopulatedCenters(); let j = index" 
               style="display: flex; align-items: center; padding: 5px 0; border-bottom: 1px solid #f0f0f0;">
            <input 
              type="checkbox" 
              [id]="'aisd_cb_' + comunidad.id + '_' + j"
              [name]="'aisd_cb_' + comunidad.id + '_' + j"
              [checked]="estaCentroPobladoSeleccionadoComunidad(comunidad.id, cp.codigo.toString() || '')"
              (change)="toggleCentroPobladoComunidad(comunidad.id, cp.codigo.toString() || '')"
              style="margin-right: 8px;">
            <label [for]="'aisd_cb_' + comunidad.id + '_' + j" style="flex: 1; cursor: pointer; margin: 0;">{{ cp.nombre }}</label>
          </div>
          <div *ngIf="allPopulatedCenters().length === 0" style="padding: 10px; text-align: center; color: #999;">
            {{ SECCION2_TEMPLATES.msgAISDSinCentros }}
          </div>
        </div>
        <small class="form-hint">{{ SECCION2_TEMPLATES.hintAISDCentros }}</small>
      </div>

      <div class="form-field">
        <label class="label" [for]="'cc_nombre_' + comunidad.id">{{ SECCION2_TEMPLATES.labelAISDNombre }} <span class="required">*</span></label>
        <input 
          #nombreInput
          [id]="'cc_nombre_' + comunidad.id"
          [name]="'cc_nombre_' + comunidad.id"
          type="text" 
          class="input" 
          [placeholder]="SECCION2_TEMPLATES.placeholderAISDNombre"
          [ngModel]="comunidad.nombre"
          (ngModelChange)="actualizarNombreComunidad(comunidad.id, $event)"
          (blur)="actualizarNombreComunidad(comunidad.id, nombreInput.value || comunidad.nombre)"
          (keyup.enter)="actualizarNombreComunidad(comunidad.id, nombreInput.value || comunidad.nombre)">
        <small class="form-hint">{{ SECCION2_TEMPLATES.hintAISDNombre }}</small>
      </div>
    </div>

    <div style="margin-top: 20px;">
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="agregarComunidadCampesina()"
        style="font-size: 14px; padding: 10px 20px;">
        {{ SECCION2_TEMPLATES.btnAISDAgregar }}
      </button>
    </div>

    <!-- Gestión de Distritos AISI -->
    <h4 class="section-title" style="margin-top: 40px;">{{ SECCION2_TEMPLATES.tituloAISI }}</h4>

    <div *ngFor="let distrito of aisiGroups(); let i = index; trackBy: trackByDistritoId" 
         style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; background-color: #f9f9f9;">

      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h5 style="margin: 0; color: #333;">{{ SECCION2_TEMPLATES.labelAISITitle }} {{ i + 1 }}</h5>
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="eliminarDistritoAISI(distrito.id)"
          style="font-size: 12px; padding: 5px 10px;"
          *ngIf="aisiGroups().length > 1">
          {{ SECCION2_TEMPLATES.btnAISIEliminar }}
        </button>
      </div>

      <div class="form-field">
        <label class="label">{{ SECCION2_TEMPLATES.labelAISICentrosPoblados }} <span class="required">*</span></label>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="seleccionarTodosCentrosPobladosDistrito(distrito.id)" 
            style="font-size: 12px; padding: 5px 10px;">
            {{ SECCION2_TEMPLATES.btnAISISeleccionarTodos }}
          </button>
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="deseleccionarTodosCentrosPobladosDistrito(distrito.id)" 
            style="font-size: 12px; padding: 5px 10px;">
            {{ SECCION2_TEMPLATES.btnAISIDeseleccionarTodos }}
          </button>
        </div>
        <div style="border: 1px solid #ddd; border-radius: 4px; padding: 10px; background-color: white; overflow-y: auto; max-height: 220px;">
          <div *ngFor="let cp of allPopulatedCenters(); let k = index" 
               style="display: flex; align-items: center; padding: 5px 0; border-bottom: 1px solid #f0f0f0;">
            <input 
              type="checkbox" 
              [id]="'aisi_cb_' + distrito.id + '_' + k"
              [name]="'aisi_cb_' + distrito.id + '_' + k"
              [checked]="estaCentroPobladoSeleccionadoDistrito(distrito.id, cp.codigo.toString() || '')"
              (change)="toggleCentroPobladoDistrito(distrito.id, cp.codigo.toString() || '')"
              style="margin-right: 8px;">
            <label [for]="'aisi_cb_' + distrito.id + '_' + k" style="flex: 1; cursor: pointer; margin: 0;">{{ cp.nombre }}</label>
          </div>
          <div *ngIf="allPopulatedCenters().length === 0" style="padding: 10px; text-align: center; color: #999;">
            {{ SECCION2_TEMPLATES.msgAISISinCentros }}
          </div>
        </div>
        <small class="form-hint">{{ SECCION2_TEMPLATES.hintAISICentros }}</small>
      </div>

      <div class="form-field">
        <label class="label" [for]="'aisi_nombre_' + distrito.id">{{ SECCION2_TEMPLATES.labelAISINombre }} <span class="required">*</span></label>
        <input 
          #nombreDistritoInput
          [id]="'aisi_nombre_' + distrito.id"
          [name]="'aisi_nombre_' + distrito.id"
          type="text" 
          class="input" 
          [placeholder]="SECCION2_TEMPLATES.placeholderAISINombre"
          [ngModel]="distrito.nombre"
          (ngModelChange)="actualizarNombreDistrito(distrito.id, $event)"
          (blur)="actualizarNombreDistrito(distrito.id, nombreDistritoInput.value || distrito.nombre)"
          (keyup.enter)="actualizarNombreDistrito(distrito.id, nombreDistritoInput.value || distrito.nombre)">
        <small class="form-hint">{{ SECCION2_TEMPLATES.hintAISINombre }}</small>
      </div>
    </div>

    <div style="margin-top: 20px;">
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="agregarDistritoAISI()"
        style="font-size: 14px; padding: 10px 20px;">
        {{ SECCION2_TEMPLATES.btnAISIAgregar }}
      </button>
    </div>
  </div>

  <div class="form-group-section">
    <h4 class="section-title">{{ SECCION2_TEMPLATES.tituloEditarParagrafos }}</h4>
    
    <app-paragraph-editor
      fieldId="parrafoSeccion2_introduccion"
      [label]="SECCION2_TEMPLATES.labelIntroduccion"
      [hint]="SECCION2_TEMPLATES.hintIntroduccion"
      [rows]="8"
      [value]="parrafoIntroduccion.value()"
      (valueChange)="parrafoIntroduccion.update($event)">
    </app-paragraph-editor>

    <app-paragraph-editor
      fieldId="parrafoSeccion2_aisd_completo"
      [label]="SECCION2_TEMPLATES.labelAISD"
      [hint]="SECCION2_TEMPLATES.hintAISD"
      [rows]="6"
      [value]="parrafoAISD.value()"
      (valueChange)="parrafoAISD.update($event)">
    </app-paragraph-editor>

    <app-paragraph-editor
      fieldId="parrafoSeccion2_aisi_completo"
      [label]="SECCION2_TEMPLATES.labelAISI"
      [hint]="SECCION2_TEMPLATES.hintAISI"
      [rows]="6"
      [value]="parrafoAISI.value()"
      (valueChange)="parrafoAISI.update($event)">
    </app-paragraph-editor>    
    <div class="form-field mt-lg">
      <label class="label">{{ SECCION2_TEMPLATES.tituloFotografias }}</label>
      <app-image-upload
        [fotografias]="fotografiasSeccion2"
        [sectionId]="seccionId"
        [photoPrefix]="PHOTO_PREFIX"
        [permitirMultiples]="true"
        [labelTitulo]="SECCION2_TEMPLATES.labelFotoTitulo"
        [labelFuente]="SECCION2_TEMPLATES.labelFotoFuente"
        [labelImagen]="SECCION2_TEMPLATES.labelFotoImagen"
        [placeholderTitulo]="SECCION2_TEMPLATES.placeholderFotoTitulo"
        [placeholderFuente]="SECCION2_TEMPLATES.placeholderFotoFuente"
        [tituloDefault]="SECCION2_TEMPLATES.tituloFotoDefault"
        [fuenteDefault]="SECCION2_TEMPLATES.fuenteFotoDefault"
        [requerido]="false"
        (fotografiasChange)="onFotografiasChange($event)">
