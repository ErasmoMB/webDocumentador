<!-- ‚úÖ REFACTORIZADO: Seccion2Component contiene vista y formulario b√°sico -->
<!-- La vista completa est√° en Seccion2ViewComponent (usa este componente) -->
<!-- El formulario completo est√° en Seccion2FormComponent (usa este componente) -->

<!-- VISTA (cuando modoFormulario = false) -->
<div *ngIf="!modoFormulario">
<h3>3.1.2 Delimitaci√≥n de las √°reas de influencia social</h3>
<div *ngIf="datos.parrafoSeccion2_introduccion; else introduccionDefault" class="text-justify" [innerHTML]="formatearParrafo(datos.parrafoSeccion2_introduccion)"></div>
<ng-template #introduccionDefault>
    <p class="text-justify">En t√©rminos generales, la delimitaci√≥n del √°mbito de estudio
        de las √°reas de influencia social se hace tomando en consideraci√≥n a los agentes e instancias sociales,
        individuales y/o colectivas, p√∫blicas y/o privadas, que tengan derechos o propiedad sobre el espacio o los
        recursos respecto de los cuales el proyecto de exploraci√≥n minera tiene incidencia. </p>
    <p class="text-justify">Asimismo, el √°rea de influencia social de un Proyecto tiene en
        consideraci√≥n a los grupos de inter√©s que puedan ser potencialmente afectadas por el desarrollo de dicho
        proyecto (seg√∫n La Gu√≠a de Relaciones Comunitarias de la DGAAM del MINEM, se denomina "grupos de inter√©s" a
        aquellos grupos humanos que son impactados por dicho Proyecto).</p>
    <p class="text-justify">El criterio social para la delimitaci√≥n de un √°rea de
        influencia debe tener en cuenta la influencia que el Proyecto pudiera tener sobre el entorno social, que
        ser√° o no ambientalmente impactado, considerando tambi√©n la posibilidad de generar otro tipo de impactos,
        expectativas, intereses y/o demandas del entorno social.
    </p>
    <p class="text-justify">En base a estos criterios se han identificado las √°reas de
        influencia social directa e indirecta:</p>
</ng-template>

<!-- ‚úÖ A. AISD - Grupos Identificados Autom√°ticamente del JSON -->
<h4>A. √Åreas de influencia social directa (AISD)</h4>
<div *ngIf="comunidadesCampesinas.length > 0; else sinAISD" class="grupos-aisd">
  <div *ngFor="let comunidad of comunidadesCampesinas; let i = index" class="grupo-card">
    <h5>{{ comunidad.id }}. {{ comunidad.nombre }}</h5>
    <p class="centros-poblados" *ngIf="comunidad.centrosPobladosSeleccionados.length > 0">
      <strong>Centros poblados:</strong> {{ comunidad.centrosPobladosSeleccionados.join(', ') }}
    </p>
    <p class="sin-centros" *ngIf="comunidad.centrosPobladosSeleccionados.length === 0">
      <em>No hay centros poblados asignados</em>
    </p>
  </div>
  <button type="button" class="btn btn--secondary" (click)="modoFormulario = true">
    ‚ûï Agregar Otra Comunidad Campesina
  </button>
</div>
<ng-template #sinAISD>
  <p class="text-muted">Cargue el JSON de centros poblados en la Secci√≥n 1 para generar autom√°ticamente las √°reas de influencia.</p>
</ng-template>

<!-- ‚úÖ B. AISI - Grupos Identificados de Valores DIST √önicos -->
<h4>B. √Åreas de influencia social indirecta (AISI)</h4>
<div *ngIf="distritosAISI.length > 0; else sinAISI" class="grupos-aisi">
  <div *ngFor="let distrito of distritosAISI; let i = index" class="grupo-card">
    <h5>{{ distrito.id }}. {{ distrito.nombre }}</h5>
    <p class="centros-poblados" *ngIf="distrito.centrosPobladosSeleccionados.length > 0">
      <strong>Centros poblados:</strong> {{ distrito.centrosPobladosSeleccionados.join(', ') }}
    </p>
    <p class="sin-centros" *ngIf="distrito.centrosPobladosSeleccionados.length === 0">
      <em>No hay centros poblados asignados</em>
    </p>
  </div>
  <button type="button" class="btn btn--secondary" (click)="modoFormulario = true">
    ‚ûï Agregar Otro Distrito
  </button>
</div>
<ng-template #sinAISI>
  <p class="text-muted">Cargue el JSON de centros poblados en la Secci√≥n 1 para generar autom√°ticamente los distritos.</p>
</ng-template>

<app-image-upload
    [modoVista]="true"
    [permitirMultiples]="true"
    [fotografias]="fotografiasSeccion2"
    [sectionId]="seccionId"
    [photoPrefix]="PHOTO_PREFIX"
    [labelTitulo]="'T√≠tulo'"
    [labelFuente]="'Fuente'"
    [labelImagen]="'Imagen'">
</app-image-upload>
</div>

<!-- FORMULARIO B√ÅSICO (cuando modoFormulario = true) -->
<div *ngIf="modoFormulario" class="seccion-formulario-content">
    <div class="form-group-section">
      <div class="form-header">
        <h4 class="section-title" style="margin-top: 20px;">Editar P√°rrafos</h4>
        <button type="button" class="btn btn--primary" (click)="llenarDatosPrueba()">
          üîÑ Llenar Datos de Prueba
        </button>
      </div>
      
      <app-paragraph-editor
        fieldId="parrafoSeccion2_introduccion"
        label="Introducci√≥n - Delimitaci√≥n de √Åreas"
        hint="Edite el texto completo. Use Enter para crear nuevos p√°rrafos. Deje vac√≠o para usar el texto por defecto."
        [rows]="6"
        [value]="obtenerTextoSeccion2Introduccion()"
        (valueChange)="onFieldChange('parrafoSeccion2_introduccion', $event)">
      </app-paragraph-editor>

      <app-paragraph-editor
        fieldId="parrafoSeccion2_aisd_completo"
        label="A. √Åreas de influencia social directa (AISD) - Texto Completo"
        hint="Edite todo el bloque de texto de AISD. Use Enter para crear nuevos p√°rrafos. Deje vac√≠o para usar el texto por defecto."
        [rows]="10"
        [value]="obtenerTextoSeccion2AISDCompleto()"
        (valueChange)="onFieldChange('parrafoSeccion2_aisd_completo', $event)">
      </app-paragraph-editor>

      <app-paragraph-editor
        fieldId="parrafoSeccion2_aisi_completo"
        label="B. √Åreas de influencia social indirecta (AISI) - Texto Completo"
        hint="Edite todo el bloque de texto de AISI. Use Enter para crear nuevos p√°rrafos. Deje vac√≠o para usar el texto por defecto."
        [rows]="8"
        [value]="obtenerTextoSeccion2AISICompleto()"
        (valueChange)="onFieldChange('parrafoSeccion2_aisi_completo', $event)">
      </app-paragraph-editor>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Fotograf√≠as</label>
        <app-image-upload
          [fotografias]="fotografiasSeccion2 || []"
          [sectionId]="seccionId"
          [photoPrefix]="PHOTO_PREFIX"
          [permitirMultiples]="true"
          [key]="imageUploadKey"
          labelTitulo="T√≠tulo de la fotograf√≠a"
          labelFuente="Fuente de la fotograf√≠a"
          labelImagen="Fotograf√≠a - Imagen"
          placeholderTitulo="Ej: Fotograf√≠a de la secci√≥n 2"
          placeholderFuente="Ej: GEADES, 2024"
          tituloDefault="Secci√≥n 2"
          fuenteDefault="GEADES, 2024"
          [requerido]="false"
          (fotografiasChange)="onFotografiasChange($event)">
        </app-image-upload>
      </div>
    </div>
  </div>
