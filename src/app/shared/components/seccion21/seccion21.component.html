<div *ngIf="!modoFormulario">
<h4>B. Caracterización socioeconómica del Área de Influencia Social Indirecta (AISI)</h4>
<div *ngIf="datos.parrafoSeccion21_aisi_intro_completo; else aisiIntroCompletoDefault" class="text-justify" [innerHTML]="formatearParrafo(datos.parrafoSeccion21_aisi_intro_completo)"></div>
<ng-template #aisiIntroCompletoDefault>
    <p class="text-justify">En cuanto al área de influencia social indirecta (AISI), se ha determinado que esta se encuentra conformada por el CP <span [appDataSource]="'section'" [fieldName]="'centroPobladoAISI'">{{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}</span>, capital distrital de la jurisdicción homónima, en la provincia de <span [appDataSource]="'section'">{{ datos.provinciaSeleccionada || '____' }}</span>, en el departamento de <span [appDataSource]="'section'">{{ datos.departamentoSeleccionado || '____' }}</span>. Esta delimitación se debe a que esta localidad es el centro político de la jurisdicción donde se ubica el Proyecto, así como al hecho de que mantiene una interrelación continua con el área delimitada como AISD y que ha sido caracterizada previamente. Además de ello, es la localidad de donde se obtendrán bienes y servicios complementarios de forma esporádica, así como que se interactuará con sus respectivas autoridades políticas.</p>
</ng-template>

<h5>B.1. Centro Poblado {{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}</h5>
<div *ngIf="datos.parrafoSeccion21_centro_poblado_completo; else centroPobladoCompletoDefault" class="text-justify" [innerHTML]="formatearParrafo(datos.parrafoSeccion21_centro_poblado_completo)"></div>
<ng-template #centroPobladoCompletoDefault>
    <p class="text-justify">El CP <span [appDataSource]="'section'" [fieldName]="'centroPobladoAISI'">{{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}</span> es la capital del distrito homónimo, perteneciente a la provincia de <span [appDataSource]="'section'">{{ datos.provinciaSeleccionada || '____' }}</span>, en el departamento de <span [appDataSource]="'section'">{{ datos.departamentoSeleccionado || '____' }}</span>. Su designación como capital distrital se oficializó mediante la Ley N°<span [appDataSource]="'manual'">{{ datos.leyCreacionDistrito || '____' }}</span>, promulgada el <span [appDataSource]="'manual'">{{ datos.fechaCreacionDistrito || '____' }}</span>, fecha en que se creó el distrito de <span [appDataSource]="'section'">{{ datos.distritoSeleccionado || '____' }}</span>. Antes de ello, este asentamiento era un caserío del distrito de <span [appDataSource]="'manual'">{{ datos.distritoAnterior || '____' }}</span>, marcando un importante cambio en su desarrollo administrativo y social.</p>
    <p class="text-justify">Los primeros pobladores de <span [appDataSource]="'section'" [fieldName]="'centroPobladoAISI'">{{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}</span> provenían principalmente de <span [appDataSource]="'manual'">{{ datos.origenPobladores1 || '____' }}</span> y la provincia de <span [appDataSource]="'manual'">{{ datos.origenPobladores2 || '____' }}</span>, en <span [appDataSource]="'manual'">{{ datos.departamentoOrigen || '____' }}</span>. Entre las familias pioneras destacan apellidos como Espinoza, Miralles, De la Cruz y Aguayo, quienes sentaron las bases de la localidad actual. El nombre "<span [appDataSource]="'section'">{{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}</span>" proviene del término quechua Ccahuayhuachu, que se traduce como "mírame desde aquí", reflejando posiblemente su ubicación estratégica o una percepción cultural del entorno.</p>
    <p class="text-justify">A diferencia de algunos anexos del distrito, como <span [appDataSource]="'manual'" [fieldName]="'anexosEjemplo'">{{ datos.anexosEjemplo || '____' }}</span>, que son centros administrativos de sus respectivas comunidades campesinas, el centro poblado <span [appDataSource]="'section'">{{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}</span> no se encuentra dentro de los límites de ninguna comunidad campesina. Esto le otorga una característica particular dentro del contexto rural, marcando su identidad como un núcleo urbano-administrativo independiente en el distrito.</p>
</ng-template>

<app-table-wrapper title="Ubicación referencial – Centro Poblado {{ datos.centroPobladoAISI || datos.informacionReferencialAISI?.centro_poblado || '____' }}" sectionId="3.1.4.B">
<table class="table-container">
    <thead>
        <tr>
            <th class="table-header">Localidad</th>
            <th class="table-header">Coordenadas</th>
            <th class="table-header">Altitud</th>
            <th class="table-header">Distrito</th>
            <th class="table-header">Provincia</th>
            <th class="table-header">Departamento</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let item of (getFilasUbicacionCp() || [])" [ngClass]="{'capital-row': item.esCapital}">
            <td class="table-cell" [appDataSource]="'section'" [fieldName]="'localidad'">{{ item.localidad || '____' }}</td>
            <td class="table-cell" style="white-space: pre-line;" [appDataSource]="'data-section'" [fieldName]="'coordenadas'">{{ item.coordenadas || '____' }}</td>
            <td class="table-cell" [appDataSource]="'data-section'" [fieldName]="'altitud'">{{ item.altitud || '____' }}</td>
            <td class="table-cell" [appDataSource]="'section'" [fieldName]="'distrito'">{{ item.distrito || '____' }}</td>
            <td class="table-cell" [appDataSource]="'section'" [fieldName]="'provincia'">{{ item.provincia || '____' }}</td>
            <td class="table-cell" [appDataSource]="'section'" [fieldName]="'departamento'">{{ item.departamento || '____' }}</td>
        </tr>
        <tr *ngIf="!getFilasUbicacionCp() || getFilasUbicacionCp().length === 0">
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
        </tr>
    </tbody>
</table>
</app-table-wrapper>
<p class="source">FUENTE:<span [appDataSource]="'manual'"> GEADES (2024)</span></p>

<app-image-upload
    [modoVista]="true"
    [permitirMultiples]="true"
    [fotografias]="getFotografiasCahuachoVista()"
    [sectionId]="seccionId"
    [photoPrefix]="PHOTO_PREFIX"
    [labelTitulo]="'Título'"
    [labelFuente]="'Fuente'"
    [labelImagen]="'Imagen'">
</app-image-upload>
</div>

<div *ngIf="modoFormulario" class="seccion-formulario-content">
  <div class="form-group-section">
    <h4 class="section-title">B. Caracterización socioeconómica del Área de Influencia Social Indirecta (AISI)</h4>
    
    <div class="form-group-section" style="margin-top: 20px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="parrafoSeccion21_aisi_intro_completo"
        label="AISI - Introducción - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="4"
        [value]="obtenerTextoSeccion21AISIIntroCompleto()"
        (valueChange)="onFieldChange('parrafoSeccion21_aisi_intro_completo', $event)">
      </app-paragraph-editor>
    </div>

    <div class="form-group-section" style="margin-top: 30px;">
      <h4 class="section-title">B.1. Centro Poblado {{ datos.centroPobladoAISI || 'Cahuacho' }}</h4>
      
      <div class="form-group-section" style="margin-top: 15px;">
        <h4 class="section-title">Editar Párrafos</h4>
        
        <app-paragraph-editor
          fieldId="parrafoSeccion21_centro_poblado_completo"
          label="Centro Poblado - Texto Completo"
          hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="6"
          [value]="obtenerTextoSeccion21CentroPobladoCompleto()"
          (valueChange)="onFieldChange('parrafoSeccion21_centro_poblado_completo', $event)">
        </app-paragraph-editor>
      </div>

      <div class="form-group-section" style="margin-top: 30px;">
        <h4 class="section-title">Datos para Generar Párrafos del Centro Poblado</h4>
        
        <div class="form-field" style="margin-top: 15px;">
          <label class="label">Ley N° de Creación del Distrito</label>
          <input type="text" class="form-control"
            [value]="datos.leyCreacionDistrito || ''"
            (input)="onFieldChange('leyCreacionDistrito', $any($event.target).value)"
            placeholder="Ej: 8004">
        </div>

        <div class="form-field" style="margin-top: 10px;">
          <label class="label">Fecha de Creación del Distrito</label>
          <input type="text" class="form-control"
            [value]="datos.fechaCreacionDistrito || ''"
            (input)="onFieldChange('fechaCreacionDistrito', $any($event.target).value)"
            placeholder="Ej: 22 de febrero de 1935">
        </div>

        <div class="form-field" style="margin-top: 10px;">
          <label class="label">Distrito Anterior</label>
          <input type="text" class="form-control"
            [value]="datos.distritoAnterior || ''"
            (input)="onFieldChange('distritoAnterior', $any($event.target).value)"
            placeholder="Ej: Caravelí">
        </div>

        <div class="form-field" style="margin-top: 10px;">
          <label class="label">Origen de Pobladores (Lugar/Provincia)</label>
          <input type="text" class="form-control"
            [value]="datos.origenPobladores1 || ''"
            (input)="onFieldChange('origenPobladores1', $any($event.target).value)"
            placeholder="Ej: Caravelí">
        </div>

        <div class="form-field" style="margin-top: 10px;">
          <label class="label">Origen de Pobladores (Provincia)</label>
          <input type="text" class="form-control"
            [value]="datos.origenPobladores2 || ''"
            (input)="onFieldChange('origenPobladores2', $any($event.target).value)"
            placeholder="Ej: Parinacochas">
        </div>

        <div class="form-field" style="margin-top: 10px;">
          <label class="label">Departamento de Origen</label>
          <input type="text" class="form-control"
            [value]="datos.departamentoOrigen || ''"
            (input)="onFieldChange('departamentoOrigen', $any($event.target).value)"
            placeholder="Ej: Arequipa">
        </div>

        <div class="form-field" style="margin-top: 10px;">
          <label class="label">Anexos Ejemplo</label>
          <input type="text" class="form-control"
            [value]="datos.anexosEjemplo || ''"
            (input)="onFieldChange('anexosEjemplo', $any($event.target).value)"
            placeholder="Ej: Llacsahuanca, Salome">
        </div>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Tabla Ubicación CP</label>
        <div class="table-editor" style="overflow-x: auto;">
          <table class="editor-table">
            <thead>
              <tr>
                <th>Localidad</th>
                <th>Coordenadas</th>
                <th>Altitud</th>
                <th>Distrito</th>
                <th>Provincia</th>
                <th>Departamento</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of (datos['ubicacionCpTabla'] || []); let i = index">
                <td>
                  <input type="text" class="table-input" 
                    [value]="item.localidad || ''"
                    (input)="actualizarUbicacionCp(i, 'localidad', $any($event.target).value)"
                    placeholder="Cahuacho">
                </td>
                <td>
                  <textarea class="table-input" rows="2"
                    [value]="item.coordenadas || ''"
                    (input)="actualizarUbicacionCp(i, 'coordenadas', $any($event.target).value)"
                    placeholder="Lat: -15.1234&#10;Lon: -73.5678"></textarea>
                </td>
                <td>
                  <input type="text" class="table-input" 
                    [value]="item.altitud || ''"
                    (input)="actualizarUbicacionCp(i, 'altitud', $any($event.target).value)"
                    placeholder="3500 m">
                </td>
                <td>
                  <input type="text" class="table-input" 
                    [value]="item.distrito || ''"
                    (input)="actualizarUbicacionCp(i, 'distrito', $any($event.target).value)"
                    placeholder="Cahuacho">
                </td>
                <td>
                  <input type="text" class="table-input" 
                    [value]="item.provincia || ''"
                    (input)="actualizarUbicacionCp(i, 'provincia', $any($event.target).value)"
                    placeholder="Caravelí">
                </td>
                <td>
                  <input type="text" class="table-input" 
                    [value]="item.departamento || ''"
                    (input)="actualizarUbicacionCp(i, 'departamento', $any($event.target).value)"
                    placeholder="Arequipa">
                </td>
                <td>
                  <button type="button" class="btn-icon" (click)="eliminarUbicacionCp(i)" *ngIf="(datos['ubicacionCpTabla'] || []).length > 1" title="Eliminar fila">
                    ×
                  </button>
                </td>
              </tr>
              <tr *ngIf="!datos['ubicacionCpTabla'] || datos['ubicacionCpTabla'].length === 0">
                <td colspan="7" style="text-align: center; padding: 10px;">
                  <button type="button" class="btn btn-secondary" (click)="inicializarUbicacionCp()">
                    Agregar Primera Fila
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <button type="button" class="btn btn-secondary" (click)="agregarUbicacionCp()" style="margin-top: 10px;">
          + Agregar Fila
        </button>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Fotografías de Cahuacho</label>
        <app-image-upload
          [fotografias]="fotografiasFormMulti"
          [sectionId]="seccionId"
          [photoPrefix]="PHOTO_PREFIX"
          [permitirMultiples]="true"
          labelTitulo="Título de la fotografía"
          labelFuente="Fuente de la fotografía"
          labelImagen="Fotografía - Imagen"
          placeholderTitulo="Ej: Centro Poblado Cahuacho"
          placeholderFuente="Ej: GEADES, 2024"
          tituloDefault="Centro Poblado Cahuacho"
          fuenteDefault="GEADES, 2024"
          [requerido]="false"
          (fotografiasChange)="onFotografiasChange($event)">
        </app-image-upload>
      </div>
    </div>
  </div>
</div>

