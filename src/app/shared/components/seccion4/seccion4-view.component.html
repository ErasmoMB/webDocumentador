<!-- Vista previa (modo lectura) -->
<div class="document-view">
  <h3>{{ SECCION4_TEMPLATES.tituloVista }}</h3>
  <h4>{{ SECCION4_TEMPLATES.tituloAISD }}</h4>

  <!-- Párrafos dinámicos procesados por TextGeneratorService -->
  <div [innerHTML]="viewModel().texts.introduccionText"></div>

  <h5 class="cc-identifier">{{ SECCION4_TEMPLATES.tituloA1ComunidadCampesina }} {{ viewModel().nombreComunidad }}</h5>

  <div [innerHTML]="viewModel().texts.comunidadText"></div>

  <!-- Tabla de Ubicación Referencial -->
  <app-table-wrapper [title]="(viewModel().data['cuadroTituloAISD1'] || SECCION4_TEMPLATES.labelTablaUbicacionReferencial) + ' – ' + SECCION4_TEMPLATES.labelCC + ' ' + viewModel().nombreComunidad" [sectionId]="'3.1.4.A1'">
    <app-generic-table
      [data]="viewModel().tables.tablaAISD1"
      [config]="{
        columns: [
          { key: 'localidad', header: SECCION4_TEMPLATES.headerLocalidad, align: 'left' },
          { key: 'coordenadas', header: SECCION4_TEMPLATES.headerCoordenadas, align: 'left' },
          { key: 'altitud', header: SECCION4_TEMPLATES.headerAltitud, align: 'right' },
          { key: 'distrito', header: SECCION4_TEMPLATES.headerDistrito, align: 'left' },
          { key: 'provincia', header: SECCION4_TEMPLATES.headerProvincia, align: 'left' },
          { key: 'departamento', header: SECCION4_TEMPLATES.headerDepartamento, align: 'left' }
        ],
        showFooter: false,
        striped: true,
        hover: true
      }">
    </app-generic-table>
  </app-table-wrapper>
  <p class="text-justify data-source">
    {{ SECCION4_TEMPLATES.labelFuente }}
    <span *ngIf="viewModel().sources.tablaAISD1Source">{{ viewModel().sources.tablaAISD1Source }}</span>
    <span *ngIf="!viewModel().sources.tablaAISD1Source" [appDataSource]="'manual'">{{ SECCION4_TEMPLATES.fuenteAISD1Default }}</span>
  </p>

  <!-- Fotografías de Ubicación -->
  <app-image-upload
      [modoVista]="true"
      [permitirMultiples]="true"
      [fotografias]="getPhotoGroup(PHOTO_PREFIX_UBICACION)"
      [sectionId]="seccionId"
      [photoPrefix]="PHOTO_PREFIX_UBICACION + obtenerPrefijoGrupo()"
      [labelTitulo]="SECCION4_TEMPLATES.labelFotoTitulo"
      [labelFuente]="SECCION4_TEMPLATES.labelFotoFuente"
      [labelImagen]="SECCION4_TEMPLATES.labelFotoImagen">
  </app-image-upload>

  <div [innerHTML]="viewModel().texts.caracterizacionText"></div>

  <!-- Tabla de Población y Viviendas -->
  <app-table-wrapper [title]="(viewModel().data['cuadroTituloAISD2'] || SECCION4_TEMPLATES.labelTablaPoblacionViviendas) + ' – ' + SECCION4_TEMPLATES.labelCC + ' ' + viewModel().nombreComunidad" [sectionId]="'3.1.4.A2'">
    <app-generic-table
      [data]="viewModel().tables.tablaAISD2"
      [config]="{
        columns: [
          { key: 'punto', header: 'Punto de Población (INEI)', align: 'left' },
          { key: 'codigo', header: 'Código', align: 'left' },
          { key: 'poblacion', header: 'Población', align: 'right' },
          { key: 'viviendasEmpadronadas', header: 'Viviendas empadronadas', align: 'right' },
          { key: 'viviendasOcupadas', header: 'Viviendas ocupadas', align: 'right' }
        ],
        totalRow: {
          punto: 'Total',
          poblacion: viewModel().calculations.totalesAISD2?.poblacion ?? 0,
          viviendasEmpadronadas: viewModel().calculations.totalesAISD2?.viviendasEmpadronadas ?? 0,
          viviendasOcupadas: viewModel().calculations.totalesAISD2?.viviendasOcupadas ?? 0
        },
        showFooter: true,
        striped: true,
        hover: true
      }">
    </app-generic-table>
  </app-table-wrapper>
  <p class="text-justify data-source">
    {{ SECCION4_TEMPLATES.labelFuente }}
    <span *ngIf="viewModel().sources.tablaAISD2Source && viewModel().sources.tablaAISD2Source !== '____'">{{ viewModel().sources.tablaAISD2Source }}</span>
    <span *ngIf="!viewModel().sources.tablaAISD2Source" [appDataSource]="'manual'">{{ SECCION4_TEMPLATES.fuenteAISD2Default }}</span>
    <span *ngIf="viewModel().sources.tablaAISD2Source === '____'">____</span>
  </p>

  <!-- Fotografías de Población -->
  <app-image-upload
      [modoVista]="true"
      [permitirMultiples]="true"
      [fotografias]="getPhotoGroup(PHOTO_PREFIX_POBLACION)"
      [sectionId]="seccionId"
      [photoPrefix]="PHOTO_PREFIX_POBLACION + obtenerPrefijoGrupo()"
      [labelTitulo]="SECCION4_TEMPLATES.labelFotoTitulo"
      [labelFuente]="SECCION4_TEMPLATES.labelFotoFuente"
      [labelImagen]="SECCION4_TEMPLATES.labelFotoImagen">
  </app-image-upload>
</div>
