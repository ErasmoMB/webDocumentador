<!-- Formulario (modo edición) -->
<div *ngIf="modoFormulario" class="seccion-formulario-content">
  <div class="form-group-section">
    <h4 class="section-title">3.1.4. Caracterización socioeconómica — Editor</h4>

    <div class="form-group-section" style="margin-top: 12px;">
      <h4 class="section-title">Editar Párrafos</h4>

      <app-paragraph-editor
        [fieldId]="'parrafoSeccion4_introduccion_aisd'"
        label="Introducción AISD"
        [rows]="4"
        [value]="getTextoIntroduccionEfectivo()"
        (valueChange)="onFieldChange('parrafoSeccion4_introduccion_aisd', $event)">
      </app-paragraph-editor>

      <app-paragraph-editor
        [fieldId]="'parrafoSeccion4_comunidad_completo'"
        label="Descripción de la Comunidad"
        [rows]="5"
        [value]="getTextoComunidadEfectivo()"
        (valueChange)="onFieldChange('parrafoSeccion4_comunidad_completo', $event)">
      </app-paragraph-editor>

      <app-paragraph-editor
        [fieldId]="'parrafoSeccion4_caracterizacion_indicadores'"
        label="Caracterización - Indicadores"
        [rows]="4"
        [value]="getTextoCaracterizacionEfectivo()"
        (valueChange)="onFieldChange('parrafoSeccion4_caracterizacion_indicadores', $event)">
      </app-paragraph-editor>
    </div>

    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Título de tabla - Ubicación referencial (A.1)</label>
      <input type="text" class="form-control" [(ngModel)]="datos['cuadroTituloAISD1']" (ngModelChange)="onFieldChange('cuadroTituloAISD1', $event)" placeholder="Ej: Ubicación referencial - CC Comunidad">
    </div>

    <label class="label" style="margin-top:10px">Ubicación referencial (Tabla A1)</label>
    <app-dynamic-table
      [datos]="datos"
      [config]="tableCfg.getTablaAISD1Config()"
      [columns]="tableCfg.getColumnasAISD1()"
      [sectionId]="seccionId"
      [tablaKey]="'tablaAISD1Datos'"
      [fieldName]="'tablaAISD1Datos'"
      (tableUpdated)="onTablaUpdated()">
    </app-dynamic-table>

    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Título de tabla - Cantidad total de población y viviendas (A.2)</label>
      <input type="text" class="form-control" [(ngModel)]="datos['cuadroTituloAISD2']" (ngModelChange)="onFieldChange('cuadroTituloAISD2', $event)" placeholder="Ej: Cantidad total de población y viviendas">
    </div>

    <label class="label" style="margin-top:10px">Población y viviendas (Tabla A2)</label>
    <app-dynamic-table
      [datos]="datos"
      [config]="tableCfg.getTablaAISD2Config()"
      [columns]="tableCfg.getColumnasAISD2()"
      [sectionId]="seccionId"
      [tablaKey]="'tablaAISD2Datos'"
      [fieldName]="'tablaAISD2Datos'"
      (tableUpdated)="onTablaUpdated()">
    </app-dynamic-table>

    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Fuente de las tablas</label>
      <input type="text" class="form-control" [(ngModel)]="datos['cuadroFuenteAISD1']" (ngModelChange)="onFieldChange('cuadroFuenteAISD1', $event)" placeholder="Ej: GEADES (2024)">
    </div>

    <div class="form-field" style="margin-top: 20px;">
      <label class="label">Fotografías</label>
      <app-image-upload
        [fotografias]="fotografiasFormMulti"
        [sectionId]="seccionId"
        [photoPrefix]="PHOTO_PREFIX_UBICACION"
        [permitirMultiples]="true"
        (fotografiasChange)="onFotografiasChange($event)">
      </app-image-upload>
    </div>

  </div>
</div>

<!-- Vista previa (modo lectura) -->
<div class="document-view" *ngIf="!modoFormulario && viewModel() as vm">
  <h3>3.1.4. Caracterización socioeconómica de las Áreas de Influencia Social</h3>
  <h4>A. Caracterización socioeconómica del Área de Influencia Social Directa (AISD)</h4>

  <!-- Párrafos dinámicos procesados por TextGeneratorService -->
  <div [innerHTML]="vm.texts.introduccionText"></div>

  <h5 class="cc-identifier">A.1. Comunidad Campesina {{ vm.data['comunidadesCampesinas']?.[0]?.nombre || 'Comunidad' }}</h5>

  <div [innerHTML]="vm.texts.comunidadText"></div>

  <!-- Tabla de Ubicación Referencial -->
  <app-table-wrapper [title]="(vm.data['cuadroTituloAISD1'] || 'Ubicación referencial') + ' – CC ' + (vm.data['comunidadesCampesinas']?.[0]?.nombre || 'Comunidad')" [sectionId]="'3.1.4.A1'">
    <app-generic-table
      [data]="vm.tables.tablaAISD1"
      [config]="{
        columns: [
          { key: 'localidad', header: 'Localidad', align: 'left' },
          { key: 'coordenadas', header: 'Coordenadas', align: 'left' },
          { key: 'altitud', header: 'Altitud', align: 'right' },
          { key: 'distrito', header: 'Distrito', align: 'left' },
          { key: 'provincia', header: 'Provincia', align: 'left' },
          { key: 'departamento', header: 'Departamento', align: 'left' }
        ],
        showFooter: false,
        striped: true,
        hover: true
      }">
    </app-generic-table>
  </app-table-wrapper>
  <p class="text-justify data-source">
    FUENTE:
    <span *ngIf="vm.sources.tablaAISD1Source">{{ vm.sources.tablaAISD1Source }}</span>
    <span *ngIf="!vm.sources.tablaAISD1Source" [appDataSource]="'manual'">GEADES (2024)</span>
  </p>

  <!-- Fotografías de Ubicación -->
  <app-image-upload
      [modoVista]="true"
      [permitirMultiples]="true"
      [fotografias]="getPhotoGroup(PHOTO_PREFIX_UBICACION)"
      [sectionId]="seccionId"
      [photoPrefix]="PHOTO_PREFIX_UBICACION"
      [labelTitulo]="'Título'"
      [labelFuente]="'Fuente'"
      [labelImagen]="'Imagen'">
  </app-image-upload>

  <div [innerHTML]="vm.texts.caracterizacionText"></div>

  <!-- Tabla de Población y Viviendas -->
  <app-table-wrapper [title]="(vm.data['cuadroTituloAISD1'] || 'Cantidad total de población y viviendas') + ' – CC ' + (vm.data['comunidadesCampesinas']?.[0]?.nombre || 'Comunidad')" [sectionId]="'3.1.4.A2'">
    <app-generic-table
      [data]="vm.tables.tablaAISD2"
      [config]="{
        columns: [
          { key: 'punto', header: 'Punto de Población (INEI)', align: 'left' },
          { key: 'codigo', header: 'Código', align: 'left' },
          { key: 'poblacion', header: 'Población', align: 'right' },
          { key: 'viviendasEmpadronadas', header: 'Viviendas empadronadas', align: 'right' },
          { key: 'viviendasOcupadas', header: 'Viviendas ocupadas', align: 'right' }
        ],
        totalRow: {
          punto: 'Total',
          poblacion: vm.calculations.totalesAISD2.poblacion,
          viviendasEmpadronadas: vm.calculations.totalesAISD2.empadronadas,
          viviendasOcupadas: vm.calculations.totalesAISD2.ocupadas
        },
        showFooter: true,
        striped: true,
        hover: true
      }">
    </app-generic-table>
  </app-table-wrapper>
  <p class="text-justify data-source">
    FUENTE:
    <span *ngIf="vm.sources.tablaAISD2Source && vm.sources.tablaAISD2Source !== '____'">{{ vm.sources.tablaAISD2Source }}</span>
    <span *ngIf="!vm.sources.tablaAISD2Source" [appDataSource]="'manual'">Reporte de Indicadores de Desarrollo e Inclusión Social de Centro Poblado – REDINFORMA (MIDIS)</span>
    <span *ngIf="vm.sources.tablaAISD2Source === '____'">____</span>
  </p>

  <!-- Fotografías de Población -->
  <app-image-upload
      [modoVista]="true"
      [permitirMultiples]="true"
      [fotografias]="getPhotoGroup(PHOTO_PREFIX_POBLACION)"
      [sectionId]="seccionId"
      [photoPrefix]="PHOTO_PREFIX_POBLACION"
      [labelTitulo]="'Título'"
      [labelFuente]="'Fuente'"
      [labelImagen]="'Imagen'">
  </app-image-upload>
</div>