<div *ngIf="!modoFormulario">
<h5>A.1.4. Actividades económicas de la población</h5>
<p class="text-justify" *ngIf="datos.textoActividadesEconomicas && datos.textoActividadesEconomicas !== '____'" [innerHTML]="obtenerTextoActividadesEconomicasConResaltado()"></p>
<p class="text-justify" *ngIf="!datos.textoActividadesEconomicas || datos.textoActividadesEconomicas === '____'" [innerHTML]="obtenerTextoActividadesEconomicasConResaltado()"></p>
<p class="text-justify" *ngIf="!datos.textoFuentesActividadesEconomicas || datos.textoFuentesActividadesEconomicas === '____'">A partir de fuentes oficiales, se exploran las principales labores y ocupaciones más relevantes dentro de la CC <span [appDataSource]="'section'" [fieldName]="'textoFuentesActividadesEconomicas'">{{ obtenerNombreComunidadActual() }}</span>. En esta ocasión, se recurre a los datos provistos por la Plataforma Nacional de Datos Georreferenciados – Geo Perú.</p>

<app-table-wrapper title="PEA Ocupada según ocupaciones principales – CC {{ obtenerNombreComunidadActual() }} (2017)" sectionId="3.1.4.A.1.4">
<table class="table-container">
    <thead>
        <tr>
            <th class="table-header">Categoría</th>
            <th class="table-header">Casos</th>
            <th class="table-header">Porcentaje</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let item of getPEAOcupacionesSinTotal()">
            <td class="table-cell"><span *ngIf="item.categoria && item.categoria !== '____'" [appDataSource]="'backend'" [fieldName]="'categoria'">{{ item.categoria }}</span><span *ngIf="!item.categoria || item.categoria === '____'">____</span></td>
            <td class="table-cell"><span *ngIf="item.casos !== undefined && item.casos !== '____'" [appDataSource]="'backend'" [fieldName]="'casos'">{{ item.casos | number:'1.0-0' }}</span><span *ngIf="item.casos === undefined || item.casos === '____'">____</span></td>
            <td class="table-cell"><span *ngIf="item.porcentaje && item.porcentaje !== '____'" [appDataSource]="'calculated'">{{ item.porcentaje }}</span><span *ngIf="!item.porcentaje || item.porcentaje === '____'">____</span></td>
        </tr>
        <tr class="total-row" *ngIf="getPEAOcupacionesSinTotal().length > 0">
            <td class="table-cell"><strong>Total</strong></td>
            <td class="table-cell"><strong>{{ getTotalPEAOcupaciones() | number:'1.0-0' }}</strong></td>
            <td class="table-cell"><strong>100,00 %</strong></td>
        </tr>
        <tr *ngIf="getPEAOcupacionesSinTotal().length === 0">
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
        </tr>
    </tbody>
</table>
</app-table-wrapper>
<p class="source">Fuente:<span [appDataSource]="'manual'" [fieldName]="'textoAnalisisCuadro310'">Plataforma Nacional de Datos Georreferenciados – Geo Perú</span></p>

<p class="text-justify" *ngIf="datos.textoAnalisisCuadro310 && datos.textoAnalisisCuadro310 !== '____'" [innerHTML]="obtenerTextoAnalisisCuadro310ConResaltado()"></p>
<p class="text-justify" *ngIf="!datos.textoAnalisisCuadro310 || datos.textoAnalisisCuadro310 === '____'" [innerHTML]="obtenerTextoAnalisisCuadro310ConResaltado()"></p>

<p style="margin-top: 20px; margin-bottom: 10px;"><strong>a. Ganadería</strong></p>
<div *ngIf="datos.parrafoSeccion8_ganaderia_completo; else ganaderiaCompletoDefault" class="text-justify" [innerHTML]="obtenerTextoSeccion8GanaderiaCompletoConResaltado()"></div>
<ng-template #ganaderiaCompletoDefault>
    <div class="text-justify" [innerHTML]="obtenerTextoSeccion8GanaderiaCompletoConResaltado()"></div>
</ng-template>

<app-table-wrapper title="Población pecuaria promedio y precios de venta – CC {{ obtenerNombreComunidadActual() }}" sectionId="3.1.4.A.1.4">
<table class="table-container">
    <thead>
        <tr>
            <th class="table-header">Especie</th>
            <th class="table-header">Cantidad promedio por familia</th>
            <th class="table-header">Venta por unidad</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let item of (datos.poblacionPecuariaTabla || [])">
            <td class="table-cell"><span *ngIf="item.especie && item.especie !== '____'" [appDataSource]="'manual'" [fieldName]="'especie'">{{ item.especie }}</span><span *ngIf="!item.especie || item.especie === '____'">____</span></td>
            <td class="table-cell"><span *ngIf="item.cantidadPromedio && item.cantidadPromedio !== '____'" [appDataSource]="'manual'" [fieldName]="'cantidadPromedio'">{{ item.cantidadPromedio }}</span><span *ngIf="!item.cantidadPromedio || item.cantidadPromedio === '____'">____</span></td>
            <td class="table-cell"><span *ngIf="item.ventaUnidad && item.ventaUnidad !== '____'" [appDataSource]="'manual'" [fieldName]="'ventaUnidad'">{{ item.ventaUnidad }}</span><span *ngIf="!item.ventaUnidad || item.ventaUnidad === '____'">____</span></td>
        </tr>
        <tr *ngIf="!datos.poblacionPecuariaTabla || datos.poblacionPecuariaTabla.length === 0">
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
        </tr>
    </tbody>
</table>
</app-table-wrapper>
<p class="source">Fuente:<span [appDataSource]="'manual'">GEADES (2024)</span></p>

<app-image-upload
    [modoVista]="true"
    [permitirMultiples]="true"
    [fotografias]="getFotografiasGanaderiaVista()"
    [sectionId]="seccionId"
    [photoPrefix]="'fotografiaGanaderia'"
    [labelTitulo]="'Título'"
    [labelFuente]="'Fuente'"
    [labelImagen]="'Imagen'">
</app-image-upload>

<p style="margin-top: 20px; margin-bottom: 10px;"><strong>b. Agricultura</strong></p>
<div *ngIf="datos.parrafoSeccion8_agricultura_completo; else agriculturaCompletoDefault" class="text-justify" [innerHTML]="obtenerTextoSeccion8AgriculturaCompletoConResaltado()"></div>
<ng-template #agriculturaCompletoDefault>
    <div class="text-justify" [innerHTML]="obtenerTextoSeccion8AgriculturaCompletoConResaltado()"></div>
</ng-template>

<app-table-wrapper title="Características de la Agricultura – CC {{ obtenerNombreComunidadActual() }}" sectionId="3.1.4.A.1.4">
<table class="table-container">
    <thead>
        <tr>
            <th class="table-header">Categoría</th>
            <th class="table-header">Detalle</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let item of (datos.caracteristicasAgriculturaTabla || [])">
            <td class="table-cell"><span *ngIf="item.categoria && item.categoria !== '____'" [appDataSource]="'manual'" [fieldName]="'categoria'">{{ item.categoria }}</span><span *ngIf="!item.categoria || item.categoria === '____'">____</span></td>
            <td class="table-cell"><span *ngIf="item.detalle && item.detalle !== '____'" [appDataSource]="'manual'" [fieldName]="'detalle'">{{ item.detalle }}</span><span *ngIf="!item.detalle || item.detalle === '____'">____</span></td>
        </tr>
        <tr *ngIf="!datos.caracteristicasAgriculturaTabla || datos.caracteristicasAgriculturaTabla.length === 0">
            <td class="table-cell">____</td>
            <td class="table-cell">____</td>
        </tr>
    </tbody>
</table>
</app-table-wrapper>
<p class="source">Fuente:<span [appDataSource]="'manual'">GEADES (2024)</span></p>

<app-image-upload
    [modoVista]="true"
    [permitirMultiples]="true"
    [fotografias]="getFotografiasAgriculturaVista()"
    [sectionId]="seccionId"
    [photoPrefix]="PHOTO_PREFIX_AGRICULTURA"
    [labelTitulo]="'Título'"
    [labelFuente]="'Fuente'"
    [labelImagen]="'Imagen'">
</app-image-upload>

<p style="margin-top: 20px; margin-bottom: 10px;"><strong>c. Mercado y comercialización de productos</strong></p>
<p class="text-justify" *ngIf="datos.textoMercadoComercializacion1 && datos.textoMercadoComercializacion1 !== '____'">{{ datos.textoMercadoComercializacion1 }}</p>
<p class="text-justify" *ngIf="!datos.textoMercadoComercializacion1 || datos.textoMercadoComercializacion1 === '____'">Dentro de la CC <span [appDataSource]="'section'" [fieldName]="'textoMercadoComercializacion1'">{{ obtenerNombreComunidadActual() }}</span> no existe un mercado local donde se puedan comercializar los productos agrícolas o ganaderos directamente. Toda la venta de estos productos se realiza a través de intermediarios que visitan la comunidad en busca de animales en pie o productos como el queso. Estos intermediarios suelen establecer los precios de compra, lo que limita la capacidad de los comuneros para negociar y obtener un valor justo por su producción.</p>
<p class="text-justify" *ngIf="!datos.textoMercadoComercializacion2 || datos.textoMercadoComercializacion2 === '____'">Esta dependencia de los intermediarios presenta diversas dificultades. Por un lado, los comuneros reciben precios más bajos en comparación con los que podrían obtener si tuvieran acceso directo a mercados más grandes o si contaran con un punto de venta dentro de la comunidad. Además, el transporte de los productos fuera de la comunidad aumenta los costos logísticos, afectando la rentabilidad de las actividades económicas. Este sistema de comercialización se traduce en una vulnerabilidad económica para las familias, ya que dependen de las condiciones impuestas por terceros para la venta de sus bienes.</p>

<app-image-upload
    [modoVista]="true"
    [permitirMultiples]="true"
    [fotografias]="getFotografiasComercioVista()"
    [sectionId]="seccionId"
    [photoPrefix]="PHOTO_PREFIX_COMERCIO"
    [labelTitulo]="'Título'"
    [labelFuente]="'Fuente'"
    [labelImagen]="'Imagen'">
</app-image-upload>

<p style="margin-top: 20px; margin-bottom: 10px;"><strong>d. Hábitos de consumo</strong></p>
<p class="text-justify" *ngIf="datos.textoHabitosConsumo1 && datos.textoHabitosConsumo1 !== '____'">{{ datos.textoHabitosConsumo1 }}</p>
<p class="text-justify" *ngIf="!datos.textoHabitosConsumo1 || datos.textoHabitosConsumo1 === '____'">En la CC <span [appDataSource]="'section'" [fieldName]="'textoHabitosConsumo1'">{{ obtenerNombreComunidadActual() }}</span>, los hábitos de consumo se caracterizan por una dieta basada principalmente en productos que se adquieren de comerciantes que visitan la comunidad periódicamente (quincenalmente, en promedio), así como en pequeñas bodegas locales. Entre los alimentos más consumidos destacan los abarrotes como el arroz, maíz y fideos, que forman parte esencial de la alimentación diaria de las familias. Estos productos son complementados con la producción local de papa y habas, que también son alimentos fundamentales en la dieta.</p>
<p class="text-justify" *ngIf="!datos.textoHabitosConsumo2 || datos.textoHabitosConsumo2 === '____'">El consumo de papa y habas es especialmente importante, ya que ambos son productos locales y tradicionales, que no solo se destinan al autoconsumo, sino que también forman parte de la base alimentaria debido a su disponibilidad y bajo costo. La producción de estos alimentos es continua, lo que asegura su presencia en la mayoría de los hogares. Dentro de la CC <span [appDataSource]="'section'" [fieldName]="'textoHabitosConsumo2'">{{ obtenerNombreComunidadActual() }}</span> resaltan algunos platos tradicionales como el "revuelto de habas", cuy chactado y el chicharrón. Por otra parte, también destaca el consumo de frutas que son obtenidas a través de los comerciantes que visitan la comunidad, los cuales ofrecen productos adicionales como verduras y prendas en determinadas ocasiones.</p>
</div>

<div *ngIf="modoFormulario" class="seccion-formulario-content">
  <div class="form-group-section">
    <h4 class="section-title">A.1.4. Actividades económicas de la población</h4>
    
    <div class="form-group-section" style="margin-top: 20px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoActividadesEconomicas"
        label="Actividades Económicas - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="3"
        [value]="obtenerTextoActividadesEconomicas()"
        (valueChange)="onFieldChange('textoActividadesEconomicas', $event)">
      </app-paragraph-editor>
    </div>

    <div class="form-field" style="margin-top: 30px;">
      <label class="label">Tabla PEA Ocupada según ocupaciones principales</label>
      <app-dynamic-table
        [datos]="datos"
        [config]="peaOcupacionesConfig"
        [columns]="[
          { field: 'categoria', label: 'Categoría', type: 'text', placeholder: 'Trabajador independiente' },
          { field: 'casos', label: 'Casos', type: 'number', placeholder: '0' },
          { field: 'porcentaje', label: 'Porcentaje', type: 'text', placeholder: '0%', readonly: true }
        ]"
        [tablaKey]="getTablaKeyPEAOcupaciones()"
        [totalKey]="'categoria'"
        [customFieldChangeHandler]="onPEAOcupacionesFieldChange.bind(this)"
        (tableUpdated)="onPEAOcupacionesTableUpdated()">
      </app-dynamic-table>
      <div class="table-editor" *ngIf="getPEAOcupacionesSinTotal().length > 0" style="margin-top: 10px;">
        <table class="editor-table">
          <tbody>
            <tr class="total-row">
              <td><strong>Total</strong></td>
              <td>
                <input type="text" class="table-input" 
                  [value]="getTotalPEAOcupaciones()"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
              <td>
                <input type="text" class="table-input" 
                  value="100,00 %"
                  readonly
                  style="background-color: #f5f5f5; cursor: not-allowed;">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="form-group-section" style="margin-top: 20px;">
      <h4 class="section-title">Editar Párrafos</h4>
      
      <app-paragraph-editor
        fieldId="textoAnalisisCuadro310"
        label="Análisis Cuadro 3.10 - Texto Completo"
        hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
        [rows]="3"
        [value]="obtenerTextoAnalisisCuadro310()"
        (valueChange)="onFieldChange('textoAnalisisCuadro310', $event)">
      </app-paragraph-editor>
    </div>

    <div class="form-group-section" style="margin-top: 30px;">
      <h4 class="section-title">a. Ganadería</h4>
      
      <div class="form-group-section" style="margin-top: 15px;">
        <h4 class="section-title">Editar Párrafos</h4>
        
        <app-paragraph-editor
          fieldId="parrafoSeccion8_ganaderia_completo"
          label="Ganadería - Texto Completo"
          hint="Edite todo el bloque de texto sobre ganadería. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="8"
          [value]="obtenerTextoSeccion8GanaderiaCompleto()"
          (valueChange)="onFieldChange('parrafoSeccion8_ganaderia_completo', $event)">
        </app-paragraph-editor>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Tabla Población Pecuaria</label>
        <app-dynamic-table
          [datos]="datos"
          [config]="poblacionPecuariaConfig"
          [columns]="[
            { field: 'especie', label: 'Especie', type: 'text', placeholder: 'Vacuno' },
            { field: 'cantidadPromedio', label: 'Cantidad promedio por familia', type: 'text', placeholder: '4 – 50' },
            { field: 'ventaUnidad', label: 'Venta por unidad', type: 'text', placeholder: 'S/. 1 200 – S/. 1 500' }
          ]"
          [tablaKey]="'poblacionPecuariaTabla'"
          [totalKey]="'especie'"
          (tableUpdated)="cdRef.detectChanges()">
        </app-dynamic-table>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Fotografías de Ganadería</label>
        <app-image-upload
          [fotografias]="fotografiasGanaderiaFormMulti"
          [sectionId]="seccionId"
          [photoPrefix]="PHOTO_PREFIX_GANADERIA"
          [permitirMultiples]="true"
          labelTitulo="Título de la fotografía"
          labelFuente="Fuente de la fotografía"
          labelImagen="Fotografía - Imagen"
          placeholderTitulo="Ej: Ganadería en la CC Ayroca"
          placeholderFuente="Ej: GEADES, 2024"
          tituloDefault="Ganadería"
          fuenteDefault="GEADES, 2024"
          [requerido]="false"
          (fotografiasChange)="onFotografiasGanaderiaChange($event)">
        </app-image-upload>
      </div>
    </div>

    <div class="form-group-section" style="margin-top: 30px;">
      <h4 class="section-title">b. Agricultura</h4>
      
      <div class="form-group-section" style="margin-top: 15px;">
        <h4 class="section-title">Editar Párrafos</h4>
        
        <app-paragraph-editor
          fieldId="parrafoSeccion8_agricultura_completo"
          label="Agricultura - Texto Completo"
          hint="Edite todo el bloque de texto sobre agricultura. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="6"
          [value]="obtenerTextoSeccion8AgriculturaCompleto()"
          (valueChange)="onFieldChange('parrafoSeccion8_agricultura_completo', $event)">
        </app-paragraph-editor>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Tabla Características de la Agricultura</label>
        <app-dynamic-table
          [datos]="datos"
          [config]="caracteristicasAgriculturaConfig"
          [columns]="[
            { field: 'categoria', label: 'Categoría', type: 'text', placeholder: 'Categoría' },
            { field: 'detalle', label: 'Detalle', type: 'text', placeholder: 'Detalle' }
          ]"
          [tablaKey]="'caracteristicasAgriculturaTabla'"
          [totalKey]="'categoria'"
          (tableUpdated)="cdRef.detectChanges()">
        </app-dynamic-table>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Fotografías de Agricultura</label>
        <app-image-upload
          [fotografias]="fotografiasAgriculturaFormMulti"
          [sectionId]="seccionId"
          [photoPrefix]="PHOTO_PREFIX_AGRICULTURA"
          [permitirMultiples]="true"
          labelTitulo="Título de la fotografía"
          labelFuente="Fuente de la fotografía"
          labelImagen="Fotografía - Imagen"
          placeholderTitulo="Ej: Agricultura en la CC Ayroca"
          placeholderFuente="Ej: GEADES, 2024"
          tituloDefault="Agricultura"
          fuenteDefault="GEADES, 2024"
          [requerido]="false"
          (fotografiasChange)="onFotografiasAgriculturaChange($event)">
        </app-image-upload>
      </div>
    </div>

    <div class="form-group-section" style="margin-top: 30px;">
      <h4 class="section-title">c. Mercado y comercialización de productos</h4>
      
      <div class="form-group-section" style="margin-top: 15px;">
        <h4 class="section-title">Editar Párrafos</h4>
        
        <app-paragraph-editor
          fieldId="textoMercadoComercializacion1"
          label="Mercado y Comercialización - Párrafo 1"
          hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="3"
          [value]="obtenerTextoMercadoComercializacion1()"
          (valueChange)="onFieldChange('textoMercadoComercializacion1', $event)">
        </app-paragraph-editor>
        
        <app-paragraph-editor
          fieldId="textoMercadoComercializacion2"
          label="Mercado y Comercialización - Párrafo 2"
          hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="3"
          [value]="obtenerTextoMercadoComercializacion2()"
          (valueChange)="onFieldChange('textoMercadoComercializacion2', $event)"
          style="margin-top: 15px;">
        </app-paragraph-editor>
      </div>

      <div class="form-field" style="margin-top: 20px;">
        <label class="label">Fotografías de Comercio</label>
        <app-image-upload
          [fotografias]="fotografiasComercioFormMulti"
          [sectionId]="seccionId"
          [photoPrefix]="PHOTO_PREFIX_COMERCIO"
          [permitirMultiples]="true"
          labelTitulo="Título de la fotografía"
          labelFuente="Fuente de la fotografía"
          labelImagen="Fotografía - Imagen"
          placeholderTitulo="Ej: Comercio en la CC Ayroca"
          placeholderFuente="Ej: GEADES, 2024"
          tituloDefault="Comercio"
          fuenteDefault="GEADES, 2024"
          [requerido]="false"
          (fotografiasChange)="onFotografiasComercioChange($event)">
        </app-image-upload>
      </div>
    </div>

    <div class="form-group-section" style="margin-top: 30px;">
      <h4 class="section-title">d. Hábitos de consumo</h4>
      
      <div class="form-group-section" style="margin-top: 15px;">
        <h4 class="section-title">Editar Párrafos</h4>
        
        <app-paragraph-editor
          fieldId="textoHabitosConsumo1"
          label="Hábitos de Consumo - Párrafo 1"
          hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="3"
          [value]="obtenerTextoHabitosConsumo1()"
          (valueChange)="onFieldChange('textoHabitosConsumo1', $event)">
        </app-paragraph-editor>
        
        <app-paragraph-editor
          fieldId="textoHabitosConsumo2"
          label="Hábitos de Consumo - Párrafo 2"
          hint="Edite el texto completo. Use Enter para crear nuevos párrafos. Deje vacío para usar el texto por defecto."
          [rows]="4"
          [value]="obtenerTextoHabitosConsumo2()"
          (valueChange)="onFieldChange('textoHabitosConsumo2', $event)"
          style="margin-top: 15px;">
        </app-paragraph-editor>
      </div>
    </div>
  </div>
</div>

